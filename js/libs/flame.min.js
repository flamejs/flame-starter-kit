function handleLayoutHash(e){var t=null;if(e.width>0||e.height>0||e.top>0||e.bottom>0||e.left>0||e.right>0||e.centerX!==null||e.centerY!==null)t={width:e.width,height:e.height,bottom:e.bottom,top:e.top,left:e.left,right:e.right,centerX:e.centerX,centerY:e.centerY};return t}window.Flame=Ember.Namespace.create({}),typeof Range!="undefined"&&typeof Range.prototype.createContextualFragment=="undefined"&&(Range.prototype.createContextualFragment=function(e){var t=this.startContainer.ownerDocument,n=t.createElement("div");n.innerHTML=e;var r=t.createDocumentFragment(),i;while(i=n.firstChild)r.appendChild(i);return r});var Hashtable=function(){function n(t){var r;if(typeof t=="string")return t;if(typeof t.hashCode==e)return r=t.hashCode(),typeof r=="string"?r:n(r);if(typeof t.toString==e)return t.toString();try{return String(t)}catch(i){return Object.prototype.toString.call(t)}}function r(e,t){return e.equals(t)}function i(t,n){return typeof n.equals==e?n.equals(t):t===n}function s(e){return function(t){if(t===null)throw new Error("null is not a valid "+e);if(typeof t=="undefined")throw new Error(e+" must not be undefined")}}function a(e,t,n,r){this[0]=e,this.entries=[],this.addEntry(t,n),r!==null&&(this.getEqualityFunction=function(){return r})}function h(e){return function(t){var n=this.entries.length,r,i=this.getEqualityFunction(t);while(n--){r=this.entries[n];if(i(t,r[0]))switch(e){case f:return!0;case l:return r;case c:return[n,r[1]]}}return!1}}function p(e){return function(t){var n=t.length;for(var r=0,i=this.entries.length;r<i;++r)t[n+r]=this.entries[r][e]}}function d(e,t){var n=e.length,r;while(n--){r=e[n];if(t===r[0])return n}return null}function v(e,t){var n=e[t];return n&&n instanceof a?n:null}function m(r,i){var s=this,f=[],l={},c=typeof r==e?r:n,h=typeof i==e?i:null;this.put=function(e,t){o(e),u(t);var n=c(e),r,i,s=null;return r=v(l,n),r?(i=r.getEntryForKey(e),i?(s=i[1],i[1]=t):r.addEntry(e,t)):(r=new a(n,e,t,h),f[f.length]=r,l[n]=r),s},this.get=function(e){o(e);var t=c(e),n=v(l,t);if(n){var r=n.getEntryForKey(e);if(r)return r[1]}return null},this.containsKey=function(e){o(e);var t=c(e),n=v(l,t);return n?n.containsKey(e):!1},this.containsValue=function(e){u(e);var t=f.length;while(t--)if(f[t].containsValue(e))return!0;return!1},this.clear=function(){f.length=0,l={}},this.isEmpty=function(){return!f.length};var p=function(e){return function(){var t=[],n=f.length;while(n--)f[n][e](t);return t}};this.keys=p("keys"),this.values=p("values"),this.entries=p("getEntries"),this.remove=function(e){o(e);var n=c(e),r,i=null,s=v(l,n);return s&&(i=s.removeEntryForKey(e),i!==null&&(s.entries.length||(r=d(f,n),t(f,r),delete l[n]))),i},this.size=function(){var e=0,t=f.length;while(t--)e+=f[t].entries.length;return e},this.each=function(e){var t=s.entries(),n=t.length,r;while(n--)r=t[n],e(r[0],r[1])},this.putAll=function(t,n){var r=t.entries(),i,o,u,a,f=r.length,l=typeof n==e;while(f--)i=r[f],o=i[0],u=i[1],l&&(a=s.get(o))&&(u=n(o,a,u)),s.put(o,u)},this.clone=function(){var e=new m(r,i);return e.putAll(s),e}}var e="function",t=typeof Array.prototype.splice==e?function(e,t){e.splice(t,1)}:function(e,t){var n,r,i;if(t===e.length-1)e.length=t;else{n=e.slice(t+1),e.length=t;for(r=0,i=n.length;r<i;++r)e[t+r]=n[r]}},o=s("key"),u=s("value"),f=0,l=1,c=2;return a.prototype={getEqualityFunction:function(t){return typeof t.equals==e?r:i},getEntryForKey:h(l),getEntryAndIndexForKey:h(c),removeEntryForKey:function(e){var n=this.getEntryAndIndexForKey(e);return n?(t(this.entries,n[0]),n[1]):null},addEntry:function(e,t){this.entries[this.entries.length]=[e,t]},keys:p(0),values:p(1),getEntries:function(e){var t=e.length;for(var n=0,r=this.entries.length;n<r;++n)e[t+n]=this.entries[n].slice(0)},containsKey:h(f),containsValue:function(e){var t=this.entries.length;while(t--)if(e===this.entries[t][1])return!0;return!1}},m}();Ember.mixin(Array.prototype,{sum:function(){return this.reduce(function(e,t){return e+t},0)},isEqual:function(e){if(!e)return!1;if(e==this)return!0;var t=e.get("length");if(t!=this.get("length"))return!1;while(--t>=0)if(!Ember.isEqual(e.objectAt(t),this.objectAt(t)))return!1;return!0},max:function(){return Math.max.apply(Math,this)},min:function(){return Math.min.apply(Math,this)},flatten:function(){return this.reduce(function(e,t){return e.concat(t)},[])}}),Ember.mixin(Ember.Binding.prototype,{eq:function(e){return this.transform(function(t,n){return Ember.typeOf(t)==="string"&&t===e})},transformTrueFalse:function(e,t){return this.transform({to:function(n){return n?e:t},from:function(t){return t===e}})},kindOf:function(e){return this.transform(function(t,n){var r=Ember.isArray(t)?t.toArray()[0]:t,i=Ember.isArray(e)?e:[e],s=i.some(function(e){return r&&r instanceof e});return s?r:null})},equals:function(e){return this.transform(function(t,n){return e===t})},isNull:function(){return this.transform(function(e,t){return e===null})},hasPermission:function(e){return this.transform(function(t,n){return t&&t.hasPermission&&t.hasPermission(e)})}}),Flame.computed={equals:function(e,t){return Ember.computed(e,function(){return t===Ember.getPath(this,e)}).cacheable()},notEquals:function(e,t){return Ember.computed(e,function(){return t!==Ember.getPath(this,e)}).cacheable()},trueFalse:function(e,t,n){return Ember.computed(e,function(){return Ember.getPath(this,e)?t:n}).cacheable()}},Flame.computed.not=function(e){return Ember.computed(e,function(t){return!Ember.getPath(this,e)}).cacheable()},Flame.computed.empty=function(e){return Ember.computed(e,function(t){var n=Ember.getPath(this,e);return n===undefined||n===null||n===""||Ember.isArray(n)&&Ember.get(n,"length")===0}).cacheable()},Flame.computed.bool=function(e){return Ember.computed(e,function(t){return!!Ember.getPath(this,e)}).cacheable()},Flame.computed.or=function(e,t){return Ember.computed(e,t,function(n){return Ember.getPath(this,e)||Ember.getPath(this,t)}).cacheable()},Ember.Handlebars.registerHelper("flameView",function(e,t){e&&e.data&&e.data.isRenderData&&(t=e,e="Flame.View");var n=t.hash;n.layout=handleLayoutHash(n),Ember.Handlebars.ViewHelper.helper(this,e,t)}),Ember.Handlebars.registerHelper("tabView",function(e){var t=e,n=t.hash;n.layout=handleLayoutHash(n);var r=Flame.TabView.create(n),i=e.fn;if(i){var s=r.get("templateContext"),o={buffer:[],view:r};i(s,{data:o})}e.data.view.appendChild(r)}),Ember.Handlebars.registerHelper("tab",function(e){var t=e.data.view,n=e.hash,r=n,i=e;t.set(n.value,Flame.View.extend({template:i.fn})),t.get("tabs")===null&&t.set("tabs",Ember.A([])),t.get("tabs").pushObject(n)}),Ember.Handlebars.registerHelper("panelView",function(e){var t=e,n=t.hash;n.layout=handleLayoutHash(n);var r=e.fn;r&&(n.contentView=Flame.View.create({layout:{top:26,bottom:0,left:0,right:0},template:r}));var i=Flame.Panel.create(n);i.appendTo("body")}),Ember.Handlebars.registerHelper("tableView",function(e){var t=e,n=t.hash;n.layout=handleLayoutHash(n);var r=e.fn;if(r){var i={buffer:[],columns:Ember.A()};r(null,{data:i}),n.columns=i.columns}n.content=Ember.getPath(n.controller).create({headerProperty:n.headerProperty,columns:n.columns,contentBinding:n.contentBinding});var s=Flame.TableView.create({content:n.content,layout:n.layout});e.data.view.appendChild(s)}),Ember.Handlebars.registerHelper("column",function(e){var t=e.data.columns,n=e.hash,r=e;t.pushObject(n)}),Ember.$.browser.msie&&Ember.$.browser.version<10&&Ember.$(function(){Ember.$("body").on("selectstart",function(e){var t=Ember.$(e.target);return["INPUT","TEXTAREA"].contains(e.target.tagName)||t.parents().andSelf().is(".is-selectable")||t.attr("contenteditable")==="true"})}),Flame.imagePath="images/",Ember.mixin(Flame,{image:function(e){return typeof FlameImageUrlPrefix=="undefined"?(Flame.imagePath||"")+e:FlameImageUrlPrefix+e}}),jQuery.fn.selectRange=function(e,t){return this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(e,t);else if(this.createTextRange){var n=this.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select()}})},jQuery.fn.replaceClasses=function(e){return this.removeAttr("class"),e&&this.attr("class",e),this},jQuery.fn.safeClone=function(){var e=jQuery(this).clone();return e.find("script[id^=metamorph]").remove(),e.find("*").each(function(){var e=jQuery(this),t,n,r=e[0].attributes.length;for(t=0;t<r;t++)n=e[0].attributes[t],n&&n.name.match(/^data-(bindattr|ember)/)&&e.removeAttr(attr.name)}),e.find("[id^=ember]").removeAttr("id"),e},Ember.mixin(Ember.Binding.prototype,{connect:function(e){var t=this._from.match(/^(\^|\$)/);if(!t)return this._super(e)}}),Flame.reopen({_bindPrefixedBindings:function(e){for(var t in e)if(t.match(/Binding$/)){var n=e[t];if(!(n instanceof Ember.Binding))throw"Expected a Ember.Binding!";var r=n._from.match(/^(\^|\$)([^.]+)(.*)$/);if(r){var i=r[1]==="$",s=r[2],o=r[3],u;i?u=this._lookupValueOfProperty(e,s):u=this._lookupPathToProperty(e,s);var a=u+o,f=new Ember.Binding(n._to,a);f._transforms=n._transforms,f.connect(e)}}},_lookupValueOfProperty:function(e,t){var n=e,r;while(r===undefined&&r!==null&&n!==undefined&&n!==null)r=n.get(t),n=n.get("parentView");return r},_lookupPathToProperty:function(e,t){var n=[t,"parentView"],r=e.get("parentView"),i=t+"Binding";while(!Ember.none(r)){if(typeof Ember.get(r,t)!="undefined"||typeof Ember.get(r,i)!="undefined")return n.reverse().join(".");n.push("parentView"),r=r.get("parentView")}return undefined}}),function(){var e=0,t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelRequestAnimationFrame=window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),s=window.setTimeout(function(){t(r+i)},i);return e=r+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),Flame.SortingArrayProxy=Ember.ArrayProxy.extend({sortKey:"position",parent:null,_suppressObservers:!1,init:function(){this._sourceDidChange(),this._super(),this.get("content").addArrayObserver(this,{willChange:"_contentArrayWillChange",didChange:"_contentArrayDidChange"})},content:function(e,t){t!==undefined&&this.set("_content",t);var n=this.get("_content");return n===undefined&&this.set("_content",n=[]),n}.property(),startMoving:function(){this._suppressObservers=!0},endMoving:function(){this._suppressObservers=!1;var e=this.get("content"),t=this.get("sortKey");this._withObserversSuppressed(function(){e.forEach(function(e,n){Ember.setPath(e,t,n)})})},_sourceWillChange:function(){var e=this.get("source");if(e){var t=this;e.forEach(function(e){t._removeSortIndexObserverFor(e)}),e.removeArrayObserver(this,{willChange:"_sourceArrayWillChange",didChange:"_sourceArrayDidChange"})}}.observesBefore("source"),_sourceDidChange:function(){var e=this.get("source");if(e){var t=e.slice();this._sort(t);var n=this.get("content");n.replace(0,n.get("length"),t);var r=this;n.forEach(function(e){r._addSortIndexObserverAndRegisterForRemoval(e)}),e.addArrayObserver(this,{willChange:"_sourceArrayWillChange",didChange:"_sourceArrayDidChange"})}}.observes("source"),_addSortIndexObserverAndRegisterForRemoval:function(e){var t=this.get("sortKey");e.lastPosition=e.get(t);var n=function(){this._indexChanged(e)};Ember.addObserver(e,t,this,n),e[this.get("observerKey")]=n},_removeSortIndexObserverFor:function(e){var t=e[this.get("observerKey")];t&&(Ember.removeObserver(e,this.get("sortKey"),this,t),delete e[this.get("observerKey")])},_getObserverKey:function(){return"__observer_"+Ember.guidFor(this)}.property().cacheable(),_indexChanged:function(e){if(e.lastPosition===e.get(this.get("sortKey"))||this._suppressObservers)return;this._sortAndReplaceContent(this.get("content").slice())},_sourceArrayWillChange:function(e,t,n,r){var i=this.get("content"),s=this;this._withObserversSuppressed(function(){if(t===0&&n===i.get("length"))i.replace(0,n),i.forEach(function(e){s._removeSortIndexObserverFor(e)});else for(var r=t;r<t+n;r++){var o=e.objectAt(r);i.removeObject(o),s._removeSortIndexObserverFor(o)}})},_sourceArrayDidChange:function(e,t,n,r){var i=this.get("content").slice();if(r>0){for(var s=t;s<t+r;s++){var o=e.objectAt(s);this._addSortIndexObserverAndRegisterForRemoval(o),i.push(o)}this._sortAndReplaceContent(i)}},_contentArrayWillChange:function(e,t,n,r){var i=this.get("source"),s=this;this._withObserversSuppressed(function(){for(var r=t;r<t+n;r++){var o=e.objectAt(r);i.removeObject(o),s._removeSortIndexObserverFor(o)}})},_contentArrayDidChange:function(e,t,n,r){if(r>0){var i=this.get("sortKey"),s=this.get("source"),o=this;this._withObserversSuppressed(function(){e.forEach(function(e,t){Ember.setPath(e,i,t)});for(var n=t;n<t+r;n++){var u=e.objectAt(n);o._addSortIndexObserverAndRegisterForRemoval(u),s.pushObject(u)}})}},_sortAndReplaceContent:function(e){var t=this.get("content");this._sort(e),this._withObserversSuppressed(function(){t.replace(0,t.get("length"),e)})},_sort:function(e){var t=this.get("sortKey");e.sort(function(e,n){return Ember.compare(Ember.getPath(e,t),Ember.getPath(n,t))})},_withObserversSuppressed:function(e){if(this._suppressObservers)return;this._suppressObservers=!0;try{e.call()}finally{this._suppressObservers=!1}}}),String.prototype.trim===undefined&&(String.prototype.trim=function(){return jQuery.trim(this)}),Ember.mixin(String.prototype,{truncate:function(e){var t=Ember.none(e)?30:e;return this.length<=t?this.toString():this.substr(0,t)+"..."},isBlank:function(){return this.trim().length===0}}),Ember.mixin(Flame,{_setupStringMeasurement:function(e,t){e||(e=""),t||(t="");var n=this._metricsCalculationElement;if(!n){var r=document.createElement("div");r.style.cssText="position:absolute;left:-10010px; top:-10px; width:10000px; visibility:hidden;",n=this._metricsCalculationElement=document.createElement("div"),n.style.cssText="position:absolute; left: 0px; top: 0px; bottom: auto; right: auto; width: auto; height: auto;",r.appendChild(n),document.body.insertBefore(r,null)}return n.parentNode.className=e,n.className=t,n},measureString:function(e,t,n){var r=this._setupStringMeasurement(t,n);return r.innerHTML=e,{width:r.clientWidth,height:r.clientHeight}}}),Flame.TableCell=function(e){this.value=null;for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])},Flame.TableCell.prototype.content=function(){return this.formattedValue()},Flame.TableCell.prototype.formattedValue=function(){return this.value===null?"":this.value},Flame.TableCell.prototype.editableValue=function(){throw"Not implemented"},Flame.TableCell.prototype.validate=function(e){return!0},Flame.TableCell.prototype.formatValueForBackend=function(e){throw"Not implemented"},Flame.TableCell.prototype.isEditable=function(){return!1},Flame.TableCell.prototype.cssClasses=function(){return[]},Flame.TableCell.prototype.cssClassesString=function(){return""},Flame.TableHeader=Ember.Object.extend({isClickable:!1,headerLabel:function(){return this.get("label")}.property("label").cacheable(),createCell:function(e){throw"Not implemented"}}),Flame.TableSortSupport={sortAscendingCaption:"Sort ascending...",sortDescendingCaption:"Sort descending...",sortContent:function(e){throw"Not implemented!"},columnHeaderClicked:function(e,t){this._showSortMenu(e,this._sortMenuOptions(e),t)},_showSortMenu:function(e,t,n){var r=t.map(function(e){return e.title.length}).max(),i=Flame.MenuView.create({items:t,layout:{width:r*8},target:this,action:"sortContent",payloadBinding:"value"});i.popup(n)},_sortMenuOptions:function(e){return[{title:this.get("sortAscendingCaption"),value:{header:e,order:"asc"}},{title:this.get("sortDescendingCaption"),value:{header:e,order:"desc"}}]}},Flame.TableViewContentAdapter=Ember.Object.extend({content:null,headers:function(){return this.getPath("content._headers")}.property("content._headers").cacheable(),columnLeafs:function(){return this.getPath("content.columnLeafs")}.property("content.columnLeafs").cacheable(),rowLeafs:function(){return this.getPath("content.rowLeafs")}.property("content.rowLeafs").cacheable(),columnHeaderRows:function(){var e=[],t=this.get("headers"),n=t.columnHeaders,r=n.length,i;for(i=0;i<r;i++)this._processHeader(e,n[i],"columns",0,!1,i);e.maxDepth=this.get("columnLeafs").map(function(e){return e.depth}).max();for(i=0;i<this.get("columnLeafs").length;i++){var s=this.get("columnLeafs")[i];s.rowspan=e.maxDepth-s.depth+1}return e}.property("headers").cacheable(),rowHeaderRows:function(){var e=[[]],t=this.get("headers"),n=t.rowHeaders,r=n.length,i;for(i=0;i<r;i++)this._processHeader(e,n[i],"rows",0,i===0,i);e.maxDepth=this.get("rowLeafs").map(function(e){return e.depth}).max();for(i=0;i<this.get("rowLeafs").length;i++){var s=this.get("rowLeafs")[i];s.colspan=e.maxDepth-s.depth+1}return e}.property("headers").cacheable(),clear:function(){this._headers=null,this.propertyDidChange("headers")},_processHeader:function(e,t,n,r,i,s){t.depth=r+1,t.dataIndex=s,n==="columns"?(e[r]||(e[r]=[]),e[r].push(t)):n==="rows"&&(i||e.push([]),e[e.length-1].push(t));var o=0;if(t.hasOwnProperty("children")){var u=t.children,a=u.length;for(var f=0;f<a;f++){var l=u[f];o+=this._processHeader(e,l,n,r+1,f===0,s)}}else o=1;return n==="columns"?t.colspan=o:t.rowspan=o,o}}),Flame.State=Ember.Object.extend({gotoState:function(e){this.get("owner").gotoState(e)},normalizeTouchEvents:function(e){return e.touches||(e.touches=e.originalEvent.touches),e.pageX||(e.pageX=e.originalEvent.pageX),e.pageY||(e.pageY=e.originalEvent.pageY),e.screenX||(e.screenX=e.originalEvent.screenX),e.screenY||(e.screenY=e.originalEvent.screenY),e.clientX||(e.clientX=e.originalEvent.clientX),e.clientY||(e.clientY=e.originalEvent.clientY),e},$:function(e){e=Array.prototype.slice.call(arguments);var t=this.get("owner");return t.$.apply(t,e)}}),Flame.State.reopenClass({gotoHandler:function(e,t){return function(){return this.gotoState(e),t===undefined?!0:t}}}),Flame.Statechart={initialState:null,currentState:undefined,_currentStateName:undefined,init:function(){this._super();var e;for(e in this){var t=this[e];Flame.State.detect(t)&&(this.set(e,t.create({owner:this})),this._setupProxyMethods(this[e]))}this.gotoState(this.get("initialState"))},_setupProxyMethods:function(e){for(var t in e)e.constructor.prototype.hasOwnProperty(t)&&Ember.typeOf(e[t])==="function"&&!this[t]&&t!=="enterState"&&t!=="exitState"&&(this[t]=function(e){return function(t){return t=Array.prototype.slice.call(arguments),t.unshift(e),this.invokeStateMethod.apply(this,t)}}(t))},gotoState:function(e){var t=this.get("currentState"),n=this.get(e);if(t===n)return;if(!(!Ember.none(n)&&n instanceof Flame.State))throw new Error("%@ is not a state!".fmt(e));Ember.none(t)||t.exitState&&t.exitState(),this._currentStateName=e,this.set("currentState",n),n.enterState&&n.enterState()},isCurrentlyIn:function(e){return this._currentStateName===e},invokeStateMethod:function(e,t){t=Array.prototype.slice.call(arguments),t.shift();var n=this.get("currentState"),r=n[e];if(Ember.typeOf(r)==="function")return r.apply(n,t)}},Flame.TableController=Ember.Object.extend({dirtyCells:[],valuesOn:"column",isLoading:!1,pushDataBatch:function(e){if(e!==undefined){var t=this.get("_headers");if(!t)throw"Can't push data without first setting headers!";if(!this._dataBatchIsForCurrentTable(e))return;var n=this.get("dirtyCells").slice(),r=this.get("valuesOn"),i=this.get(r+"Leafs"),s=this.get("rowLeafs"),o=this.get("columnLeafs"),u=this.get("_data"),a=e.length,f=this.get("_indexFromPathMapping"),l,c,h;for(var p=0;p<a;p++){l=e[p],c=f[l.path.row][l.path.column],l.rowHeaderParams=s[c[0]].params,l.columnHeaderParams=o[c[1]].params,l=i[c[r==="row"?0:1]].createCell(l),h=u[c[0]][c[1]];if(h&&h.pending)for(var d in h.pending)l[d]=h.pending[d];u[c[0]][c[1]]=l,n.push(c)}this.set("dirtyCells",n)}},_dataBatchIsForCurrentTable:function(e){var t=e.length,n=this.get("_indexFromPathMapping");return t>0?n[e[0].path.row]&&n[e[t-1].path.row]:!1},_indexFromPathMapping:function(){var e={},t=this.get("rowLeafs"),n=t.length,r=this.get("columnLeafs"),i=r.length,s,o,u,a,f;for(s=0;s<n;s++){u=t[s],f=e[u.path]={};for(o=0;o<i;o++)a=r[o],f[a.path]=[s,o]}return e}.property("rowLeafs","columnLeafs").cacheable(),rowLeafs:function(){var e=this.get("_headers");return e?this._getLeafs(e.rowHeaders,[]):null}.property("_headers").cacheable(),columnLeafs:function(){var e=this.get("_headers");return e?this._getLeafs(e.columnHeaders,[]):null}.property("_headers").cacheable(),pathFromIndex:function(e){var t=this.get("rowLeafs"),n=this.get("columnLeafs");return{row:t[e[0]].path,column:n[e[1]].path}},indexFromPath:function(e){var t=this.get("_indexFromPathMapping");return t[e.row][e.column]},_getLeafs:function(e,t){var n,r=e.length,i=[],s;for(s=0;s<r;s++){n=e[s];if(n.hasOwnProperty("children")){var o=n.hasOwnProperty("id")?t.concat(n.id):t;i=i.concat(this._getLeafs(n.children,o))}else n.path=t.concat(n.id),i.push(n)}for(s=0;s<i.length;s++)i[s].leafIndex=s;return i},_headersDidChange:function(){var e=this.get("_headers");if(!Ember.none(e)){var t=[];this.set("dirtyCells",[]);var n=this.get("rowLeafs").length,r=this.get("columnLeafs").length;for(i=0;i<n;i++){t.push([]);for(var s=0;s<r;s++)t[i].push(null)}this.set("_data",t)}}.observes("_headers")}),Flame.DataTableController=Flame.TableController.extend({headers:null,data:null,init:function(){this._super(),this._headersDidChange()},_headers:function(){var e=this.get("headers");return{rowHeaders:this._wrapHeaders(e.rowHeaders||[]),columnHeaders:this._wrapHeaders(e.columnHeaders||[])}}.property("headers").cacheable(),_wrapHeaders:function(e){var t=this,n=this.get("headerClass");return e.map(function(e,r){var i=n.create({id:r},e),s=i.get("children");return s&&i.set("children",t._wrapHeaders(s)),i})},headerClass:function(){var e=this.get("cellClass");return Flame.TableHeader.extend({createCell:function(t){return new e({value:t.value})}})}.property().cacheable(),cellClass:Flame.TableCell,_transformData:function(e){var t=[];return e.forEach(function(e,n){e.forEach(function(e,r){t.push({path:{row:[n],column:[r]},value:e})})}),t},_headersDidChange:function(){this._super();var e=this.get("data");e&&this.pushDataBatch(this._transformData(e))}.observes("headers")}),Flame.ArrayTableController=Flame.DataTableController.extend(Flame.TableSortSupport,{content:[],columns:[],headerProperty:null,rowHeadersClickable:!1,init:function(){this._super(),this._setContentObserver()},headers:function(){var e=this.get("headerProperty"),t=this.get("rowHeadersClickable"),n=this;return{rowHeaders:this.get("content").map(function(r,i){var s=r.get(e),o=function(){return function(e,t,r){r!==s&&n.refreshHeaders()}}();return n._setPropertyObserver(r,e,o),{isClickable:t,label:r.get(e),object:r}}),columnHeaders:this.get("columns").map(function(e,t){return{label:Ember.getPath(e,"label"),property:Ember.getPath(e,"property")}})}}.property("content.@each","columns","headerProperty","rowHeadersClickable").cacheable(),data:function(){var e=this,t=this.get("columns");return this.get("content").map(function(n,r){return t.map(function(t,s){var o=Ember.getPath(t,"property"),u=function(){return function(t,n,o){e.pushDataBatch([{path:{row:[r],column:[s]},value:o}])}}();return e._setPropertyObserver(n,o,u),Ember.get(n,Ember.getPath(t,"property"))})})}.property("headers").cacheable(),_setPropertyObserver:function(e,t,n){var r=t+"DidChangeInArrayTableController";e.removeObserver(t,e,r),e[r]=n,e.addObserver(t,e,r)},_removePropertyObservers:function(e){var t=/(.+)DidChangeInArrayTableController$/;for(var n in e)if(e.hasOwnProperty(n)&&t.test(n)){var r=t.exec(n)[1];e.removeObserver(r,e,n),delete e[n]}},_contentArrayWillChange:function(e,t,n,r){var i=t+n;for(var s=t;s<i;s++)this._removePropertyObservers(e.objectAt(s))},_setContentObserver:function(){var e=this.get("content");e&&e.addArrayObserver(this,{willChange:"_contentArrayWillChange",didChange:Ember.K})}.observes("content"),_removeContentObserver:function(){var e=this.get("content");e&&(e.removeArrayObserver(this,{willChange:"_contentArrayWillChange",didChange:Ember.K}),e.forEach(this._removePropertyObservers,this))}.observesBefore("content"),sortContent:function(e){var t=e.header.get("property"),n=e.order==="desc"?-1:1,r=this.get("content").slice();r.sort(function(e,r){return n*Ember.compare(Ember.get(e,t),Ember.get(r,t))}),this.set("content",r)},refreshHeaders:function(){this.propertyWillChange("headers"),this.propertyDidChange("headers")}}),Flame.ActionSupport={target:null,action:null,payload:null,fireAction:function(e,t){var n=this.get("target")||this;while("string"==typeof n)n.charAt(0)==="."?n=this.getPath(n.slice(1)):n=Ember.getPath(n);e===undefined&&(e=this.get("action"));if(e){var r="function"==typeof e?e:Ember.get(n,e);if(!r)throw"Target %@ does not have action %@".fmt(n,e);var i=Ember.none(t)?this.get("payload"):t;return Ember.none(i)&&(i=this),r.call(n,i,e,this)}return!1}},function(){var e={interpretKeyEvents:function(e){var t=e.shiftKey?Flame.MODIFIED_KEY_BINDINGS:Flame.KEY_BINDINGS,n=t[e.keyCode];if(n&&this[n]){var r=this[n];if(Ember.typeOf(r)==="function")return r.call(this,e,this)}return!1},handleKeyEvent:function(e,t){var n=null;switch(e.type){case"keydown":n="keyDown";break;case"keypress":n="keyPress"}var r=n?this.get(n):null;window.FlameInspector&&n&&FlameInspector.logEvent(e,n,this);if(r)return!r.call(Flame.keyResponderStack.current(),e,Flame.keyResponderStack.current());if(n==="keyDown"&&this.interpretKeyEvents(e))return!1;if(this.get("parentView"))return this.get("parentView").handleKeyEvent(e,t)}};Ember.View.reopen(e),Ember.TextSupport.reopen(e)}(),Flame.KEY_BINDINGS={8:"deleteBackward",9:"insertTab",13:"insertNewline",27:"cancel",32:"insertSpace",37:"moveLeft",38:"moveUp",39:"moveRight",40:"moveDown",46:"deleteForward"},Flame.MODIFIED_KEY_BINDINGS={8:"deleteForward",9:"insertBacktab",37:"moveLeftAndModifySelection",38:"moveUpAndModifySelection",39:"moveRightAndModifySelection",40:"moveDownAndModifySelection"},Flame.ALLOW_BROWSER_DEFAULT_HANDLING={},Ember.mixin(Flame,{mouseResponderView:undefined,keyResponderStack:Ember.Object.create({_stack:[],currentKeyResponder:function(){return this.current()}.property(),current:function(){var e=this._stack.get("length");return e>0?this._stack.objectAt(e-1):undefined},push:function(e){return Ember.none(e)||(e.willBecomeKeyResponder&&e.willBecomeKeyResponder(),e.set&&!e.isDestroyed&&e.set("isFocused",!0),this._stack.push(e),e.didBecomeKeyResponder&&e.didBecomeKeyResponder(),this.propertyDidChange("currentKeyResponder")),e},pop:function(){if(this._stack.get("length")>0){var e=this.current();e&&e.willLoseKeyResponder&&e.willLoseKeyResponder();var t=this._stack.pop();return t.set&&!t.isDestroyed&&t.set("isFocused",!1),t.didLoseKeyResponder&&t.didLoseKeyResponder(),this.propertyDidChange("currentKeyResponder"),t}return undefined},replace:function(e){if(this.current()!==e)return this.pop(),this.push(e)}})}),Ember.$(document).on("keydown.flame keypress.flame",null,function(e,t){return Flame.keyResponderStack.current()!==undefined&&Flame.keyResponderStack.current().get("isVisible")?Flame.keyResponderStack.current().handleKeyEvent(e,Flame.keyResponderStack.current()):!0}),Flame.EventManager={acceptsKeyResponder:!1,becomeKeyResponder:function(e){if(this.get("acceptsKeyResponder")!==!1&&!this.get("isDisabled"))e===undefined||e===!0?Flame.keyResponderStack.replace(this):Flame.keyResponderStack.push(this);else{var t=this.get("parentView");if(t&&t.becomeKeyResponder)return t.becomeKeyResponder(e)}},resignKeyResponder:function(){Flame.keyResponderStack.pop()},eventManager:{mouseDown:function(e,t){t.becomeKeyResponder(),Flame.set("mouseResponderView",undefined);var n=this._dispatch("mouseDown",e,t);return n&&Flame.set("mouseResponderView",n),!n},mouseUp:function(e,t){return Flame.get("mouseResponderView")!==undefined&&(t=Flame.get("mouseResponderView"),Flame.set("mouseResponderView",undefined)),!this._dispatch("mouseUp",e,t)},mouseMove:function(e,t){return Flame.get("mouseResponderView")!==undefined&&(t=Flame.get("mouseResponderView")),!this._dispatch("mouseMove",e,t)},keyDown:function(e){return Flame.keyResponderStack.current()!==undefined&&Flame.keyResponderStack.current().get("isVisible")?Flame.keyResponderStack.current().handleKeyEvent(e,Flame.keyResponderStack.current()):!0},keyPress:function(e){return Flame.keyResponderStack.current()!==undefined&&Flame.keyResponderStack.current().get("isVisible")?Flame.keyResponderStack.current().handleKeyEvent(e,Flame.keyResponderStack.current()):!0},_dispatch:function(e,t,n){window.FlameInspector&&FlameInspector.logEvent(t,e,n);var r=n.get(e);if(r){var i=r.call(n,t,n);if(i===Flame.ALLOW_BROWSER_DEFAULT_HANDLING)return!1;if(i)return n}var s=n.get("parentView");return s?this._dispatch(e,t,s):!1}}},Flame.FocusSupport={didBecomeKeyResponder:function(){this.$().focus()},didLoseKeyResponder:function(){this.$().blur()},focusIn:function(){Flame.keyResponderStack.current()!==this&&this.becomeKeyResponder()},focusOut:function(){Flame.keyResponderStack.current()===this&&this.resignKeyResponder()}},Flame.FullscreenSupport={isFullscreen:!1,_oldAttributes:undefined,_pane:undefined,_button:undefined,modalPane:function(){return Flame.View.create({layout:{left:0,top:0,right:0,bottom:0},classNames:["flame-fullscreen-pane"],owner:undefined})}.property(),closeButton:function(){return Flame.ButtonView.create({layout:{right:3,top:3,width:24,height:24},classNames:["flame-fullscreen-close"],handlebars:"<img style='margin: 3px;' src='%@'>".fmt(Flame.image("fullscreen_off.png")),action:function(){this.getPath("owner").exitFullscreen()}})}.property(),enterFullscreen:function(){if(!this.get("isFullscreen")){var e,t;this.set("_pane",e=this.get("modalPane")),this.set("_button",t=this.get("closeButton")),e.set("owner",this),t.set("owner",this),e.append(),t.append();var n=this.$(),r={left:n.css("left"),top:n.css("top"),right:n.css("right"),bottom:n.css("bottom"),width:n.css("width"),height:n.css("height"),position:n.css("position"),zIndex:n.css("zIndex")};r.left!=="auto"&&r.right!=="auto"&&(r.width=undefined),r.top!=="auto"&&r.bottom!=="auto"&&(r.height=undefined),this.set("_oldAttributes",r),n.css({left:0,top:0,right:0,bottom:0,width:"",height:"",position:"fixed",zIndex:"50"}),this.set("isFullscreen",!0)}},exitFullscreen:function(){this.get("isFullscreen")&&(this.$().css(this.get("_oldAttributes")),this.get("_pane").remove(),this.get("_button").remove(),this.set("isFullscreen",!1))}},Flame.LayoutSupport={useAbsolutePosition:!0,concatenatedProperties:["displayProperties"],layout:{left:0,right:0,top:0,bottom:0},defaultWidth:undefined,defaultHeight:undefined,layoutManager:undefined,rootView:!1,_layoutProperties:["left","right","top","bottom","width","height"],_cssProperties:["left","right","top","bottom","width","height","margin-left","margin-top"],_layoutChangeInProgress:!1,_layoutSupportInitialized:!1,init:function(){this._super(),this._initLayoutSupport(),this.consultLayoutManager(),this.updateLayout()},createChildView:function(e,t){return e=this._super(e,t),Flame._bindPrefixedBindings(e),e},didInsertElement:function(){this._super(),this.consultLayoutManager()},childViewsDidChange:function(){this._super.apply(this,arguments),this.consultLayoutManager()},_initLayoutSupport:function(){var e=Ember.Object.create(Ember.copy(this.get("layout")));e.width===undefined&&e.right===undefined&&this.get("defaultWidth")!==undefined&&(e.width=this.get("defaultWidth")),e.height===undefined&&(e.top===undefined||e.bottom===undefined)&&this.get("defaultHeight")!==undefined&&(e.height=this.get("defaultHeight")),this.set("layout",e),this.addObserver("layout",this,this.updateLayout),this._layoutSupportInitialized=!0},_renderElementAttributes:function(e){if(!this.get("useAbsolutePosition"))return;var t=this.get("layout")||{};this._resolveLayoutBindings(t);var n=this._translateLayout(t);this._cssProperties.forEach(function(t){var r=n[t];Ember.none(r)||e.style(t,r)}),t.zIndex!==undefined&&e.style("z-index",t.zIndex);var r=this.get("backgroundColor");r!==undefined&&e.style("background-color",r),e.addClass("flame-view")},render:function(e){return this._renderElementAttributes(e),this._super(e)},_resolveLayoutBindings:function(e){if(e._bindingsResolved)return;var t=this;this._layoutProperties.forEach(function(n){var r=e[n];!Ember.none(r)&&"string"==typeof r&&r!==""&&isNaN(parseInt(r,10))&&(t.addObserver(r,t,function(){t.adjustLayout(n,t.getPath(r))}),e[n]=t.getPath(r))}),e._bindingsResolved=!0},_translateLayout:function(e){var t={};return t.width=e.width,e.centerX===undefined?(t.left=e.left,t.right=e.right):(t.left="50%",t["margin-left"]=-((e.width||0)/2)+e.centerX+"px"),t.height=e.height,e.centerY===undefined?(t.top=e
.top,t.bottom=e.bottom):(t.top="50%",t["margin-top"]=-((e.height||0)/2)+e.centerY+"px"),this._cssProperties.forEach(function(e){var n=t[e];n!==undefined&&("number"==typeof n||parseInt(n,10).toString()===n)&&(t[e]=n+"px")}),t},consultLayoutManager:function(){if(!this._layoutSupportInitialized)return;if(!this._layoutChangeInProgress){this._layoutChangeInProgress=!0;try{var e=this.get("layoutManager");e!==undefined&&e.setupLayout(this)}finally{this._layoutChangeInProgress=!1}}},layoutDidChangeFor:function(e){this.consultLayoutManager()},adjustLayout:function(e,t,n){var r=this.get("layout"),i=r[e],s;if(t!==undefined)s=t;else{if(n===undefined)throw"Give either a new value or an increment!";s=i+n}i!==s&&(r[e]=s,this.updateLayout())},updateLayout:function(){if(this.get("useAbsolutePosition")){var e=this._translateLayout(this.get("layout")||{}),t=this.get("element");t&&jQuery(t).css(e)}var n=this.get("parentView");n&&n.layoutDidChangeFor&&n.layoutDidChangeFor(this)}.observes("isVisible"),isVisible:!0,_isVisibleWillChange:function(){var e;this.get("isVisible")?e="willBecomeHidden":e="willBecomeVisible",this.invokeRecursively(function(t){t[e]&&t[e].apply(t)})}.observesBefore("isVisible")},Flame.LayoutManager=Ember.Object.extend({setupLayout:undefined}),Flame.VerticalStackLayoutManager=Flame.LayoutManager.extend({topMargin:0,bottomMargin:0,spacing:0,setupLayout:function(e){var t=this,n=t.get("topMargin"),r=!1,i=!0,s=e.get("childViews").filter(function(e){return e.get("ignoreLayoutManager")!==!0&&(e.get("isVisible")||e.get("isVisible")===null)&&e.get("layout")}),o=s.get("length");s.forEach(function(e,s){if("string"==typeof e)throw"Child views have not yet been initialized!";i?i=!1:n+=t.get("spacing");var u=e.get("layout");e._resolveLayoutBindings(u),n+=u.topMargin||0,e.adjustLayout("top",n),n+=(u.topPadding||0)+(u.bottomPadding||0);var a=u.height;"string"==typeof a&&(a=parseInt(a,10)),s<o-1,Ember.none(u.height)?r=!0:n+=a}),r||(n+=this.get("bottomMargin"),e.adjustLayout("height",n))}}),Ember.View.reopen({firstDescendantWithProperty:function(e){var t;return this.forEachChildView(function(n){t===undefined&&(n.get(e)?t=n:t=n.firstDescendantWithProperty(e))}),t}}),Flame.reopen({ALIGN_LEFT:"align-left",ALIGN_RIGHT:"align-right",ALIGN_CENTER:"align-center",POSITION_BELOW:1,POSITION_RIGHT:2,POSITION_LEFT:4,POSITION_ABOVE:8,POSITION_MIDDLE:16,FOCUS_RING_MARGIN:3}),Flame.View=Ember.ContainerView.extend(Flame.LayoutSupport,Flame.EventManager,{displayProperties:[],isFocused:!1,init:function(){this._super(),this.get("template")&&this.set("states",Ember.View.states);var e=this.get("displayProperties")||[];for(var t=0;t<e.length;t++){var n=e[t];this.addObserver(n,this,this.rerender)}},render:function(e){this._renderElementAttributes(e);var t=this.get("template");if(!t)return this._super(e);var n=t(this.get("templateContext"),{data:{view:this,buffer:e,isRenderData:!0,keywords:{}}});n!==undefined&&e.push(n)},template:function(e,t){if(e==="template"&&t!==undefined)return t;var n=this.get("handlebars");return n?this._compileTemplate(n):null}.property("templateName","handlebars").cacheable(),_compileTemplate:function(e){var t=Flame._templateCache[e];return t||(Flame._templateCache[e]=t=Ember.Handlebars.compile(e)),t}}),Flame._templateCache={},Flame.ImageView=Flame.View.extend({templateContext:function(){return{value:this.get("value")}}.property("value"),handlebars:'<img {{bindAttr src="value"}}>'}),Flame.RootView=Flame.View.extend({rootView:!0}),Flame.LabelView=Flame.View.extend(Flame.ActionSupport,{layout:{left:0,top:0},classNames:["flame-label-view"],classNameBindings:["textAlign","isSelectable","isDisabled"],defaultHeight:22,defaultWidth:200,isSelectable:!1,isDisabled:!1,allowWrapping:!1,handlebars:"{{value}}",render:function(e){var t=this.getPath("layout.height");this.get("useAbsolutePosition")&&!Ember.none(t)&&!this.get("allowWrapping")&&e.style("line-height",t+"px"),this._super(e)},mouseDown:function(e){return this.fireAction()},mouseUp:function(e){return!0},touchStart:function(e){return this.fireAction()},touchEnd:function(e){return!0}}),Flame.LabelView.reopenClass({label:function(e,t,n,r,i){return Flame.LabelView.extend({layout:{left:t,top:n,width:r,height:i},value:e})},binding:function(e,t,n,r,i){return Flame.LabelView.extend({layout:{left:t,top:n,width:r,height:i},valueBinding:e})}}),Flame._zIndexCounter=100,Flame.Panel=Flame.RootView.extend({classNames:["flame-panel"],childViews:["titleView","contentView","resizeView"],destroyOnClose:!0,acceptsKeyResponder:!0,isModal:!0,allowClosingByClickingOutside:!0,allowMoving:!1,dimBackground:!0,title:null,isShown:!1,isResizable:!1,minHeight:52,minWidth:100,_keyResponderOnPopup:undefined,init:function(){this._super()},titleView:Flame.View.extend(Flame.Statechart,{layout:{left:0,right:0,height:26,bottomPadding:1},classNames:["flame-panel-title"],childViews:["labelView"],isVisible:Flame.computed.notEquals("parentView.title",null),initialState:"idle",labelView:Flame.LabelView.extend({layout:{left:4,right:4,top:2},textAlign:Flame.ALIGN_CENTER,valueBinding:"parentView.parentView.title"}),idle:Flame.State.extend({mouseDown:function(e){var t=this.get("owner");if(!t.getPath("parentView.allowMoving"))return!0;t._pageX=e.pageX,t._pageY=e.pageY;var n=t.get("parentView").$().offset();return t._panelX=n.left,t._panelY=n.top,this.gotoState("moving"),!0},touchStart:function(e){return this.mouseDown(this.normalizeTouchEvents(e)),!0}}),moving:Flame.State.extend({mouseMove:function(e){var t=this.get("owner"),n=t._panelX+(e.pageX-t._pageX),r=t._panelY+(e.pageY-t._pageY),i=t.get("parentView").$();return n=Math.max(5,Math.min(n,Ember.$(window).width()-i.outerWidth()-5)),r=Math.max(5,Math.min(r,Ember.$(window).height()-i.outerHeight()-5)),i.css({left:n,top:r,right:"",bottom:"",marginLeft:"",marginTop:""}),!0},touchMove:function(e){return e.preventDefault(),this.mouseMove(this.normalizeTouchEvents(e)),!0},mouseUp:Flame.State.gotoHandler("idle"),touchEnd:Flame.State.gotoHandler("idle")})}),resizeView:Flame.View.extend(Flame.Statechart,{layout:{bottom:3,right:3,height:16,width:16},ignoreLayoutManager:!0,classNames:["flame-resize-thumb"],isVisibleBinding:"^isResizable",initialState:"idle",idle:Flame.State.extend({mouseDown:function(e){var t=this.get("owner"),n=t.get("parentView").$();return t.getPath("parentView.isResizable")?(t._pageX=e.pageX,t._pageY=e.pageY,t._startW=n.outerWidth(),t._startH=n.outerHeight(),this.gotoState("resizing"),!0):!0},touchStart:function(e){return this.mouseDown(this.normalizeTouchEvents(e)),!0}}),resizing:Flame.State.extend({mouseMove:function(e){var t=this.get("owner"),n=t.get("parentView"),r=t._startW+(e.pageX-t._pageX),i=t._startH+(e.pageY-t._pageY);return r=Math.max(n.get("minWidth"),r),i=Math.max(n.get("minHeight"),i),n.$().css({width:r,height:i}),!0},touchMove:function(e){return e.preventDefault(),this.mouseMove(this.normalizeTouchEvents(e)),!0},mouseUp:Flame.State.gotoHandler("idle"),touchEnd:Flame.State.gotoHandler("idle")})}),modalPane:function(){return Flame.RootView.create({layout:{left:0,top:0,right:0,bottom:0},classNames:["flame-modal-pane"],classNameBindings:["parentPanel.dimBackground"],parentPanel:null,mouseDown:function(){return this.getPath("parentPanel.allowClosingByClickingOutside")&&this.get("parentPanel").close(),!0},touchStart:function(){return this.getPath("parentPanel.allowClosingByClickingOutside")&&this.get("parentPanel").close(),!0}})}.property(),insertNewline:function(e){var t=this.firstDescendantWithProperty("isDefault");return t&&t.simulateClick&&t.simulateClick(),!0},_layoutRelativeTo:function(e,t){t=t||Flame.POSITION_BELOW;var n=this.get("layout"),r=e instanceof jQuery?e:e.$(),i=r.offset(),s=this.get("childViews")[0];s&&s.get("layout")&&s.get("layout").height&&(!n||!n.height)&&(n.height=s.get("layout").height),t&(Flame.POSITION_BELOW|Flame.POSITION_ABOVE)?(n.top=i.top+(t&Flame.POSITION_BELOW?r.outerHeight():-n.height),n.left=i.left,t&Flame.POSITION_MIDDLE&&(n.left=n.left-n.width/2+r.outerWidth()/2)):t&(Flame.POSITION_RIGHT|Flame.POSITION_LEFT)&&(n.top=i.top,n.left=i.left+(t&Flame.POSITION_RIGHT?r.outerWidth():-n.width),t&Flame.POSITION_MIDDLE&&(n.top=n.top-n.height/2+r.outerHeight()/2));var o=Ember.$(window);return n.left+n.width>o.width()-10&&(n.left=o.width()-n.width-10,n.movedX=!0),t&Flame.POSITION_BELOW&&n.top+n.height>o.height()-10&&i.top-n.height>=0||t&Flame.POSITION_ABOVE&&n.top<0?n.movedY=!0:n.top<0&&(n.top=10),n},popup:function(e,t){if(!this.get("isShown")){if(this.get("isModal")){var n=this.get("modalPane");n.set("parentPanel",this),n.get("layout").zIndex=Flame._zIndexCounter,n.append(),this.set("_modalPane",n)}e&&this.set("layout",this._layoutRelativeTo(e,t)),this.get("layout").zIndex=Flame._zIndexCounter+10,Flame._zIndexCounter+=100,this.append(),this.set("isShown",!0),this.get("acceptsKeyResponder")&&this.becomeKeyResponder(!1),this._focusDefaultInput()}},close:function(){if(this.isDestroyed)return;this.get("isShown")&&(this.get("isModal")&&(this.get("_modalPane").remove(),this.get("_modalPane").destroy()),this.remove(),this.set("isShown",!1),this.get("acceptsKeyResponder")&&this.resignKeyResponder(),Flame._zIndexCounter-=100,this.get("destroyOnClose")&&this.destroy())},_focusDefaultInput:function(){Ember.run.next(this,function(){var e=this.firstDescendantWithProperty("isDefaultFocus");e&&e.becomeKeyResponder()})}}),Flame.ButtonView=Flame.View.extend(Flame.ActionSupport,Flame.Statechart,{defaultHeight:24,classNames:["flame-button-view"],classNameBindings:["isHovered","isActive","isSelected","isDisabled","isDefault","isFocused"],acceptsKeyResponder:!0,isHovered:!1,isActive:!1,isSelected:!1,isDisabled:!1,isDefault:!1,isSticky:!1,initialState:"idle",handlebars:"<label class='flame-button-label'>{{title}}</label>",render:function(e){var t=this.getPath("layout.height");this.get("useAbsolutePosition")&&!Ember.none(t)&&e.style("line-height",t-2+"px"),this._super(e)},insertSpace:function(e){return this.simulateClick(),!0},idle:Flame.State.extend({mouseEnter:function(){return this.gotoState("hover"),!0},touchStart:function(e){return this.gotoState("mouseDownInside"),!0},simulateClick:function(){this.gotoState("hover"),this.get("owner").simulateClick(),Ember.run.later(this.get("owner"),"mouseLeave",150)}}),hover:Flame.State.extend({mouseLeave:function(){return this.gotoState("idle"),!0},mouseDown:function(){return this.getPath("owner.isDisabled")||this.gotoState("mouseDownInside"),!0},simulateClick:function(){this.mouseDown(),Ember.run.later(this.get("owner"),"mouseUp",100)},enterState:function(){this.get("owner").set("isHovered",!0)},exitState:function(){var e=this.get("owner");e.isDestroyed||e.set("isHovered",!1)}}),mouseDownInside:Flame.State.extend({_handleClick:function(){var e=this.get("owner");e.fireAction(),e.get("isSticky")&&e.set("isSelected",!e.get("isSelected"))},mouseUp:function(){return this._handleClick(),this.gotoState("hover"),!0},touchEnd:function(e){return this._handleClick(),this.gotoState("idle"),!0},mouseLeave:function(){return this.gotoState("mouseDownOutside"),!0},enterState:function(){this.get("owner").set("isActive",!0)},exitState:function(){this.get("owner").set("isActive",!1)}}),mouseDownOutside:Flame.State.extend({mouseUp:function(){return this.gotoState("idle"),!0},mouseEnter:function(){return this.gotoState("mouseDownInside"),!0}})}),Flame.AlertPanel=Flame.Panel.extend(),Flame.AlertPanel.INFO_ICON=Flame.image("info_icon.png"),Flame.AlertPanel.WARN_ICON=Flame.image("warn_icon.png"),Flame.AlertPanel.ERROR_ICON=Flame.image("error_icon.png"),Flame.AlertPanel.reopen({layout:{centerX:0,centerY:-50,width:400,height:155},classNames:"flame-alert-panel".w(),icon:Flame.AlertPanel.INFO_ICON,isModal:!0,allowClosingByClickingOutside:!1,allowMoving:!0,isCancelVisible:!0,isConfirmVisible:!0,isCloseable:!0,title:"",message:"",cancelButtonTitle:"Cancel",confirmButtonTitle:"OK",contentView:Flame.View.extend({layout:{left:15,right:15,top:36,bottom:15},childViews:"iconView messageView cancelButtonView okButtonView".w(),iconView:Flame.ImageView.extend({layout:{left:10,top:10},valueBinding:"^icon"}),messageView:Flame.LabelView.extend({layout:{left:75,top:10,right:2,bottom:30},valueBinding:"^message"}),cancelButtonView:Flame.ButtonView.extend({layout:{width:90,bottom:2,right:110},titleBinding:"^cancelButtonTitle",isVisibleBinding:"^isCancelVisible",action:function(){this.getPath("parentView.parentView").onCancel()}}),okButtonView:Flame.ButtonView.extend({layout:{width:90,bottom:2,right:2},titleBinding:"^confirmButtonTitle",isVisibleBinding:"^isConfirmVisible",isDefault:!0,action:function(){this.getPath("parentView.parentView").onConfirm()}})}),cancel:function(){this.onCancel()},onConfirm:function(){this.get("isCloseable")&&this.close()},onCancel:function(){this.get("isCloseable")&&this.close()}}),Flame.AlertPanel.reopenClass({info:function(e){return e=jQuery.extend(e||{},{icon:Flame.AlertPanel.INFO_ICON,isCancelVisible:!1}),Flame.AlertPanel.create(e)},warn:function(e){return e=jQuery.extend(e||{},{icon:Flame.AlertPanel.WARN_ICON}),Flame.AlertPanel.create(e)},error:function(e){return e=jQuery.extend(e||{},{icon:Flame.AlertPanel.ERROR_ICON}),Flame.AlertPanel.create(e)}}),Flame.CollectionView=Ember.CollectionView.extend(Flame.LayoutSupport,Flame.EventManager,{classNames:["flame-list-view"]}),Flame.MenuScrollViewButton=Flame.View.extend({classNames:"scroll-element".w(),classNameBindings:"directionClass isShown".w(),directionClass:function(){return"scroll-%@".fmt(this.get("direction"))}.property(),isShown:!1,direction:"down",useAbsolutePosition:!0,mouseLeave:function(){return this.get("isShown")?(this.get("parentView").stopScrolling(),!0):!1},mouseEnter:function(){return this.get("isShown")?(this.get("parentView").startScrolling(this.get("direction")==="up"?-1:1),!0):!1},mouseDown:function(){return!0},mouseUp:function(){return!0}}),Flame.MenuScrollView=Flame.View.extend({classNames:"menu-scroll-view".w(),useAbsolutePosition:!0,needScrolling:!1,scrollDirection:0,scrollPosition:"top",childViews:"upArrow viewPort downArrow".w(),scrollSize:10,viewPort:Flame.View.extend({useAbsolutePosition:!0,classNames:"scroll-view-viewport".w()}),upArrow:Flame.MenuScrollViewButton.extend({direction:"up",layout:{height:20,top:0,width:"100%"}}),downArrow:Flame.MenuScrollViewButton.extend({direction:"down",layout:{height:20,bottom:0,width:"100%"}}),willDestroyElement:function(){this._super(),this.stopScrolling()},setScrolledView:function(e){this.getPath("viewPort.childViews").replace(0,1,[e])},scrollPositionDidChange:function(){var e=this.get("upArrow"),t=this.get("downArrow"),n=this.get("scrollPosition");e.set("isShown",this.get("needScrolling")&&n!=="top"),t.set("isShown",this.get("needScrolling")&&n!=="bottom")}.observes("scrollPosition","needScrolling"),startScrolling:function(e){this.set("scrollDirection",e),this.scroll()},stopScrolling:function(){this.set("scrollDirection",0),this._timer&&Ember.run.cancel(this._timer)},_recalculateSizes:function(){var e=this.getPath("parentView.layout.height");if(e>0){var t=12;this.set("layout",{height:e-t,width:"100%"});var n=this.get("viewPort");n&&n.set("layout",{height:e-t,top:0,width:"100%"})}}.observes("parentView.layout.height","needScrolling"),_scrollTo:function(e,t){var n=this.get("viewPort").$();n.scrollTop(e)},scroll:function(){var e=this.get("scrollDirection"),t=20,n=this.get("scrollSize"),r=this.get("viewPort").$(),i=r.scrollTop(),s=r.height(),o=!0,u=this.get("scrollPosition"),a=n;if(e===-1)a>i&&(a=i,o=!1);else if(e===1){var f=this.getPath("viewPort.childViews.firstObject").$().outerHeight(),l=i+s;l+a>=f&&(a=f-l,o=!1)}a*=e,this._scrollTo(i+a,.9*t*Math.abs(a/n)),o?(this._timer=Ember.run.later(this,this.scroll,t),u="middle"):(e===1?u="bottom":e===-1&&(u="top"),this.stopScrolling()),this.set("scrollPosition",u)}}),Flame.MenuItem=function(e){var t;for(t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);this.renderToElement=function(){var e=["flame-view","flame-list-item-view","flame-menu-item-view"];this.isSelected&&e.push("is-selected"),this.isChecked&&e.push("is-checked");var t=Ember.none(this.subMenuItems)?-1:this.subMenuItems.get("length"),n=["menu-indicator"];this.isEnabled()?t>0&&n.push("is-enabled"):e.push("is-disabled");var r=Handlebars.Utils.escapeExpression(this.title),i="<div id='%@' class='%@'><div class='title'>%@</div><div class='%@'></div></div>",s=i.fmt(this.id,e.join(" "),r,n.join(" "));return s},this.isEnabled=function(){return!(this.isDisabled||this.subMenuItems&&this.subMenuItems.length===0)},this.isSelectable=function(){return this.isEnabled()&&!this.subMenuItems},this.elementSelector=function(){return Ember.$("#%@".fmt(this.id))},this.closeSubMenu=function(){var e=this.subMenuView;Ember.none(e)||(e.close(),this.subMenuView=null)}},Flame.MenuView=Flame.Panel.extend(Flame.ActionSupport,{classNames:["flame-menu"],childViews:["contentView"],contentView:Flame.MenuScrollView,dimBackground:!1,subMenuKey:"subMenu",itemTitleKey:"title",itemEnabledKey:"isEnabled",itemCheckedKey:"isChecked",itemValueKey:"value",itemActionKey:"action",itemHeight:21,menuMargin:12,minWidth:null,items:null,parentMenu:null,value:null,_allItemsDoNotFit:!0,_anchorElement:null,_menuItems:null,highlightIndex:-1,userHighlightIndex:-1,internalSelection:undefined,init:function(){this._super(),this._needToRecreateItems()},_calculateMenuWidth:function(){var e=this.get("items")||[];if(Ember.get(e,"length")===0)return;var t=this.get("itemTitleKey"),n=e.reduce(function(e,n){var r=Ember.get(n,t);return e+r+"<br/>"},"");return Flame.measureString(n,"ember-view flame-view flame-list-item-view flame-menu-item-view","title").width+16},_createMenuItems:function(){var e=this.get("items"),t=this.get("itemCheckedKey"),n=this.get("itemEnabledKey"),r=this.get("itemTitleKey"),i=this.get("itemValueKey"),s=this.get("subMenuKey"),o=this.get("value"),u;return u=(e||[]).map(function(e,u){return new Flame.MenuItem({item:e,isSelected:Ember.get(e,i)===o,isDisabled:Ember.get(e,n)===!1,isChecked:Ember.get(e,t),subMenuItems:Ember.get(e,s),title:Ember.get(e,r),id:this._indexToId(u)})},this),u},_needToRecreateItems:function(){var e=this._createMenuItems();this.set("_menuItems",e),Ember.none(this.get("parentMenu"))&&e.forEach(function(e,t){e.isSelected&&this.set("highlightIndex",t)},this),this.getPath("contentView").setScrolledView(this._createMenuView()),this.get("_anchorElement")&&this._updateMenuSize()}.observes("items","elementId"),_createMenuView:function(){var e=this.get("_menuItems");return Flame.View.create({useAbsolutePosition:!1,render:function(t){var n=e.map(function(e){return e.renderToElement()});t.push(n.join(""))}})},makeSelection:function(){var e=this.get("parentMenu"),t,n;if(!Ember.none(e))e.makeSelection(),this.close();else{var r=this.get("internalSelection");typeof r!="undefined"&&(n=Ember.get(r,this.get("itemValueKey")),this.set("value",n),t=Ember.get(r,this.get("itemActionKey"))||this.get("action")),Ember.run.sync(),this.close(),Ember.none(t)||this.fireAction(t,n)}},createSubMenu:function(e){return Flame.MenuView.create({items:e,parentMenu:this,subMenuKey:this.get("subMenuKey"),itemEnabledKey:this.get("itemEnabledKey"),itemTitleKey:this.get("itemTitleKey"),itemValueKey:this.get("itemValueKey"),itemHeight:this.get("itemHeight"),isModal:!1})},closeCurrentlyOpenSubMenu:function(){var e=this.get("highlightIndex");e>=0&&this.get("_menuItems").objectAt(e).closeSubMenu()},popup:function(e,t){Ember.none(this.get("parentMenu"))&&(this._openedAt=(new Date).getTime());var n=e instanceof jQuery?e:e.$();this._super(n,t),this.set("_anchorElement",n),this._updateMenuSize()},_updateMenuSize:function(){var e=this.get("_anchorElement"),t=5,n=5,r=1,i=t+n,s=this.get("menuMargin"),o=this.get("_menuItems").get("length")*this.get("itemHeight")+i+2*r,u=$(window).height(),a=e.offset().top,f=e.outerHeight(),l=this.get("layout"),c=!Ember.none(this.get("parentMenu")),h=u-a+(c?r+t:-f),p=!1;o+s*2<=u?c&&h>=o+s?l.set("top",a-(r+t)):h<o+s&&l.set("top",u-(o+s)):(o=u-2*s,l.set("top",s),p=!0),l.set("height",o);if(!l.width){var d=Math.max(this.get("minWidth")||0,this._calculateMenuWidth());l.set("width",d)}this.set("layout",l),this.get("contentView").set("needScrolling",p)},close:function(){if(this.isDestroyed)return;this.set("highlightIndex",-1),this._clearKeySearch(),this._super()},mouseDown:function(){return!0},cancel:function(){this.close()},moveUp:function(){return this._selectNext(-1)},moveDown:function(){return this._selectNext(1)},moveRight:function(){return this._tryOpenSubmenu(!0),!0},moveLeft:function(){var e=this.get("parentMenu");return Ember.none(e)||e.closeCurrentlyOpenSubMenu(),!0},insertNewline:function(){return this.makeSelection(),!0},keyPress:function(e){var t=String.fromCharCode(e.which);return e.which>31&&t!==""?(this._doKeySearch(t),!0):!1},handleMouseEvents:function(e){var t=this._idToIndex(e.currentTarget.id),n=!1;return e.type==="mouseenter"?n=this.mouseEntered(t):e.type==="mouseup"?n=this.mouseClicked(t):e.type==="mousedown"&&(n=!0),!n},mouseClicked:function(e){if(Ember.none(this.get("parentMenu"))&&(new Date).getTime()-this._openedAt<100)return;return this.set("highlightIndex",e),this.get("userHighlightIndex")>=0&&this.makeSelection(),!0},mouseEntered:function(e){return this.set("userHighlightIndex",e),this._tryOpenSubmenu(!1),!0},_selectNext:function(e){var t=this.get("_menuItems"),n=t.get("length"),r,i=this.get("highlightIndex")+e;for(;i>=0&&i<n;i+=e){r=t.objectAt(i);if(r.isEnabled()){this.set("highlightIndex",i);break}}return this._clearKeySearch(),!0},_valueDidChange:function(){var e=this.get("value"),t=this.get("itemValueKey");if(!Ember.none(e)&&!Ember.none(t)){var n=this._findIndex(function(n){return Ember.get(n,t)===e});n>=0&&this.set("highlightIndex",n)}}.observes("value"),_internalSelectionDidChange:function(){var e=this.get("internalSelection");Ember.trySetPath(this,"parentMenu.internalSelection",e)}.observes("internalSelection"),_findIndex:function(e){var t=this.get("items"),n=0,r=t.get("length");for(;n<r;n++)if(e(t.objectAt(n)))return n;return-1},_findByName:function(e){var t=new RegExp("^"+e,"i"),n=this.get("itemTitleKey");return this._findIndex(function(e){return t.test(Ember.get(e,n))})},_toggleClass:function(e,t,n){var r=this.get("_menuItems").objectAt(t);r.elementSelector().toggleClass(e,n)},_highlightWillChange:function(){var e=this.get("highlightIndex"),t=this.get("_menuItems").objectAt(e);Ember.none(t)||(this._toggleClass("is-selected",e),t.isSelected=!1,t.closeSubMenu())}.observesBefore("highlightIndex"),_highlightDidChange:function(){var e=this.get("highlightIndex"),t=this.get("_menuItems").objectAt(e),n;Ember.none(t)||(this._toggleClass("is-selected",e),t.isSelected=!0,t.isSelectable()&&(n=t.item)),this.set("internalSelection",n)}.observes("highlightIndex"),_userHighlightIndexDidChange:function(){this.set("highlightIndex",this.get("userHighlightIndex"))}.observes("userHighlightIndex"),_clearKeySearch:function(){Ember.none(this._timer)||Ember.run.cancel(this._timer),this._searchKey=""},_doKeySearch:function(e){this._searchKey=(this._searchKey||"")+e;var t=this._findByName(this._searchKey);t>=0&&this.set("highlightIndex",t),Ember.none(this._timer)||Ember.run.cancel(this._timer),this._timer=Ember.run.later(this,this._clearKeySearch,1e3)},_indexToId:function(e){return"%@-%@".fmt(this.get("elementId"),e)},_idToIndex:function(e){var t=new RegExp("%@-(\\d+)".fmt(this.get("elementId"))),n=t.exec(e);return n&&n.length===2?parseInt(n[1],10):-1},_tryOpenSubmenu:function(e){var t=this.get("highlightIndex"),n=this.get("_menuItems").objectAt(t);if(!n)return!1;var r=n.subMenuItems;if(!Ember.none(r)&&n.isEnabled()&&r.get("length")>0){this._clearKeySearch();var i=n.subMenuView;return Ember.none(i)&&(i=this.createSubMenu(r),n.subMenuView=i),i.popup(n.elementSelector(),Flame.POSITION_RIGHT),e&&i._selectNext(1),!0}return!1},didInsertElement:function(){this._super();var e=this,t=this.get("elementId"),n="mouseenter.%@ mouseup.%@ mousedown.%@".fmt(t,t,t);Ember.$("#%@".fmt(t)).on(n,".flame-menu-item-view",function(t){return e.handleMouseEvents(t)})}}),Flame.AutocompleteMenuView=Flame.MenuView.extend({keyPress:function(e){return!1},insertTab:function(){return this.close(),!1},moveDown:function(){this.get("textField").didLoseKeyResponder(),this._super()},moveRight:function(){return!1},moveLeft:function(){return!1},close:function(){this._super(),this.get("textField").didBecomeKeyResponder()}}),Flame.CheckboxView=Flame.ButtonView.extend({classNames:["flame-checkbox-view"],isSticky:!0,handlebars:null,render:function(e){this._super(e),e.push("<div class='flame-checkbox-box'></div>"),this.renderCheckMark(e);var t=Ember.none(this.get("title"))?"":this.get("title");e.push("<label class='flame-checkbox-label'>"+t+"</label>")},renderCheckMark:function(e){var t=Flame.image("checkmark.png");e.push("<div class='flame-view flame-checkbox-checkmark' style='left:6px; top:-2px;'><img src='"+t+"'></div>")}}),Flame.SelectButtonView=Flame.ButtonView.extend({classNames:["flame-select-button-view"],items:[],value:undefined,defaultHeight:22,itemTitleKey:"title",itemValueKey:"value",itemActionKey:"action",subMenuKey:"subMenu",handlebars:function(){var e=this.get("itemTitleKey");return'<label {{bindAttr title="_selectedMenuItem.%@"}}>{{_selectedMenuItem.%@}}</label><div><img src="%@"></div>'.fmt(e,e,Flame.image("select_button_arrow.png"))}.property("value","_selectedMenuItem").cacheable(),_selectedMenuItem:function(){if(this.get("value")===undefined)return undefined;var e=this._findItem();return e}.property("value","itemValueKey","subMenuKey","items").cacheable(),itemsDidChange:function(){this.get("items")&&this.getPath("items.length")>0&&!this._findItem()&&this.set("value",this.getPath("items.firstObject.%@".fmt(this.get("itemValueKey"))))}.observes("items"),_findItem:function(e){e||(e=this.get("items"));var t=this.get("itemValueKey"),n=this.get("value"),r=this.get("subMenuKey"),i;return Ember.none(e)?i:(e.forEach(function(e){if(Ember.get(e,r)){var s=this._findItem(Ember.get(e,r));Ember.none(s)||(i=s)}else Ember.get(e,t)===n&&(i=e)},this),i)},menu:function(){var e=this;return Flame.MenuView.extend({selectButtonView:this,itemTitleKey:this.get("itemTitleKey"),itemValueKey:this.get("itemValueKey"),itemActionKey:this.get("itemActionKey"),subMenuKey:this.get("subMenuKey"),itemsBinding:"selectButtonView.items",valueBinding:"selectButtonView.value",minWidth:this.getPath("layout.width")||this.$().width(),close:function(){e.gotoState("idle"),this._super()}})}.property(),mouseDown:function(){return this.get("isDisabled")||this._openMenu(),!0},insertSpace:function(){return this._openMenu(),!0},_openMenu:function(){this.gotoState("mouseDownInside"),this.get("menu").create().popup(this)}}),Flame.TextFieldView=Flame.View.extend(Flame.ActionSupport,{classNames:["flame-text"],childViews:["textField"],acceptsKeyResponder:!0,layout:{left:0,top:0},defaultHeight:22,defaultWidth:200,value:"",placeholder:null,isPassword:!1,isValid:null,isEditableLabel:!1,isVisible:!0,isDisabled:!1,isAutocomplete:!1,autocompleteDelegate:null,name:null,becomeKeyResponder:function(){this.get("textField").becomeKeyResponder()},insertNewline:function(){return this.fireAction()},textField:Ember.TextField.extend(Flame.EventManager,Flame.FocusSupport,{classNameBindings:["isInvalid","isEditableLabel","isFocused"],acceptsKeyResponder:!0,type:Flame.computed.trueFalse("parentView.isPassword","password","text"),isInvalid:Flame.computed.equals("parentView.isValid",!1),valueBinding:"^value",placeholderBinding:"^placeholder",isEditableLabelBinding:"^isEditableLabel",isVisibleBinding:"^isVisible",disabledBinding:"^isDisabled",isAutocompleteBinding:"^isAutocomplete",attributeBindings:["name","disabled"],nameBinding:"^name",keyUp:function(e){return this._elementValueDidChange(),(e.which===8||e.which>31)&&this.get("isAutocomplete")?(this.get("parentView")._fetchAutocompleteResults(),!0):!1},insertNewline:function(){return this._elementValueDidChange(),Ember.run.sync(),!1},cancel:function(){return!1},mouseDown:function(){return Flame.ALLOW_BROWSER_DEFAULT_HANDLING},mouseMove:function(){return Flame.ALLOW_BROWSER_DEFAULT_HANDLING},mouseUp:function(){return Flame.ALLOW_BROWSER_DEFAULT_HANDLING}}),_autocompleteView:null,_fetchAutocompleteResults:function(){var e=this.$("input").val();e?this.get("autocompleteDelegate").fetchAutocompleteResults(e,this):this._closeAutocompleteMenu()},didFetchAutocompleteResults:function(e){if(e.length===0){this._closeAutocompleteMenu();return}!this._autocompleteMenu||this._autocompleteMenu.isDestroyed?(this._autocompleteMenu=Flame.AutocompleteMenuView.create({minWidth:this.$().width(),target:this,textField:this.textField,action:"_selectAutocompleteItem",items:e}),this._autocompleteMenu.popup(this)):this._autocompleteMenu.isDestroyed||this._autocompleteMenu.set("items",e)},_closeAutocompleteMenu:function(){this._autocompleteMenu&&(this._autocompleteMenu.close(),this._autocompleteMenu=null)},_selectAutocompleteItem:function(e){this.set("value",this._autocompleteMenu.get("items").findProperty("value",e).title)}}),Flame.ComboBoxView=Flame.SelectButtonView.extend({classNames:["flame-combo-box-view"],childViews:"textView buttonView".w(),handlebars:undefined,acceptsKeyResponder:!1,textView:Flame.TextFieldView.extend({layout:{left:0,right:3},valueBinding:"parentView.value"}),insertSpace:function(){return!1},buttonView:Flame.ButtonView.extend({acceptsKeyResponder:!1,handlebars:'<img src="%@">'.fmt(Flame.image("select_button_arrow.png")),layout:{right:-2,width:22,height:22},action:function(){this.get("parentView")._openMenu()}})}),Flame.DisclosureView=Flame.LabelView.extend({classNames:["flame-disclosure-view"],imageExpanded:Flame.image("disclosure_triangle_down.png"),imageCollapsed:Flame.image("disclosure_triangle_left.png"),image:function(){return this.get("visibilityTarget")?this.get("imageExpanded"):this.get("imageCollapsed")}.property("visibilityTarget","imageExpanded","imageCollapsed"),handlebars:'<img {{bindAttr src="image"}}> {{value}}',action:function(){var e=this.getPath("visibilityTarget");return this.setPath("visibilityTarget",!e),!0}}),Flame.FormView=Flame.View.extend({classNames:["form-view"],tagName:"form",defaultTarget:null,object:null,leftMargin:20,rightMargin:20,topMargin:20,bottomMargin:20,rowSpacing:10,columnSpacing:10,buttonSpacing:15,labelWidth:150,labelAlign:Flame.ALIGN_RIGHT,buttonWidth:90,controlWidth:null,defaultFocus:null,_focusRingMargin:3,init:function(){this._super(),this.set("layoutManager",Flame.VerticalStackLayoutManager.create({topMargin:this.get("topMargin"),spacing:this.get("rowSpacing"),bottomMargin:this.get("bottomMargin")})),this.set("_errorViews",[]),this.set("controls",[]),this._propertiesDidChange()},_propertiesDidChange:function(){this.destroyAllChildren();var e=this,t=this.get("childViews");this.get("properties").forEach(function(n){var r=e._createLabelAndControl(n);t.push(e.createChildView(r))});var n=this.get("buttons");n&&n.get("length")>0&&t.push(this.createChildView(this._buildButtons(n)))}.observes("properties.@each"),_createLabelAndControl:function(e){e=Ember.Object.create(e);var t=e.view||this._buildControl(e),n=this;if(Ember.none(e.label))return this._createChildViewWithLayout(t,this,this.get("leftMargin")+this._focusRingMargin,this.get("rightMargin")+this._focusRingMargin);if(e.type==="checkbox")return this._createChildViewWithLayout(t,this,this.get("leftMargin")+this.labelWidth+this.columnSpacing-4,this._focusRingMargin);var r={layout:{left:this.get("leftMargin"),right:this.get("rightMargin")},layoutManager:Flame.VerticalStackLayoutManager.create({topMargin:this._focusRingMargin,spacing:0,bottomMargin:this._focusRingMargin}),childViews:["label","control"],isVisible:e.get("isVisible")===undefined?!0:e.get("isVisible"),label:this._buildLabel(e),control:function(){return n._createChildViewWithLayout(t,this,n.labelWidth+n.columnSpacing,n._focusRingMargin)}.property().cacheable()};return e.get("isVisibleBinding")&&(r.isVisibleBinding=e.get("isVisibleBinding")),Flame.View.extend(r)},_createChildViewWithLayout:function(e,t,n,r){var i=t.createChildView(e);return i.get("layout")||i.set("layout",{}),i.setPath("layout.left",n),i.setPath("layout.right",r),i},_buildLabel:function(e){return Flame.LabelView.extend({layout:{left:0,width:this.get("labelWidth"),top:this._focusRingMargin},ignoreLayoutManager:!0,textAlign:this.get("labelAlign"),value:e.get("label")+":",attributeBindings:["title"],title:e.get("label")})},_buildButtons:function(e){var t=this;return Flame.View.extend({layout:{left:this.get("leftMargin"),right:this.get("rightMargin"),topMargin:this.get("buttonSpacing"),height:30},init:function(){this._super();var n=this.get("childViews"),r=t._focusRingMargin,i=this;(e||[]).forEach(function(e){var s=i.createChildView
(t._buildButton(e,r));r+=(s.getPath("layout.width")||0)+15,n.push(s)})}})},_buildButton:function(e,t){var n=jQuery.extend({targetBinding:"^defaultTarget"},e);return n.layout||(n.layout={width:this.get("buttonWidth"),right:t}),n.layout.top=this._focusRingMargin,e.target&&delete n.targetBinding,Flame.ButtonView.extend(n)},_buildValidationObservers:function(e){if(Ember.none(e))return{};var t=this;return{didInsertElement:function(){this._super(),this.isValidDidChange()},isValidWillChange:function(){var e=this.get("_errorView");e&&!this.get("isValid")&&(e.remove(),this.set("_errorView",null),t._errorViews=t._errorViews.without(e))}.observesBefore("isValid"),isValidDidChange:function(){if(!this.get("isValid")&&!this.get("_errorView")){var n=this.$(),r=n.offset();if(Ember.none(r))return;var i=Flame._zIndexCounter,s=e;jQuery.isFunction(e)&&(s=e(this.get("value")));var o=Flame.LabelView.extend({classNames:"flame-form-view-validation-error".w(),textAlign:Flame.ALIGN_LEFT,layout:{top:r.top-7,left:r.left+n.outerWidth()-4,width:null,height:null,zIndex:i},value:s,handlebars:'<div class="error-triangle"></div><div class="error-box">{{value}}</div>'}).create().append();this.set("_errorView",o),t._errorViews.push(o)}}.observes("isValid")}},_performTab:function(e){var t=Flame.keyResponderStack.current();if(t instanceof Ember.TextField||t instanceof Ember.TextArea)t=t.get("parentView");var n=this.get("childViews").mapProperty("childViews").flatten().filter(function(e){return e.get("acceptsKeyResponder")&&e.get("isVisible")}),r=n.indexOf(t);r+=e,r<0?n.objectAt(n.get("length")-1).becomeKeyResponder():r===n.get("length")?n.objectAt(0).becomeKeyResponder():n.objectAt(r).becomeKeyResponder()},insertTab:function(){return this._performTab(1),!0},insertBacktab:function(){return this._performTab(-1),!0},_buildControl:function(e){var t=e.get("property"),n=this.get("object"),r={layout:{topPadding:1,bottomPadding:1,width:this.get("controlWidth")},valueBinding:"^object.%@".fmt(t),isValid:Flame.computed.notEquals("parentView.parentView.object.%@IsValid".fmt(t),!1),isDisabled:Flame.computed.equals("parentView.parentView.object.%@IsDisabled".fmt(t),!0)};this.get("defaultFocus")===t&&(r.isDefaultFocus=!0);var i=e.get("validate");i&&(n.get("validations")||n.set("validations",{}),n.setValidationFor(t,i)),jQuery.extend(r,this._buildValidationObservers(e.get("validation")));var s=e.get("type")||"text";if(e.options||e.optionsBinding)s="select";if(Ember.none(r.action)&&(s==="text"||s==="textarea"||s==="password")){var o=this;r.fireAction=function(){var e=o.firstDescendantWithProperty("isDefault");e&&e.simulateClick&&e.simulateClick()}}return r.classNames=r.classNames||[],r.classNames.push("form-view-"+s),this._buildControlView(r,s,e)},_buildControlView:function(e,t,n){switch(t){case"readonly":return e.isSelectable=n.get("isSelectable")!==!1,e.attributeBindings=["title"],e.titleBinding="value",Flame.LabelView.extend(e);case"text":return n.isAutocomplete&&(e.isAutocomplete=!0,e.autocompleteDelegate=n.autocompleteDelegate),e.name=Ember.none(n.name)?n.property:n.name,Flame.TextFieldView.extend(e);case"textarea":return e.layout.height=n.height||70,Flame.TextAreaView.extend(e);case"password":return e.isPassword=!0,e.name=Ember.none(n.name)?n.property:n.name,Flame.TextFieldView.extend(e);case"html":return Flame.LabelView.extend(jQuery.extend(e,{escapeHTML:!1,formatter:function(e){return e===null?"":e}}));case"checkbox":return e.title=n.label,e.isSelectedBinding=e.valueBinding,delete e.valueBinding,Flame.CheckboxView.extend(e);case"select":return e.itemValueKey=n.itemValueKey||"value",e.subMenuKey=n.subMenuKey||"subMenu",n.optionsBinding?(e.itemTitleKey=n.itemTitleKey||"name",e.itemsBinding=n.optionsBinding):n.options&&(e.itemTitleKey=n.itemTitleKey||"title",e.items=n.options),n.get("allowNew")?Flame.ComboBoxView.extend(e):Flame.SelectButtonView.extend(e)}throw"Invalid control type %@".fmt(t)},willDestroyElement:function(){this._errorViews.forEach(function(e){e.remove()})}}),Flame.SplitView=Flame.View.extend({allowResizing:!0,dividerThickness:7,dividerView:Flame.View.extend(Flame.Statechart,{classNames:"flame-split-view-divider".w(),initialState:"idle",idle:Flame.State.extend({mouseDown:function(e){var t=this.getPath("owner.parentView");return t.get("allowResizing")?(t.startResize(e),this.gotoState("resizing"),!0):!1},touchStart:function(e){return this.mouseDown(this.normalizeTouchEvents(e)),!0},doubleClick:function(e){var t=this.getPath("owner.parentView");return t.get("allowResizing")?(t.toggleCollapse(e),!0):!1}}),resizing:Flame.State.extend({mouseMove:function(e){return this.getPath("owner.parentView").resize(e),!0},touchMove:function(e){return e.preventDefault(),this.mouseMove(this.normalizeTouchEvents(e)),!0},mouseUp:Flame.State.gotoHandler("idle"),touchEnd:Flame.State.gotoHandler("idle")})})}),Flame.HorizontalSplitView=Flame.SplitView.extend({classNames:"flame-horizontal-split-view".w(),childViews:"topView dividerView bottomView".w(),topHeight:100,bottomHeight:100,minTopHeight:0,minBottomHeight:0,flex:"bottom",_unCollapsedTopHeight:undefined,_unCollapsedBottomHeight:undefined,_resizeStartY:undefined,_resizeStartTopHeight:undefined,_resizeStartBottomHeight:undefined,init:function(){this._super(),this.get("flex")==="bottom"?this.bottomHeight=undefined:this.topHeight=undefined,this._updateLayout(),this.addObserver("topHeight",this,this._updateLayout),this.addObserver("bottomHeight",this,this._updateLayout),this.addObserver("minTopHeight",this,this._updateLayout),this.addObserver("minBottomHeight",this,this._updateLayout)},_updateLayout:function(){var e=this.get("topView"),t=this.get("dividerView"),n=this.get("bottomView"),r=this.$().innerHeight(),i=this.get("dividerThickness"),s=this.get("flex")==="bottom"?this.get("topHeight"):undefined,o=this.get("flex")==="top"?this.get("bottomHeight"):undefined;s===undefined&&o!==undefined&&r!==null&&(s=r-o-i),o===undefined&&s!==undefined&&r!==null&&(o=r-s-i),"number"==typeof s&&s<this.get("minTopHeight")&&(o+=s-this.get("minTopHeight"),s=this.get("minTopHeight")),"number"==typeof o&&o<this.get("minBottomHeight")&&(s+=o-this.get("minBottomHeight"),o=this.get("minBottomHeight")),this.set("topHeight",s),this.set("bottomHeight",o),this.get("flex")==="bottom"?(this._setDimensions(e,0,s,undefined),this._setDimensions(t,s,i,undefined),this._setDimensions(n,s+i,undefined,0)):(this._setDimensions(e,0,undefined,o+i),this._setDimensions(t,undefined,i,o),this._setDimensions(n,undefined,o,0))},_setDimensions:function(e,t,n,r){var i=e.get("layout");i.set("left",0),i.set("height",n),i.set("right",0),i.set("top",t),i.set("bottom",r),e.updateLayout()},toggleCollapse:function(e){if(!this.get("allowResizing"))return;this.get("flex")==="bottom"?this.get("topHeight")===this.get("minTopHeight")&&this._unCollapsedTopHeight!==undefined?this.set("topHeight",this._unCollapsedTopHeight):(this._unCollapsedTopHeight=this.get("topHeight"),this.set("topHeight",this.get("minTopHeight"))):this.get("bottomHeight")===this.get("minBottomHeight")&&this._unCollapsedBottomHeight!==undefined?this.set("bottomHeight",this._unCollapsedBottomHeight):(this._unCollapsedBottomHeight=this.get("bottomHeight"),this.set("bottomHeight",this.get("minBottomHeight")))},startResize:function(e){this._resizeStartY=e.pageY,this._resizeStartTopHeight=this.get("topHeight"),this._resizeStartBottomHeight=this.get("bottomHeight")},resize:function(e){this.get("flex")==="bottom"?this.set("topHeight",this._resizeStartTopHeight+(e.pageY-this._resizeStartY)):this.set("bottomHeight",this._resizeStartBottomHeight-(e.pageY-this._resizeStartY))}}),Flame.ListItemView=Flame.View.extend({useAbsolutePosition:!1,classNames:["flame-list-item-view"],classNameBindings:["isSelected","parentView.allowReordering","isDragged"],isSelected:!1,_parentViewOnMouseDown:undefined,displayProperties:["content"],acceptsKeyResponder:!1,childListView:null,mouseMove:function(e){return this._parentViewOnMouseDown!==undefined?this._parentViewOnMouseDown.mouseMove(e):!1},mouseDown:function(e){return this._parentViewOnMouseDown=this.get("parentView"),this._parentViewOnMouseDown.mouseDownOnItem(this.get("contentIndex"),e)},mouseUp:function(e){if(this._parentViewOnMouseDown!==undefined){var t=this._parentViewOnMouseDown;return this._parentViewOnMouseDown=undefined,t.mouseUpOnItem(e)}return!1},touchMove:function(e){return this._parentViewOnMouseDown!==undefined?this._parentViewOnMouseDown.touchMove(e):!1},touchStart:function(e){return this._parentViewOnMouseDown=this.get("parentView"),this._parentViewOnMouseDown.mouseDownOnItem(this.get("contentIndex"),e)},touchEnd:function(e){if(this._parentViewOnMouseDown!==undefined){var t=this._parentViewOnMouseDown;return this._parentViewOnMouseDown=undefined,t.mouseUpOnItem(e)}return!1}}),Flame.LazyListViewStates={},Flame.LazyListViewStates.MouseIsDown=Flame.State.extend({xOffset:null,yOffset:null,exitState:function(){this.xOffset=this.yOffset=null},mouseMove:function(e){var t=this.get("owner");if(!t.getPath("parentView.allowReordering"))return!0;this.xOffset===null&&(this.xOffset=e.pageX,this.yOffset=e.pageY);if(Math.abs(e.pageY-this.yOffset)<3)return!0;var n=t.$().offset();return this.setPath("owner.xOffset",this.xOffset-n.left),this.setPath("owner.yOffset",this.yOffset-n.top),this.gotoState("dragging"),!0},mouseUp:function(){var e=this.get("owner"),t=e.get("parentView");return t.selectIndex(e.get("contentIndex")),this.gotoState("idle"),!0}}),Flame.LazyListItemView=Flame.ListItemView.extend(Flame.Statechart,{layout:{left:0,right:0,height:25},initialState:"idle",init:function(){this._super(),this.set("displayProperties",[])},mouseDown:function(e){return this.invokeStateMethod("mouseDown",e),!0},mouseMove:function(e){return this.invokeStateMethod("mouseMove",e),!0},mouseUp:function(e){return this.invokeStateMethod("mouseUp",e),!0},idle:Flame.State.extend({mouseDown:function(){this.gotoState("mouseIsDown")}}),mouseIsDown:Flame.LazyListViewStates.MouseIsDown,dragging:Flame.State.extend({clone:null,indicator:null,scrollViewOffset:null,enterState:function(){var e=this.get("owner"),t=e.get("parentView");e.willStartDragging&&e.willStartDragging();var n=t.$();this.setPath("owner.isDragged",!0),this.scrollViewOffset=t.get("parentView").$().offset(),this.clone=this.get("owner").$().safeClone(),this.clone.addClass("dragged-clone"),this.clone.draggingInfo={currentIndex:this.getPath("owner.contentIndex")},this.indicator=jQuery('<div class="indicator"><img src="%@"></div>'.fmt(Flame.image("reorder_indicator.png"))).hide(),n.append(this.clone),n.append(this.indicator)},exitState:function(){this.setPath("owner.isDragged",!1),this.finishDragging(),this.clone.remove(),this.clone=null,this.indicator.remove(),this.indicator=null},mouseMove:function(e){var t=this.get("owner"),n=t.get("parentView");this.listViewPosition=n.$().position();var r=n.get("parentView"),i=e.pageY-t.get("yOffset")+r.lastScrollY-(r.lastScrollY+this.listViewPosition.top)-this.scrollViewOffset.top,s=e.pageX-this.scrollViewOffset.left-t.get("xOffset");return this.didDragItem(i,s),!0},mouseUp:function(){return this.gotoState("idle"),!0},didDragItem:function(e,t){this.getPath("owner.parentView.constrainDragginToXAxis")?this.clone.css({top:e}):this.clone.css({top:e,left:t});var n=this.getPath("owner.parentView.itemHeight"),r=Math.ceil(e/n);this.clone.draggingInfo=this.getPath("owner.parentView").indexForMovedItem(this.clone.draggingInfo,r,this.getPath("owner.contentIndex"));var i=this.clone.draggingInfo.currentIndex*n;this.indicator.css({top:i-1+"px"}),this.indicator.show()},finishDragging:function(){this.getPath("owner.parentView").moveItem(this.getPath("owner.contentIndex"),this.clone.draggingInfo)}})}),Flame.ListViewDragHelper=Ember.Object.extend({listView:undefined,lastPageX:undefined,yOffset:undefined,itemPath:undefined,lastTargetContent:null,clone:undefined,mouseMoveCounter:0,initReorder:function(){var e=Flame.ListViewDragHelper.Path.create({array:this.itemPath,root:this.listView});this.itemPath=e,this.reorderCssClass=this.isTree()?".flame-tree-item-view-container":".flame-list-item-view";var t=this.itemPath.getView();t.set("isDragged",!0);var n=t.$(),r=n.clone();n.attr("id")&&r.attr("id",n.attr("id")+"_drag"),r.addClass("is-dragged-clone"),r.find("*").each(function(){this.id&&(this.id=this.id+"_drag")}),r.appendTo(this.get("listView").$()),r.css("opacity",.8),this.set("clone",r),this._updateCss();var i=this.get("listView");r.mousemove(function(e){return i.mouseMove.apply(i,arguments),!0}),r.mouseup(function(e){return i.mouseUp.apply(i,arguments),!0})},updateDisplay:function(e,t){if(t===undefined)this.mouseMoveCounter++;else if(t<this.mouseMoveCounter)return!1;this._updateDraggingCloneAndScrollPosition(e);var n=this._resolveNewPath(e.pageX,e.pageY);if(n&&!this.itemPath.equals(n)){var r=this.itemPath.getView();this._moveItem(this.itemPath,n),this.itemPath=this._resolvePath(r),this._updateCss(),this.lastPageX=e.pageX}return!0},finishReorder:function(){var e=this.itemPath.getView();this.get("listView").didReorderContent(e.getPath("parentView.content")),e.set("isDragged",!1),this.clone.remove()},_updateCss:function(){var e=this.itemPath.getView().$(),t=this.clone.offsetParent().offset().left;this.clone.attr("class",e.attr("class")+" is-dragged-clone"),this.clone.css("left",e.offset().left-t);var n=this.itemPath.getView().$().find(".flame-tree-item-view",".flame-tree-view"),r=this.clone.find(".flame-tree-item-view",".flame-tree-view");r.each(function(e){var r=jQuery(this),i=jQuery(n.get(e));r.attr("class",i.attr("class")),t=r.offsetParent().offset().left,r.css("left",i.offset().left-t)})},_moveItem:function(e,t){var n=e.getView(),r=n.get("content"),i=n.get("parentView"),s=i.get("content"),o=n.$(),u=t.getView(),a=u.$(),f=t.position==="i"?t.getNestedListView():u.get("parentView"),l=f.get("content"),c=f.get("childViews");s===l&&s.startMoving&&s.startMoving(),i.get("childViews").removeObject(n),s.removeObject(r),i._updateContentIndexes(),o.detach();var h=u.get("contentIndex");if(t.position==="b")o.insertBefore(a),c.insertAt(h,n),l.insertAt(h,r);else if(t.position==="a")o.insertAfter(a),c.insertAt(h+1,n),l.insertAt(h+1,r);else{if(t.position!=="i")throw"Invalid insert position "+t.position;a.find(".flame-list-view").first().prepend(o),c.insertAt(0,n),l.insertAt(0,r)}s===l&&s.endMoving&&s.endMoving(),n.set("_parentView",f),f._updateContentIndexes()},isTree:function(){return this.listView instanceof Flame.TreeView},_resolveNewPath:function(e,t){var n=this.itemPath.getView(),r=n.$(),i=this.get("listView").$().find(this.reorderCssClass),s=this.isTree()?r.children(this.reorderCssClass).first():r,o=i.index(s),u=this.clone.offset().top,a=u+this.clone.outerHeight(),f=u-r.offset().top,l=f>0?1:-1,c=o+l,h=i.length,p=o;while(c>=0&&c<h){var d=jQuery(i[c]);if(d.closest(".is-dragged-clone").length>0)break;if(d.is(":visible")&&d.closest(r).length===0){var v=d.offset().top+d.outerHeight()*(.5+l*.2);if(!(l>0&&a>v||l<0&&u<v))break;p=c}c+=l}var m=Ember.View.views[jQuery(i[p]).closest(".flame-list-item-view").attr("id")],g=this._resolvePath(m),y=l>0&&m.get("hasChildren")&&m.get("isExpanded")&&!this._pathInvalid(n,g);return y||(l>0?g.position="a":g.position="b"),g=this._resolveNewLevel(n,m,g,e),this._pathInvalid(n,g)?null:g},_resolveNewLevel:function(e,t,n,r){var i=r-this.lastPageX,s=10;while((i<-s||this._pathInvalid(e,n))&&(n.position==="a"||this.itemPath.equals(n))&&n.array.length>1&&t.get("contentIndex")===t.getPath("parentView.childViews.length")-1)i+=s,n=n.up(),t=n.getView();var o;while((i>s||this._pathInvalid(e,n))&&(n.position!=="i"||this.itemPath.equals(n))&&(o=this._getPrecedingView(t))!==undefined&&o!==e&&o.get("hasChildren")&&o.get("isExpanded")&&!this._pathInvalid(e,this._resolvePath(o).down()))i-=s,n=this._resolvePath(o).down(),t=n.getView();return n},_pathInvalid:function(e,t){var n=e.get("content"),r=t.getView().get("content"),i=null;if(t.position==="i")i=r;else{var s=t.up().getView();s&&(i=s.get("content"))}var o=this.get("listView").isValidDrop(n,i,r);return!o},_getPrecedingView:function(e){return e.get("contentIndex")>0?e.getPath("parentView.childViews").objectAt(e.get("contentIndex")-1):undefined},_resolvePath:function(e){var t=[],n=e.get("parentView");do t.insertAt(0,e.get("contentIndex")),n=e.get("parentView");while(n.get("isNested")&&(e=n.get("parentView"))!==undefined);return Flame.ListViewDragHelper.Path.create({array:t,root:this.listView})},_updateDraggingCloneAndScrollPosition:function(e){var t=this.get("listView").$();t.hasClass("is-nested")&&(t=t.offsetParent());var n=t.scrollTop(),r=t.innerHeight(),i=e.pageY-this.yOffset-t.offset().top+n;i<0&&(i=0);var s=this.clone.outerHeight(),o=t[0].scrollHeight;i+s>o&&(i=o-s),this.clone.css({position:"absolute",right:0,top:i});if(t.css("overflow")==="auto"){var u=n-i;u>0&&t.scrollTo("-=%@px".fmt(Math.max(u/5,1)));var a=i+s-(n+r);a>0&&t.scrollTo("+=%@px".fmt(Math.max(a/5,1)));if(u>0||a>0){var f=this.mouseMoveCounter;Ember.run.next(this,function(){this.updateDisplay(e,f)})}}}}),Flame.ListViewDragHelper.Path=Ember.Object.extend({array:[],position:"i",root:null,getView:function(){var e,t,n=this.array.length,r=this.root;for(t=0;t<n;t++){var i=this.array[t];e=r.get("childViews").objectAt(i),t<n-1&&(r=e.get("childListView"))}return e},getNestedListView:function(){return this.getView().get("childListView")},up:function(){var e=this.array.slice(0,this.array.length-1);return Flame.ListViewDragHelper.Path.create({array:e,position:"a",root:this.root})},down:function(){var e=Ember.copy(this.array),t,n=this.getNestedListView().getPath("content.length");return n>0?(e.push(n-1),t="a"):t="i",Flame.ListViewDragHelper.Path.create({array:e,position:t,root:this.root})},equals:function(e){var t=this.array.length,n=e.array.length;if(t!==n)return!1;for(var r=0;r<t;r++)if(this.array[r]!==e.array[r])return!1;return!0}}),Flame.ListView=Flame.CollectionView.extend(Flame.Statechart,{classNames:["flame-list-view"],classNameBindings:["isFocused"],acceptsKeyResponder:!0,allowSelection:!0,allowReordering:!0,selection:undefined,initialState:"idle",reorderDelegate:null,init:function(){this._super(),this._selectionDidChange()},itemViewClass:Flame.ListItemView.extend({templateContext:function(e,t){return t!==undefined?t:Ember.get(this,"content")}.property("content").cacheable(),templateBinding:"parentView.template",handlebars:"{{title}}"}),selectIndex:function(e){if(!this.get("allowSelection"))return!1;var t=this.get("content");if(t){var n=this.get("childViews").objectAt(e);if(n&&n.get("isVisible")&&n.get("allowSelection")!==!1){var r=t.objectAt(e);return this.set("selection",r),!0}}return!1},changeSelection:function(e){var t=this.get("content"),n=this.get("selection"),r=t.indexOf(n),i=r+e,s=t.get("length");while(i>=0&&i<s){if(this.selectIndex(i))return!0;i+=e}return!1},_selectionWillChange:function(){this._setIsSelectedStatus(this.get("selection"),!1)}.observesBefore("selection"),_selectionDidChange:function(){this._setIsSelectedStatus(this.get("selection"),!0)}.observes("selection"),_setIsSelectedStatus:function(e,t){if(e){var n=(this.get("content")||[]).indexOf(e);if(n>=0){var r=this.get("childViews").objectAt(n);r&&r.set("isSelected",t)}}},_updateContentIndexes:function(){var e=this.get("childViews"),t=e.get("length");for(var n=0;n<t;n++){var r=e.objectAt(n);r&&r.set("contentIndex",n)}this.consultLayoutManager()},didReorderContent:function(e){var t=this.get("reorderDelegate");t&&Ember.run.next(function(){t.didReorderContent(e)})},isValidDrop:function(e,t,n){var r=this.get("reorderDelegate");return r&&r.isValidDrop?r.isValidDrop(e,t,n):!0},rootTreeView:function(){return this}.property(),arrayWillChange:function(e,t,n){if(!this.getPath("rootTreeView.isDragging"))return this._super.apply(this,arguments)},arrayDidChange:function(e,t,n,r){if(!this.getPath("rootTreeView.isDragging")){var i=this._super.apply(this,arguments);return this._updateContentIndexes(),i}},childViewsWillChange:function(){if(!this.getPath("rootTreeView.isDragging"))return this._super.apply(this,arguments)},childViewsDidChange:function(){if(!this.getPath("rootTreeView.isDragging"))return this._super.apply(this,arguments)},allowReorderingItem:function(e){return!0},idle:Flame.State.extend({moveUp:function(){return this.get("owner").changeSelection(-1)},moveDown:function(){return this.get("owner").changeSelection(1)},mouseDownOnItem:function(e,t){var n=this.get("owner");n.selectIndex(e);if(n.get("allowReordering")&&e!==undefined&&n.allowReorderingItem(e)){var r=n.get("childViews").objectAt(e);n.set("dragHelper",Flame.ListViewDragHelper.create({listView:n,lastPageX:t.pageX,yOffset:t.pageY-r.$().offset().top,itemPath:[e]}))}return this.gotoState("mouseButtonPressed"),!0},enterState:function(){this.get("owner").set("dragHelper",undefined)}}),startReordering:function(e,t){return e.set("listView",this),this.set("dragHelper",e),this.gotoState("reordering"),this.mouseMove(t)},mouseButtonPressed:Flame.State.extend({mouseUpOnItem:Flame.State.gotoHandler("idle"),mouseUp:Flame.State.gotoHandler("idle"),mouseMove:function(e){var t=this.get("owner");if(t.get("dragHelper")){var n=t.get("dragHelper");this.gotoState("idle"),t.startReordering(n,e)}return!0},touchEnd:Flame.State.gotoHandler("idle"),touchMove:function(e){return this.mouseMove(this.normalizeTouchEvents(e)),!0}}),reordering:Flame.State.extend({mouseMove:function(e,t,n){return this.get("owner").get("dragHelper").updateDisplay(e)},mouseUp:Flame.State.gotoHandler("idle"),touchMove:function(e){return this.mouseMove(this.normalizeTouchEvents(e)),!0},touchEnd:Flame.State.gotoHandler("idle"),enterState:function(){var e=this.get("owner");e.get("dragHelper").initReorder(),e.set("isDragging",!0)},exitState:function(){var e=this.get("owner");e.get("dragHelper").finishReorder(),e.set("dragHelper",undefined),e.set("isDragging",!1)}})}),Flame.LazyListView=Flame.ListView.extend({classNames:["flame-lazy-list-view"],itemHeight:25,bufferSize:10,constrainDragginToXAxis:!1,_suppressObservers:!1,_lastScrollHeight:undefined,_lastScrollTop:undefined,init:function(){this._super(),this._recycledViews={}},arrayWillChange:function(){},arrayDidChange:function(e,t,n,r){e&&!this._suppressObservers&&this.fullRerender()},fullRerender:function(){this.forEachChildView(function(e){typeof e.get("contentIndex")!="undefined"&&this._recycleView(e)}),this.numberOfRowsChanged(),this.didScroll(this._lastScrollHeight,this._lastScrollTop)},becameVisible:function(){var e=this.nearestInstanceOf(Flame.ScrollView);if(e&&e.get("element")){var t=e.get("element");this._lastScrollHeight=t.offsetHeight,this._lastScrollTop=t.scrollTop,this.didScroll(this._lastScrollHeight,this._lastScrollTop)}},willDestroyElement:function(){this.forEachChildView(function(e){typeof e.get("contentIndex")!="undefined"&&this._recycleView(e)})},numberOfRowsChanged:function(){this.adjustLayout("height",this.numberOfRows()*this.get("itemHeight")),this.$().css("height",this.numberOfRows()*this.get("itemHeight")+"px")},numberOfRows:function(){return this.getPath("content.length")},didScroll:function(e,t){this._lastScrollHeight=e,this._lastScrollTop=t;var n=this._rowsToRenderRange(e,t),r=n.end,i=n.start;this.forEachChildView(function(e){var t=e.get("contentIndex");typeof t!="undefined"&&(t<n.start||t>n.end?e.get("isDragged")||this._recycleView(e):(r=Math.min(r,t),i=Math.max(i,t)))});var s;r===n.end&&r++;for(s=n.start;s<r;s++)this.viewForRow(s);if(i!==n.start)for(s=n.end;s>i;s--)this.viewForRow(s)},_rowsToRenderRange:function(e,t){if(!this.get("element"))return{start:0,end:-1};var n=this.numberOfRows(),r=this.get("itemHeight"),i=this.getPath("parentView.element").scrollTop+this.$().position().top,s=Math.max(0,t-i),o=~~(s/r),u=this.get("bufferSize"),a=~~(e/r)+u,f=o-u/2,l=Math.min(n-1,f+a);return f=Math.max(0,l-a),{start:f,end:l}},viewClassForItem:function(e){return this.get("itemViewClass")},itemForRow:function(e){return this.get("content")[e]},rowForItem:function(e){var t=this.get("content").indexOf(e);return t===-1?null:t},viewForRow:function(e,t){var n=this.itemHeightForRow(e),r=this.itemForRow(e),i=this.viewClassForItem(r),s=r.constructor.toString(),o=this._recycledViews[s]&&this._recycledViews[s].pop();return o||(o=this.createChildView(i,jQuery.extend({useAbsolutePosition:!0},t||{})),this.get("childViews").pushObject(o)),r===this.get("selection")&&o.set("isSelected",!0),o.set("content",r),o.set("contentIndex",e),o.adjustLayout("top",e*n),o.set("isVisible",!0),o},_recycleView:function(e){e.set("isVisible",!1),e.set("contentIndex",undefined),e.set("isSelected",!1);var t=e.get("content").constructor.toString();this._recycledViews[t]||(this._recycledViews[t]=[]),this._recycledViews[t].push(e)},selectIndex:function(e){if(!this.get("allowSelection"))return!1;var t=this.itemForRow(e);return this.set("selection",t),!0},changeSelection:function(e){var t=this.get("selection"),n=this.rowForItem(t),r=n+e;while(r>=0&&r<this.numberOfRows()){if(this.selectIndex(r))return!0;r+=e}return!1},_setIsSelectedStatus:function(e,t){if(e){var n=this.rowForItem(e),r=this.childViewForIndex(n);r&&r.set("isSelected",t)}},itemHeightForRow:function(e){return this.get("itemHeight")},indexForMovedItem:function(e,t,n){return{currentIndex:t,toParent:this.get("content"),toPosition:t}},moveItem:function(e,t){throw"Not implemented yet!"},childViewForIndex:function(e){return this.get("childViews").findProperty("contentIndex",e)}}),Flame.LazyTreeItemView=Flame.LazyListItemView.extend({classNames:["flame-tree-item-view"],itemContent:"{{content}}",isExpanded:!1,collapsedImage:Flame.image("disclosure_triangle_left.png"),expandedImage:Flame.image("disclosure_triangle_down.png"),handlebars:function(){return"{{{unbound disclosureImage}}} <span>"+this.get("itemContent")+"</span>"}.property("itemContent").cacheable(),isExpandedDidChange:function(){this.$().find("img").first().replaceWith(this.get("disclosureImage"))}.observes("isExpanded"),isExpandable:function(){return this.get("parentView").isExpandable(this.get("content"))},disclosureImage:function(){var e=this.isExpandable();return e?'<img src="%@">'.fmt(this.get("isExpanded")?this.get("expandedImage"):this.get("collapsedImage")):""}.property("isExpanded","content","expandedImage","collapsedImage").cacheable(),mouseIsDown:Flame.LazyListViewStates.MouseIsDown.extend({mouseUp:function(e){var t=this.get("owner");if(t.isExpandable()){var n=t.get("parentView");t.toggleProperty("isExpanded"),n.toggleItem(t)}return this._super(e)}}),willStartDragging:function(){this.get("isExpanded")&&(this.toggleProperty("isExpanded"),this.get("parentView").toggleItem(this))}}),Flame.LazyTreeView=Flame.LazyListView.extend({classNames:"flame-tree-view flame-lazy-tree-view".w(),itemViewClass:Flame.LazyTreeItemView,init:function(){this._super(),this._rowToItemCache=[],this._itemToRowCache=new Hashtable,this._itemToLevelCache=new Hashtable,this._itemToParentCache=new Hashtable,this._expandedItems=[],this._numberOfCachedRows=0},numberOfRowsChanged:function(){this._invalidateRowCache(),this.loadCache(),this._super()},numberOfRows:function(){return this._numberOfCachedRows},loadItemIntoCache:function(e,t,n){this._rowToItemCache[this._numberOfCachedRows]=e,this._itemToRowCache.put(e,this._numberOfCachedRows),this._itemToLevelCache.put(e,t),n&&this._itemToParentCache.put(e,n),this._numberOfCachedRows++;if(this._expandedItems.indexOf(e)===-1)return;var r=e.get("treeItemChildren");if(r){var i=r.get("length");for(var s=0;s<i;s++)this.loadItemIntoCache(r.objectAt(s),t+1,e)}},loadCache:function(){var e=this.get("content"),t=e.get("length");for(var n=0;n<t;n++)this.loadItemIntoCache(e.objectAt(n),0)},viewClassForItem:function(e){var t=this.get("itemViewClasses");return t[e.constructor.toString()]},itemForRow:function(e){return this._rowToItemCache[e]},rowForItem:function(e){return this._itemToRowCache.get(e)},levelForItem:function(e){return this._itemToLevelCache.get(e)},viewForRow:function(e){var t=this.itemForRow(e),n=this._expandedItems.indexOf(t)!==-1,r=this._super(e,{isExpanded:n});r.set("isExpanded",n);var i=r.get("classNames"),s="level-"+(this._itemToLevelCache.get(t)+1);return i.indexOf(s)===-1&&(i.forEach(function(e){/^level/.test(e)&&i.removeObject(e)}),i.pushObject(s)),r},_invalidateRowCache:function(){this._rowToItemCache=[],this._itemToRowCache&&this._itemToRowCache.clear(),this._itemToLevelCache&&this._itemToLevelCache.clear(),this._itemToParentCache&&this._itemToParentCache.clear(),this._numberOfCachedRows=0},isExpandable:function(e){return!0},expandItem:function(e){this._expandedItems.pushObject(e);var t=this.rowForItem(e),n=this.childViewForIndex(t);n&&!n.get("isExpanded")&&(n.set("isExpanded",!0),this.toggleItem(n))},toggleItem:function(e){var t=e.get("content"),n=e.get("isExpanded");n?this._expandedItems.pushObject(t):this._expandedItems.removeObject(t),this.numberOfRowsChanged();var r=[],i=[],s=this._rowsToRenderRange(this._lastScrollHeight,this._lastScrollTop);this.forEachChildView(function(e){var t=e.get("contentIndex"),n=e.get("content"),o=this.rowForItem(n);if(o===null)r.push(e);else if(typeof t!="undefined"){i.push(o);if(t!=o){e.set("contentIndex",o);var u=this.itemHeightForRow(o);e.$().css("top",o*u+"px")}(o<s.start||o>s.end)&&this._recycleView(e)}}),r.forEach(function(e){e.destroy()});for(var o=s.start;o<=s.end;o++)if(i.indexOf(o)===-1){e=this.viewForRow(o);var u=this.itemHeightForRow(o);e.adjustLayout("top",o*u)}},moveRight:function(){return this._collapseOrExpandSelection("expand")},moveLeft:function(){return this._collapseOrExpandSelection("collapse")},_collapseOrExpandSelection:function(e){var t=this.get("selection");if(t){var n=this.rowForItem(t),r=this.childViewForIndex(n);if(!r)return this._expandedItems.indexOf(t)===-1?this._expandedItems.pushObject(t):this._expandedItems.removeObject(t),!0;if(e==="collapse"&&r.get("isExpanded"))return r.set("isExpanded",!1),this.toggleItem(r),!0;if(e==="expand"&&!r.get("isExpanded"))return r.set("isExpanded",!0),this.toggleItem(r),!0}return!1},closestCommonAncestor:function(e,t){var n=this._itemToParentCache.get(e),r=this._itemToParentCache.get(t);while(r){if(r===n)return r;r=this._itemToParentCache.get(r)}},isValidDrop:function(e,t){return!0},indexForMovedItem:function(e,t,n){var r=this.itemForRow(n),i=this.itemForRow(t-1),s=this.itemForRow(t);t<0&&(t=0),t>this.numberOfRows()&&(t=this.numberOfRows());var o=this.levelForItem(r),u,a,f;if(s&&this.levelForItem(s)===o)u=t,a=this._itemToParentCache.get(s),f=(a&&a.get("treeItemChildren")||this.get("content")).indexOf(s);else if(i&&this.levelForItem(i)===o&&this._expandedItems.indexOf(i)===-1)u=t,a=this._itemToParentCache.get(i),f=a?a.getPath("treeItemChildren.length"):this.getPath("content.length");else if((!s||s&&this.levelForItem(s)<o)&&i&&this.levelForItem(i)>o)u=t,a=this.closestCommonAncestor(r,i),f=a?a.getPath("treeItemChildren.length"):this.getPath("content.length");else{if(!i||o-1!==this.levelForItem(i)||this._expandedItems.indexOf(i)===-1)return e;u=t,a=i,f=0}return this.isValidDrop(r,a)?{currentIndex:u,toParent:a,toPosition:f}:e},moveItem:function(e,t){var n=this.childViewForIndex(e),r=t.currentIndex,i=e<r?-1:1,s=this.get("itemHeight");this.forEachChildView(function(t){var n=t.get("contentIndex");if(n>e&&n<r||n<e&&n>=r)t.set("contentIndex",n+i),t.$().animate({top:t.get("contentIndex")*s+"px"})}),i<0&&r--,n.set("contentIndex",r),n.$().animate({top:r*s+"px"}),i<0&&r++;var o=this.itemForRow(e),u=this._itemToParentCache.get(o),a=t.toParent||u,f=u?u.get("treeItemChildren"):this.get("content"),l=a?a.get("treeItemChildren"):this.get("content");f===l&&e<r&&t.toPosition--,this._suppressObservers=!0,f.removeObject(o),l.insertAt(t.toPosition,o),this.numberOfRowsChanged(),Ember.run.next(this,function(){this._suppressObservers=!1});var c=this.get("reorderDelegate");c&&Ember.run.next(this,function(){c.didReorderContent(l)})}}),Flame.LoadingIndicatorView=Flame.ImageView.extend({layout:{width:16,height:16},classNames:["loading-indicator"],value:Flame.image("loading.gif")}),Flame.Popover=Flame.Panel.extend({classNames:["flame-popover"],childViews:[],dimBackground:!1,arrow:"arrow",handlebars:'<img {{bindAttr class="arrowPosition arrow"}} {{bindAttr src="image"}} />{{view contentView}}',anchor:null,position:null,_positionArrow:function(){var e=this.get("anchor"),t=this.get("position"),n=this.$("img.arrow"),r=e.offset(),i;t&(Flame.POSITION_ABOVE|Flame.POSITION_BELOW)?(i=r.left+e.outerWidth()/2-(this.$().css("left")?parseInt(this.$().css("left").replace("px",""),10):0)-15,n.css({left:i+"px"}),t&Flame.POSITION_ABOVE&&n.css({top:this.getPath("layout.height")-1+"px"})):(i=r.top+e.outerHeight()/2-parseInt(this.$().css("top").replace("px",""),10)-15,n.css({top:i+"px"}),t&Flame.POSITION_LEFT&&n.css({left:this.getPath("layout.width")-1+"px"}))},_layoutRelativeTo
:function(e,t){e=e instanceof jQuery?e:e.$(),this.set("anchor",e),this.set("position",t);var n=this._super(e,t);if(n.movedX||n.movedY)n.movedX&&t&(Flame.POSITION_LEFT|Flame.POSITION_RIGHT)&&(t^=Flame.POSITION_LEFT|Flame.POSITION_RIGHT),n.movedY&&t&(Flame.POSITION_ABOVE|Flame.POSITION_BELOW)&&(t^=Flame.POSITION_ABOVE|Flame.POSITION_BELOW),n=this._super(e,t),this.set("position",t);return t&Flame.POSITION_ABOVE?(n.top-=15,this.set("arrowPosition","above"),this.set("image",Flame.image("arrow_down.png"))):t&Flame.POSITION_BELOW?(n.top+=15,this.set("arrowPosition","below"),this.set("image",Flame.image("arrow_up.png"))):t&Flame.POSITION_LEFT?(n.left-=15,this.set("arrowPosition","left"),this.set("image",Flame.image("arrow_right.png"))):t&Flame.POSITION_RIGHT&&(n.left+=15,this.set("arrowPosition","right"),this.set("image",Flame.image("arrow_left.png"))),n},didInsertElement:function(){this._positionArrow()},popup:function(e,t){this._super(e,t|Flame.POSITION_MIDDLE)}}),Flame.ProgressView=Flame.View.extend({classNames:["flame-progress-view"],animate:!1,handlebars:function(){var e=this.get("layout").height;return"<div style='height: %@px;' class='progress-container'></div><div style='height: %@px; width: %@px;' class='progress-bar'></div>".fmt(e-2,e-4,this.get("size"))}.property().cacheable(),size:function(){var e=this.get("value")/this.get("maximum");if(isNaN(e))return 0;var t=this.get("layout").width;return e>1&&(e=1),Math.floor(t*e)-4}.property("value","maximum"),_sizeDidChange:function(){Ember.run.next(this,function(){this.get("animate")?this.$(".progress-bar").animate({width:this.get("size")},300):this.$(".progress-bar").css("width",this.get("size"))})}.observes("size")}),Flame.RadioButtonView=Flame.CheckboxView.extend({classNames:["flame-radio-button-view"],action:function(){this.set("targetValue",this.get("value"))},isSelected:function(){return Ember.typeOf(this.get("value"))==="undefined"||Ember.typeOf(this.get("targetValue"))==="undefined"?!1:this.get("value")===this.get("targetValue")}.property("targetValue","value").cacheable(),renderCheckMark:function(e){e.push("<div class='flame-view flame-checkbox-checkmark' style='top:8px;left:8px;width:6px;height:6px;'></div>")}}),Flame.ScrollView=Flame.View.extend({classNames:"scroll-view".w(),lastScrollY:0,isScrolling:!1,didInsertElement:function(){this._super(),this.$().scroll(jQuery.proxy(this.didScroll,this)),this._update()},didScroll:function(e){this.set("lastScrollY",this.get("element").scrollTop),this.get("isScrolling")||requestAnimationFrame(jQuery.proxy(this._update,this)),this.set("isScrolling",!0)},_update:function(){var e=this.get("element").offsetHeight,t=this.get("lastScrollY");this.set("isScrolling",!1),this.forEachChildView(function(n){n.didScroll&&n.didScroll(e,t)})}}),Flame.SearchTextFieldView=Flame.TextFieldView.extend({classNames:["flame-search-field"],cancel:function(){return Ember.empty(this.get("value"))?!1:(Ember.run.next(this,function(){this.set("value","")}),!0)}}),Flame.StackItemView=Flame.ListItemView.extend({useAbsolutePosition:!0,classNames:["flame-stack-item-view"]}),Flame.StackView=Flame.ListView.extend({layoutManager:Flame.VerticalStackLayoutManager.create({topMargin:0,spacing:0,bottomMargin:0}),allowSelection:!1}),Flame.TabView=Flame.View.extend({classNames:["flame-tab-view"],childViews:"tabBarView contentView".w(),tabs:null,previousTabs:null,nowShowing:null,tabsHeight:23,initializeTabsLazily:!0,init:function(){this._super(),Ember.none(this.get("tabs"))||this._tabsDidChange()},_tabsWillChange:function(){var e=this.get("tabs");Ember.none(e)||this.set("previousTabs",e.slice())}.observesBefore("tabs.@each"),_tabsDidChange:function(){var e=this.get("tabs");if(Ember.none(e))return;var t=this.get("previousTabs");Ember.none(t)||t.forEach(function(t,n){if(Ember.none(e.findProperty("value",t.value))){var r=this.get("tabBarView");r.get("childViews").forEach(function(e){e.get("value")===t.value&&r.removeChild(e)})}},this),e.forEach(function(e,n){(Ember.none(t)||Ember.none(t.findProperty("value",e.value)))&&this._addTab(e,n)},this)}.observes("tabs.@each"),_addTab:function(e,t){var n=this.get("contentView"),r=n.get("childViews"),i=this.get("tabBarView"),s=i.get("childViews"),o=this.get("tabsHeight"),u=this;s.insertAt(t,i.createChildView(Flame.ButtonView.create({acceptsKeyResponder:!1,layout:{top:0,bottom:0,height:o},title:e.title,value:e.value,isSelected:Flame.computed.equals("parentView.parentView.nowShowing",e.value),action:function(){u.set("nowShowing",e.value)}})));var a=u.get(e.value);u.get("initializeTabsLazily")||(a instanceof Ember.View||(a=n.createChildView(a)),a.set("isVisible",!1),r.addObject(a),u.set(e.value,a)),Ember.none(this.get("nowShowing"))&&this.set("nowShowing",this.get("tabs").objectAt(0).value)},_tabWillChange:function(){this.get("nowShowing")&&this.get(this.get("nowShowing")).set("isVisible",!1)}.observesBefore("nowShowing"),_tabDidChange:function(){if(this.get("nowShowing")){var e=this.get("nowShowing"),t=this.get(e);if(!(t instanceof Ember.View)){var n=this.get("contentView");t=n.createChildView(t),n.get("childViews").addObject(t),this.set(e,t)}t.set("isVisible",!0)}}.observes("nowShowing"),tabBarView:Flame.View.extend({classNames:["flame-tab-view-tabs"],layout:{left:0,top:0,right:0,height:"parentView.tabsHeight"}}),contentView:Flame.View.extend({classNames:["flame-tab-view-content"],layout:{left:0,top:"parentView.tabsHeight",right:0,bottom:0}})}),Flame.TableDataView=Flame.View.extend(Flame.Statechart,{classNames:["flame-table-data-view"],acceptsKeyResponder:!0,batchUpdates:!0,updateBatchSize:500,_updateCounter:0,selectedCell:null,editValue:null,contentBinding:"^content",initialState:"loaded",loaded:Flame.State.extend({mouseDown:function(e){var t=this.get("owner");return t.selectCell(t._cellForTarget(e.target))?(this.gotoState("selected"),!0):!1},enterState:function(){this.getPath("owner.state")==="inDOM"&&this.getPath("owner.selection").hide()}}),selected:Flame.State.extend({mouseDown:function(e){var t=this.get("owner"),n=t.get("selectedDataCell");if(jQuery(e.target).hasClass("table-selection-background")&&n.options&&n.options())return this.startEdit(),!0;var r=t._cellForTarget(e.target);return!!t.selectCell(r)},mouseUp:function(e){var t=this.getPath("owner.tableViewDelegate");if(t&&t.mouseUp){var n=jQuery(e.target),r,i,s=n.closest("[data-index]"),o=s.attr("data-index"),u=s.parent().attr("data-index");o&&u&&(r=this.getPath("owner.data")[u][o],i=[u,o],t.mouseUp(e,n,r,i,this.get("owner")))}},insertNewline:function(e){return this.startEdit()},deleteBackward:function(e){return this.wipeCell(),!0},deleteForward:function(e){this.wipeCell()},wipeCell:function(){var e=this.getPath("owner.selectedDataCell");if(Ember.none(e))return;e.isEditable()&&this.get("owner")._validateAndSet("")},doubleClick:function(){this.startEdit()},startEdit:function(e){var t=this.getPath("owner.selectedDataCell");if(Ember.none(t))return;t.isEditable()?this.gotoState("editing"):t.options()||this.gotoState("selectingReadOnly")},cancel:function(e){return this.get("owner").resignKeyResponder(),!0},moveLeft:function(e){var t=this.getPath("owner.selectedCell");return this.get("owner").selectCell(t.prev()),!0},moveRight:function(e){var t=this.getPath("owner.selectedCell");return this.get("owner").selectCell(t.next()),!0},moveDown:function(e){var t=this.getPath("owner.selectedCell");return this.get("owner").selectCell(jQuery(t.parent().next().children()[t.attr("data-index")])),!0},moveUp:function(e){var t=this.getPath("owner.selectedCell");return this.get("owner").selectCell(jQuery(t.parent().prev().children()[t.attr("data-index")])),!0},insertTab:function(e){return this.get("owner").invokeStateMethodByValuesOn("moveDown","moveRight"),!0},insertBacktab:function(e){return this.get("owner").invokeStateMethodByValuesOn("moveUp","moveLeft"),!0},keyPress:function(e){var t=this.getPath("owner.selectedDataCell");if(Ember.none(t)||t&&!t.isEditable())return!1;var n=String.fromCharCode(e.which);if(e.metaKey)return!1;if(n.match(/[a-zA-Z0-9+*\-\[\/\=]/)){var r=this.get("owner");return r.set("editValue",n),this.startEdit(),!0}return!1},enterState:function(){this.getPath("owner.selection").show()}}),selectingReadOnly:Flame.State.extend({cancel:function(e){return this.get("owner")._cancelEditingOrSelecting(),!0},insertNewline:function(e){var t=this.get("owner");this.gotoState("selected"),t.invokeStateMethodByValuesOn("moveRight","moveDown")},moveLeft:function(e){this._invokeInSelected("moveLeft")},moveRight:function(e){this._invokeInSelected("moveRight")},moveDown:function(e){this._invokeInSelected("moveDown")},moveUp:function(e){this._invokeInSelected("moveUp")},insertTab:function(e){this._invokeInSelected("insertTab")},insertBacktab:function(e){this._invokeInSelected("insertBacktab")},deleteBackward:function(e){return this.gotoState("selected"),!0},mouseDown:function(e){var t=this.get("owner"),n=t._cellForTarget(e.target);return t.isCellSelectable(n)?(this.gotoState("selected"),t.selectCell(n),!0):!1},enterState:function(){var e=this.get("owner"),t=e.get("selection"),n=e.get("selectedDataCell"),r=e.editableValue(n,!0);t.html(r),t.addClass("read-only is-selectable")},exitState:function(){var e=this.getPath("owner.selection");e.html('<div class="table-selection-background"></div>'),e.removeClass("read-only is-selectable")},_invokeInSelected:function(e){var t=this.get("owner");this.gotoState("selected"),t.invokeStateMethod(e)}}),editing:Flame.State.extend({cancel:function(e){return this.get("owner")._cancelEditingOrSelecting(),!0},insertNewline:function(e){var t=this.get("owner");return t._confirmEdit()&&(this.gotoState("selected"),t.invokeStateMethodByValuesOn("moveRight","moveDown")),!0},insertTab:function(e){var t=this.get("owner");return t._confirmEdit()&&(this.gotoState("selected"),t.invokeStateMethod("insertTab")),!0},insertBacktab:function(e){var t=this.get("owner");return t._confirmEdit()&&(this.gotoState("selected"),t.invokeStateMethod("insertBacktab")),!0},mouseDown:function(e){var t=this.get("owner"),n=t._cellForTarget(e.target),r=t.get("editField");return t.isCellSelectable(n)&&t._confirmEdit()?(this.gotoState("selected"),t.selectCell(n),!0):n&&r&&n[0]!==r[0]&&!t._confirmEdit()?(r.focus(),!0):!1},enterState:function(){var e=this.get("owner"),t=e.get("selectedCell"),n=e.get("selectedDataCell"),r=e.get("editField"),i=e.getPath("parentView.scrollable"),s=e.get("selection"),o=n.options();t.addClass("editing");if(!n.showEditor(t,e,e.get("content")))if(o){var u=Flame.MenuView.create({minWidth:t.outerWidth(),parent:e,items:o.map(function(t){return{title:t.title,value:t.value,isChecked:t.value===n.value,action:function(){e.didSelectMenuItem(this.get("value"))}}}),close:function(){this.get("parent").gotoState("selected"),this._super()}});u.popup(t)}else{var a=t.css("backgroundColor");["rgba(0, 0, 0, 0)","transparent"].contains(a)&&(a="white"),r.css({left:parseInt(s.css("left"),10)+parseInt(s.css("border-left-width"),10)+"px",top:parseInt(s.css("top"),10)+parseInt(s.css("border-top-width"),10)+"px",width:s.outerWidth()-parseInt(s.css("border-left-width"),10)-parseInt(s.css("border-right-width"),10)+"px",height:s.outerHeight()-parseInt(s.css("border-top-width"),10)-parseInt(s.css("border-bottom-width"),10)+"px",backgroundColor:a});var f=e.editableValue(n);r.val(f),r.attr("placeholder",n.placeholder()),e.set("editValue",null),r.show(),r.selectRange(f.length,f.length)}},exitState:function(){var e=this.get("owner"),t=e.get("editField"),n=e.get("selectedCell");n.removeClass("editing"),t.hide(),t.removeClass("invalid")}}),didSelectMenuItem:function(e){var t=this.get("editField");t.val(e||""),this._confirmEdit(),this.invokeStateMethodByValuesOn("moveRight","moveDown")},willLoseKeyResponder:function(){this.set("selectedCell",null),this.gotoState("loaded")},selectedDataCell:function(){var e=this.get("selectedCell");return this.get("data")[e.parent().attr("data-index")][e.attr("data-index")]}.property(),editableValue:function(e,t){var n=this.get("editValue");return n!==null?n:(n=t?e.formattedValue():e.editableValue(),Ember.none(n)?"":n)},didInsertElement:function(){this.set("selection",this.$(".table-selection")),this.set("editField",this.$(".table-edit-field"))},_selectionDidChange:function(){var e=this.get("selectedCell");if(!e)return;var t=this.get("selection"),n=this.getPath("parentView.scrollable"),r=e.position(),i=n.scrollTop(),s=n.scrollLeft(),o=jQuery.browser.webkit?1:2;t.css({left:r.left+s-o+"px",top:r.top+i-o+"px",width:e.outerWidth()-3+"px",height:e.outerHeight()-1+"px"});if(r.top<0)n.scrollTop(i+r.top);else if(r.top+e.outerHeight()>n.outerHeight()){var u=r.top+e.outerHeight()-n.outerHeight();n.scrollTop(u+i+17)}else if(r.left<0)n.scrollLeft(s+r.left);else if(r.left+e.outerWidth()>n.outerWidth()){var a=r.left+e.outerWidth()-n.outerWidth();n.scrollLeft(a+s+17)}e.addClass("active-cell")}.observes("selectedCell"),_selectionWillChange:function(){var e=this.get("selectedCell");e&&e.removeClass("active-cell")}.observesBefore("selectedCell"),_confirmEdit:function(){var e=this.get("editField").val();return this._validateAndSet(e)},_validateAndSet:function(e){var t=this.get("data"),n=this.get("selectedCell"),r=parseInt(n.attr("data-index"),10),i=parseInt(n.parent().attr("data-index"),10),s=t[i][r];if(Ember.compare(s.editableValue(),e)===0)return!0;if(s.validate(e)){var o=this.get("tableViewDelegate"),u=[i,r];if(o.cellUpdated(s,e,u)){var a=this.get("dirtyCells").slice();a.push([i,r]),this.set("dirtyCells",a)}return!0}return this.get("editField").addClass("invalid"),!1},_cancelEditingOrSelecting:function(){this.gotoState("selected")},invokeStateMethodByValuesOn:function(e,t){this.get("areValuesOnRows")?this.invokeStateMethod(e):this.invokeStateMethod(t)},selectCell:function(e){return this.getPath("parentView.allowSelection")&&this.isCellSelectable(e)?(this.set("selectedCell",e),!0):!1},isCellSelectable:function(e){return e&&e[0]&&e[0].nodeName==="TD"},_cellForTarget:function(e){return jQuery(e).closest("td",this.$())},updateColumnWidth:function(e,t){var n=this.$("td[data-index=%@]".fmt(e));n.css({width:"%@px".fmt(t)}),this.propertyDidChange("selectedCell")},render:function(e){this._renderElementAttributes(e),this.set("selectedCell",null),this.gotoState("loaded"),this._renderTable(e)},_renderTable:function(e){var t=this.get("data");if(!t||!t[0])return e;var n=t.length,r=t[0].length,i=this.getPath("parentView.defaultColumnWidth"),s=this.getPath("parentView.content.columnLeafs"),o,u="flame-table";this.getPath("parentView.allowSelection")||(u+=" is-selectable"),e=e.begin("table").attr("class",u).attr("width","1px");var a,f;for(a=0;a<n;a++){e.push('<tr data-index="'+a+'">');for(f=0;f<r;f++){var l=t[a][f],c=l?l.cssClassesString():"";o=s[f].get("render_width")||i,jQuery.browser.mozilla&&(o-=5),e.push('<td data-index="%@" class="%@" style="width: %@px;" %@><div style="position: relative">%@</div></td>'.fmt(f,c+(f%2===0?" even-col":" odd-col"),o,l&&l.titleValue&&l.titleValue()?'title="%@"'.fmt(l.titleValue()):"",l?l.content():'<span style="color: #999">...</span>'))}e.push("</tr>")}e=e.end(),e=e.begin("div").attr("class","table-selection").begin("div").attr("class","table-selection-background").end().end(),e=e.begin("input").attr("class","table-edit-field").end()},_cellsDidChange:function(){this.manipulateCells(this.get("dirtyCells"),function(e,t,n){var r=(e?e.cssClassesString():"")+(n?" even-col":" odd-col"),i=e.content(),s=e.titleValue&&e.titleValue();t.className=r,t.innerHTML=Ember.none(i)?"":'<div style="position: relative">'+i+"</div>",s&&(t.title=s)},++this._updateCounter)}.observes("dirtyCells"),_updatingCellsDidChange:function(){this.manipulateCells(this.get("cellsMarkedForUpdate"),function(e,t,n){if(e.pending)e.pending.isUpdating=!0,t.className+=n?" even-col":" odd-col";else{e.isUpdating=!0;var r=e.cssClassesString()+(n?" even-col":" odd-col");t.className=r}})}.observes("cellsMarkedForUpdate"),manipulateCells:function(e,t,n){var r=this.get("data");if(!e||e.length===0)return;var i=this.$("table.flame-table"),s=i.find("td"),o=e.splice(0,e.length),u=this.get("batchUpdates")?this.get("updateBatchSize"):-1;this._batchUpdate(u,0,n,o,r,s,t)},_batchUpdate:function(e,t,n,r,i,s,o){if(typeof n!="undefined"&&n!=this._updateCounter)return;var u=r.length,a,f,l,c=i[0].length,h=e===-1?u:e;for(var p=t;p<u&&p-t<h;p++){f=r[p];var d=f[0],v=f[1];i[d][v]||(i[d][v]={pending:{}}),l=i[d][v],a=s[d*c+v],a&&o(l,a,v%2===0)}if(p<u){var m=this;Ember.run.next(function(){m._batchUpdate(e,p,n,r,i,s,o)})}}}),Flame.TableView=Flame.View.extend(Flame.Statechart,{classNames:"flame-table-view".w(),childViews:"tableDataView".w(),acceptsKeyResponder:!1,scrollable:null,rowHeader:null,columnHeader:null,tableCorner:null,renderColumnHeader:!0,renderRowHeader:!0,isRowHeaderClickable:!0,isResizable:!0,allowSelection:!1,initialState:"idle",defaultColumnWidth:88,tableDelegate:null,content:null,allowRefresh:!0,batchUpdates:!0,contentAdapter:function(){return Flame.TableViewContentAdapter.create({content:this.get("content")})}.property("content").cacheable(),tableDataView:Flame.TableDataView.extend({dataBinding:"^content._data",dirtyCellsBinding:"^content.dirtyCells",areValuesOnRowsBinding:"^content.areValuesOnRows",totalRowIdsBinding:"^content.totalRowIds",totalColumnIdsBinding:"^content.totalColumnIds",tableViewDelegateBinding:"^tableViewDelegate",cellsMarkedForUpdateBinding:"^content.cellsMarkedForUpdate",batchUpdatesBinding:"^batchUpdates"}),rowDepth:function(){return this.getPath("contentAdapter.rowHeaderRows.maxDepth")}.property("contentAdapter.rowHeaderRows").cacheable(),idle:Flame.State.extend({mouseDown:function(e){var t=jQuery(e.target);if(t.is("div.resize-handle")){this.gotoState("resizing");var n=this.get("owner"),r=t.parent();return n.set("resizingCell",r),n.set("dragStartX",e.pageX),n.set("startX",parseInt(t.parent().css("width"),10)),n.set("offset",parseInt(this.getPath("owner.tableCorner").css("width"),10)),n.set("type",r.is(".column-header td")?"column":"row"),!0}return t.closest(".column-header").length?!0:t.is("a")?!0:!1},mouseUp:function(e){var t=this.getPath("owner.tableViewDelegate");if(t&&t.columnHeaderClicked){var n=jQuery(e.target),r,i;if(!!n.closest(".column-header").length&&(r=n.closest("td").attr("data-leaf-index")))return t.columnHeaderClicked&&(i=this.getPath("owner.content.columnLeafs")[r],t.columnHeaderClicked(i,n)),!0;if(!!n.closest(".row-header").length){if(t.rowHeaderClicked){var s=n.closest("td");r=parseInt(s.attr("data-index"),10),i=this.getPath("owner.content._headers.rowHeaders")[r];if(!i)return!1;t.rowHeaderClicked(i,n,r)}return!0}}return!1}}),resizing:Flame.State.extend({mouseMove:function(e){var t=jQuery(e.target),n=this.getPath("owner.resizingCell"),r=e.pageX-this.getPath("owner.dragStartX"),i=this.getPath("owner.startX")+r;i<30&&(i=30);var s;if(this.getPath("owner.type")==="column")s=parseInt(n.attr("data-leaf-index"),10)+1,n.parents("table").find("colgroup :nth-child(%@)".fmt(s)).css("width","%@px".fmt(i)),this.get("owner")._synchronizeColumnWidth();else{var o=this.getPath("owner.offset")+r-2;o<30&&(o=30);if(jQuery.browser.mozilla)o-=1;else if(jQuery.browser.webkit||jQuery.browser.msie)o-=2;this.getPath("owner.scrollable").css("left","%@px".fmt(o)),this.getPath("owner.columnHeader").parent().css("left","%@px".fmt(o)),this.getPath("owner.tableCorner").css("width","%@px".fmt(o));var u=this.getPath("owner.rowDepth"),a=0;n.nextAll().each(function(){var e=$(this).attr("colspan");a+=e?parseInt(e,10):1}),s=u-a;var f=i;if($(n).attr("colspan")){var l=s-parseInt($(n).attr("colspan"),10)+1;for(l;l<s;l++)f-=parseInt(n.parents("table").find("colgroup :nth-child(%@)".fmt(l)).css("width"),10)}n.parents("table").find("colgroup :nth-child(%@)".fmt(s)).css("width","%@px".fmt(f))}},mouseUp:function(e){var t=this.get("owner");if(t.get("type")==="column"){var n=t.get("tableViewDelegate");if(n&&n.columnResized){var r=t.get("resizingCell"),i=parseInt(r.css("width"),10),s=parseInt(r.attr("data-leaf-index"),10);n.columnResized(s,i)}}return this.gotoState("idle"),!0}}),_synchronizeColumnWidth:function(){var e=this.get("resizingCell"),t=this.get("childViews")[0],n=parseInt(e.css("width"),10),r=parseInt(e.attr("data-leaf-index"),10);if(jQuery.browser.webkit||jQuery.browser.msie)n+=4;jQuery.browser.mozilla&&(n-=2),t.updateColumnWidth(r,n)},willInsertElement:function(){var e=this.get("scrollable");e&&e.unbind()},didInsertElement:function(){this.set("scrollable",this.$(".flame-table").parent().parent()),this.set("rowHeader",this.$(".row-header table")),this.set("columnHeader",this.$(".column-header table")),this.set("tableCorner",this.$(".table-corner")),this.get("scrollable").scroll({self:this},this.didScroll)},didScroll:function(e){var t=e.data.self,n=t.get("scrollable");t.get("rowHeader").css("top","-%@px".fmt(n.scrollTop())),t.get("columnHeader").css("left","-%@px".fmt(n.scrollLeft()))},_headersDidChange:function(){this.rerender()}.observes("contentAdapter.headers"),render:function(e){this._renderElementAttributes(e);var t=this.get("renderColumnHeader"),n=this.get("renderRowHeader"),r=!1,i=this.getPath("contentAdapter.headers");if(!i)return;this.getPath("content.title")&&(e=e.push('<div class="panel-title">%@</div>'.fmt(this.getPath("content.title"))),r=!0);var s=this.get("defaultColumnWidth"),o=this.getPath("contentAdapter.columnHeaderRows"),u=this.getPath("contentAdapter.rowHeaderRows"),a=o.maxDepth*21+1+o.maxDepth,f=0;n&&(f=u.maxDepth*s+1+(t?0:5));var l=r?18:0;t&&(e=e.push('<div class="table-corner" style="top: %@px; left: 0px; height: %@px; width: %@px;"></div>'.fmt(l,a,f)),e=this._renderHeader(e,"column",f,s),l+=a),n&&(e=this._renderHeader(e,"row",l,s)),e=e.begin("div").attr("style","overflow: auto; bottom: 0px; top: %@px; left: %@px; right: 0px;".fmt(l,f)),e=e.attr("class","scrollable"),this.forEachChildView(function(t){t.renderToBuffer(e)}),e=e.end()},_renderHeader:function(e,t,n,r){var i=this.getPath("contentAdapter.headers");if(!i)return e.begin("div").end();var s,o;t==="column"?(i=this.getPath("contentAdapter.columnHeaderRows"),s="left"):(i=this.getPath("contentAdapter.rowHeaderRows"),s="top");var u=i.length;e=e.begin("div").addClass("%@-header".fmt(t)).attr("style","position: absolute; %@: %@px".fmt(s,n)),e=e.begin("table").attr("style","position: absolute").attr("width","1px"),e=e.begin("colgroup");if(t==="row")for(o=1;o<4;o++)e=e.push('<col style="width: %@px;" class="level-%@" />'.fmt(r,o));else{var a=this.getPath("content.columnLeafs").length;for(o=0;o<a;o++)e=e.push('<col style="width: %@px;" />'.fmt(this.getPath("content.columnLeafs")[o].get("render_width")||r))}e=e.end();for(o=0;o<u;o++)e=e.begin("tr"),t==="column"&&(e=e.attr("class","level-%@".fmt(o+1))),e=this._renderRow(e,i[o],t,o),e=e.end();return e=e.end().end(),e},_renderRow:function(e,t,n,r){function a(e){if(e.hasOwnProperty("children")){var t=0;for(var n=0;n<e.children.length;n++)t+=a(e.children[n]);return t}return 1}var i=t.length,s,o,u;for(var f=0;f<i;f++){var l=t[f];e=e.begin("td"),u=l.get?l.get("headerLabel"):l.label,e=e.attr("title",u.replace(/<br>/g,"\n")),l.rowspan>1&&(e=e.attr("rowspan",l.rowspan)),l.colspan>1&&(e=e.attr("colspan",l.colspan)),s='<div class="label">%@</div>',e.attr("class",f%2===0?"even-col":"odd-col");if(n==="column"&&!l.hasOwnProperty("children")){e=e.attr("data-index",f),e=e.attr("data-leaf-index",l.leafIndex),this.get("isResizable")&&this.get("renderColumnHeader")&&(e=e.push('<div class="resize-handle">&nbsp;</div>'));var c=this.get("tableViewDelegate");c&&c.getSortForHeader&&(o=c.getSortForHeader(l));var h=o?"sort-%@".fmt(o):"";s='<div class="label '+h+'">%@</div>'}else if(n==="row"){e=e.attr("data-index",l.dataIndex);if(this.get("renderColumnHeader")){if(this.get("isResizable"))if(l.hasOwnProperty("children")){var p=a(l);e=e.push('<div class="resize-handle" style="height: %@px"></div>'.fmt(p*21))}else e=e.push('<div class="resize-handle"></div>');this.get("isRowHeaderClickable")&&l.get("isClickable")&&(s='<a href="javascript:void(0)">%@</a>')}}e=e.push(s.fmt(u)).end()}return e}}),Flame.TextAreaView=Flame.View.extend({classNames:["flame-text"],childViews:["textArea"],layout:{left:0,top:0},defaultHeight:20,defaultWidth:200,acceptsKeyResponder:!0,value:"",placeholder:null,isValid:null,isVisible:!0,becomeKeyResponder:function(){this.get("textArea").becomeKeyResponder()},textArea:Ember.TextArea.extend(Flame.EventManager,Flame.FocusSupport,{classNameBindings:["isInvalid","isFocused"],acceptsKeyResponder:!0,isValid:null,isInvalid:Flame.computed.equals("isValid",!1),valueBinding:"^value",placeholderBinding:"^placeholder",isVisibleBinding:"^isVisible",keyDown:function(){return!1},keyUp:function(){return this._elementValueDidChange(),!1}})}),Flame.TreeItemView=Flame.ListItemView.extend({useAbsolutePositionBinding:"parentView.rootTreeView.useAbsolutePositionForItems",classNames:["flame-tree-item-view"],classNameBindings:["parentView.nestingLevel"],isExpanded:function(e,t){return arguments.length===1?this._isExpanded!==undefined?this._isExpanded:this.getPath("content.treeItemIsExpanded")||this.get("defaultIsExpanded"):(this._isExpanded=t,t)}.property("content.treeItemIsExpanded","defaultIsExpanded").cacheable(),layout:{left:0,right:0,top:0,height:0},defaultIsExpanded:function(){return this.getPath("parentView.rootTreeView.defaultIsExpanded")}.property("parentView.rootTreeView.defaultIsExpanded").cacheable(),isSelected:function(e,t){return!1}.property().cacheable(),classAttribute:function(){return this.get("content")===this.getPath("parentView.rootTreeView.selection")?"flame-tree-item-view-container is-selected":"flame-tree-item-view-container"}.property("content","parentView.rootTreeView.selection").cacheable(),handlebars:'<div {{bindAttr class="classAttribute"}}><div class="flame-tree-item-view-pad">{{#if hasChildren}}{{view toggleButton}}{{/if}}{{view treeItemViewClass content=content}}</div></div>{{#if renderSubTree}}{{view nestedTreeView}}{{/if}}',renderSubTree:function(){return this.get("hasChildren")&&this.get("isExpanded")}.property().cacheable(),_updateSubTreeRendering:function(){var e=this.get("renderSubTree");!e&&this.get("isExpanded")&&this.get("hasChildren")&&(this.propertyWillChange("renderSubTree"),this.propertyDidChange("renderSubTree"))}.observes("hasChildren","isExpanded"),treeItemViewClass:function(){return Flame.View.extend({useAbsolutePosition:!1,layout:{top:0,left:0,right:0,height:20},classNames:["flame-tree-item-view-content"],contentIndexBinding:"parentView.contentIndex",handlebars:function(){return this.getPath("parentView.parentView.rootTreeView").handlebarsForItem(this.get("content"))}.property("content").cacheable()})}.property(),childListView:function(){return this.get("renderSubTree")?this.getPath("childViews.lastObject.childViews.firstObject"):null}.property("showsubTree").cacheable(),hasChildren:function(){return!Ember.none(this.getPath("content.treeItemChildren"))}.property("content.treeItemChildren"),mouseUp:function(){return this.getPath("parentView.rootTreeView.clickTogglesIsExpanded")&&this.toggleProperty("isExpanded"),!1},toggleButton:Flame.DisclosureView.extend({classNames:["flame-tree-view-toggle"],ignoreLayoutManager:!0,useAbsolutePosition:!1,acceptsKeyResponder:!1,visibilityTargetBinding:"parentView.isExpanded",action:function(){return!1}}),nestedTreeView:function(){return Flame.TreeView.extend({useAbsolutePosition:this.getPath("parentView.rootTreeView.useAbsolutePositionForItems"),layoutManager:Flame.VerticalStackLayoutManager.create({topMargin:0,spacing:0,bottomMargin:0}),layout:{top:0,left:0,right:0},classNames:["flame-tree-view-nested"],isVisible:Flame.computed.bool("parentView.isExpanded"),allowSelection:this.getPath("parentView.rootTreeView.allowSelection"),allowReordering:this.getPath("parentView.rootTreeView.allowReordering"),content:this.getPath("content.treeItemChildren"),itemViewClass:this.getPath("parentView.rootTreeView.itemViewClass"),isNested:!0})}.property("content")}),Flame.TreeView=Flame.ListView.extend({classNames:["flame-tree-view"],classNameBindings:["isNested","nestingLevel"],defaultIsExpanded:!1,itemViewClass:Flame.TreeItemView,isNested:!1,clickTogglesIsExpanded:!0,useAbsolutePositionForItems:!1,handlebarsForItem:function(e){var t=this.get("handlebarsMap")||{};return t[e.constructor.toString()]||t.defaultTemplate},nestingLevel:function(){return"level-%@".fmt(this.getPath("treeLevel"))}.property("treeLevel"),_treeSelectionDidChange:function(){var e=this.get("selection"),t=this.get("parentTreeView");e&&t&&(t.set("selection",e),this.set("selection",undefined))}.observes("selection"),startReordering:function(e,t){var n=this.get("parentTreeView");n?(e.get("itemPath").insertAt(0,this.getPath("parentView.contentIndex")),n.startReordering(e,t)):(Flame.set("mouseResponderView",this),this._super(e,t))},treeLevel:function(){return(this.getPath("parentTreeView.treeLevel")||0)+1}.property("parentTreeView.treeLevel"),parentTreeView:function(){return this.get("isNested")?this.getPath("parentView.parentView"):undefined}.property("isNested","parentView.parentView"),rootTreeView:function(){return this.getPath("parentTreeView.rootTreeView")||this}.property("parentTreeView.rootTreeView")}),Flame.VerticalSplitView=Flame.SplitView.extend({classNames:"flame-vertical-split-view".w(),childViews:"leftView dividerView rightView".w(),leftWidth:100,rightWidth:100,minLeftWidth:0,minRightWidth:0,flex:"right",_unCollapsedLeftWidth:undefined,_unCollapsedRightWidth:undefined,_resizeStartX:undefined,_resizeStartLeftWidth:undefined,_resizeStartRightWidth:undefined,init:function(){this._super(),this.get("flex")==="right"?this.rightWidth=undefined:this.leftWidth=undefined,this._updateLayout(),this.addObserver("leftWidth",this,this._updateLayout),this.addObserver("rightWidth",this,this._updateLayout),this.addObserver("minLeftWidth",this,this._updateLayout),this.addObserver("minRightWidth",this,this._updateLayout)},_updateLayout:function(){var e=this.get("leftView"),t=this.get("dividerView"),n=this.get("rightView"),r=this.$().innerWidth(),i=this.get("dividerThickness"),s=this.get("flex")==="right"?this.get("leftWidth"):undefined,o=this.get("flex")==="left"?this.get("rightWidth"):undefined;s===undefined&&o!==undefined&&r!==null&&(s=r-o-i),o===undefined&&s!==undefined&&r!==null&&(o=r-s-i),"number"==typeof s&&s<this.get("minLeftWidth")&&(o+=s-this.get("minLeftWidth"),s=this.get("minLeftWidth")),"number"==typeof o&&o<this.get("minRightWidth")&&(s+=o-this.get("minRightWidth"),o=this.get("minRightWidth")),this.set("leftWidth",s),this.set("rightWidth",o),this.get("flex")==="right"?(this._setDimensions(e,0,s,undefined),this._setDimensions(t,s,i,undefined),this._setDimensions(n,s+i,undefined,0)):(this._setDimensions(e,0,undefined,o+i),this._setDimensions(t,undefined,i,o),this._setDimensions(n,undefined,o,0))},_setDimensions:function(e,t,n,r){var i=e.get("layout");i.set("left",t),i.set("width",n),i.set("right",r),i.set("top",0),i.set("bottom",0),e.updateLayout()},toggleCollapse:function(e){if(!this.get("allowResizing"))return;this.get("flex")==="right"?this.get("leftWidth")===this.get("minLeftWidth")&&this._unCollapsedLeftWidth!==undefined?this.set("leftWidth",this._unCollapsedLeftWidth):(this._unCollapsedLeftWidth=this.get("leftWidth"),this.set("leftWidth",this.get("minLeftWidth"))):this.get("rightWidth")===this.get("minRightWidth")&&this._unCollapsedRightWidth!==undefined?this.set("rightWidth",this._unCollapsedRightWidth):(this._unCollapsedRightWidth=this.get("rightWidth"),this.set("rightWidth",this.get("minRightWidth")))},startResize:function(e){this._resizeStartX=e.pageX,this._resizeStartLeftWidth=this.get("leftWidth"),this._resizeStartRightWidth=this.get("rightWidth")},resize:function(e){this.get("flex")==="right"?this.set("leftWidth",this._resizeStartLeftWidth+(e.pageX-this._resizeStartX)):this.set("rightWidth",this._resizeStartRightWidth-(e.pageX-this._resizeStartX))}}),Flame.Repeater=Ember.Object.extend(Flame.ActionSupport,{init:function(){this._super(),this._scheduleNext()},stop:function(){Ember.run.cancel(this._timer)},reschedule:function(){this.stop(),this._scheduleNext()},_scheduleNext:function(){var e;if(this.get("interval")===0)e=0;else{var t=this.get("lastInvoke");Ember.none(t)?e=this.get("interval"):e=(new Date).getTime()-t+this.get("interval"),e<0&&(e=0)}this._timer=Ember.run.later(this,function(){this.set("lastInvoke",(new Date).getTime()),this.fireAction(),this._scheduleNext()},e)}}),Flame.Validator=Ember.Object.extend({validate:function(e,t){return!0},validateValue:function(e){return this.validate(Ember.Object.create({value:e}),"value")},isValidProperty:function(e){return e+"IsValid"}}),Flame.Validatable=Ember.Mixin.create({_propertyValidity:null,_objectIsValid:null,_validations:null,isValidProperty:function(e){return e+"IsValid"
},validateProperty:function(e,t,n,r){Ember.none(r)&&(r=!1),n===undefined&&(n=e.get(t));var i=e.get("validations")[t],s=null;if(jQuery.isPlainObject(i)){var o=i;i=o.validation,s=o.coupledProperties}var u;jQuery.isArray(i)||(i=[i]);for(var a=0;a<i.length;a++)if(!(u=this._validate(i[a],e,t,n)))break;var f=this.isValidProperty(t);e.beginPropertyChanges(),e.set(f,u);if(!r&&s){if(!jQuery.isArray(s))throw"Hint: coupledProperties must be an array!";for(var l=0;l<s.length;l++){var c=s[l];c!==t&&this.validateProperty(this,c,undefined,!0)}}e.set("isValid",e._checkValidity()),e.endPropertyChanges()},invalidProperties:function(){var e=[],t=this.get("validations");for(var n in t)this.get(this.isValidProperty(n))!==!0&&e.push(n);return e}.property(),_validate:function(e,t,n,r){var i=null;return e instanceof Flame.Validator?i=e.validate(t,n):Ember.none(e)||(i=e.call(this,r)),i},_checkValidity:function(){var e=this.get("validations");for(var t in e)if(e.hasOwnProperty(t)&&this.get(this.isValidProperty(t))!==!0)return!1;return!0},isValid:function(e,t){return typeof t!="undefined"&&(this._objectIsValid=t),this._objectIsValid===null&&(this._objectIsValid=this._checkValidity()),this._objectIsValid}.property(),validations:function(e,t){return Ember.none(t)||(this._validations===null?this._validations=t:Ember.Logger.info("Trying to set validations after the validations have already been set!")),this._validations}.property(),_createIsValidProperties:function(){var e=this.get("validations"),t,n=this;for(t in e)e.hasOwnProperty(t)&&this._createIsValidProperty(t);for(t in e)e.hasOwnProperty(t)&&(this.addObserver(t,this,"validateProperty"),this.validateProperty(this,t))},_createIsValidProperty:function(e){this._propertyValidity===null&&(this._propertyValidity={});var t=this;Ember.defineProperty(this,this.isValidProperty(e),Ember.computed(function(e,n){return typeof n!="undefined"&&(t.propertyWillChange(e),t._propertyValidity[e]=n,t.propertyDidChange(e)),t._propertyValidity[e]}).property())},setValidationFor:function(e,t){var n=this.get("validations");n[e]=t,this._createIsValidProperty(e),this.removeObserver(e,this,"validateProperty"),this.addObserver(e,this,"validateProperty"),this.validateProperty(this,e)},unknownProperty:function(e){var t=/^(.+)IsValid$/.exec(e),n=this.get("validations");if(t&&n){var r=t[1];if(n[r])return this._createIsValidProperties(),this.get(e)}return this._super(e)},setUnknownProperty:function(e,t){var n=/^(.+)IsValid$/.exec(e),r=this.get("validations");if(n&&r){var i=n[1];if(r[i])return this._createIsValidProperties(),this.set(e,t)}return this._super(e,t)}}),Flame.Validator.association=Flame.Validator.create({validate:function(e,t){var n=e.get(t);return Ember.isArray(n)?n.every(function(e){return e.get("isValid")}):n?n.get("isValid"):!0}}),Flame.Validator.email=Flame.Validator.create({validate:function(e,t){var n=/^(([A-Za-z0-9]+_+)|([A-Za-z0-9]+\-+)|([A-Za-z0-9]+\.+)|([A-Za-z0-9]+\++))*[A-Za-z0-9\-]+@((\w+\-+)|(\w+\.))*\w{1,63}\.[a-zA-Z]{2,6}$/i,r=e.get(t);return n.test(r)}}),Flame.Validator.notBlank=Flame.Validator.create({validate:function(e,t){var n=e.get(t);return n?!n.toString().isBlank():!1}}),Flame.Validator.number=Flame.Validator.create({validate:function(e,t){var n=e.get(t);return n===""||!isNaN(n)&&!isNaN(parseFloat(n))}}),Flame.VERSION="0.2.1-184-gd108cf1";