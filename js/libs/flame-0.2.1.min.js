function selectText(a){var b=document,c=b.getElementById(a),d=null;if(b.body.createTextRange)d=document.body.createTextRange(),d.moveToElementText(c),d.select();else if(window.getSelection){var e=window.getSelection();e.setBaseAndExtent?e.setBaseAndExtent(c,0,c,1):(d=document.createRange(),d.selectNodeContents(c),e.removeAllRanges(),e.addRange(d))}}function handleLayoutHash(a){var b=null;if(a.width>0||a.height>0||a.top>0||a.bottom>0||a.left>0||a.right>0||a.centerX!==null||a.centerY!==null)b={width:a.width,height:a.height,bottom:a.bottom,top:a.top,left:a.left,right:a.right,centerX:a.centerX,centerY:a.centerY};return b}window.Flame=Ember.Namespace.create({}),typeof Range!="undefined"&&typeof Range.prototype.createContextualFragment=="undefined"&&(Range.prototype.createContextualFragment=function(a){var b=this.startContainer.ownerDocument,c=b.createElement("div");c.innerHTML=a;var d=b.createDocumentFragment(),e;while(e=c.firstChild)d.appendChild(e);return d}),String.prototype.trim===undefined&&(String.prototype.trim=function(){return jQuery.trim(this)}),Ember.mixin(Array.prototype,{sum:function(){return this.reduce(function(a,b){return a+b},0)},isEqual:function(a){if(!a)return!1;if(a==this)return!0;var b=a.get("length");if(b!=this.get("length"))return!1;while(--b>=0)if(!Ember.isEqual(a.objectAt(b),this.objectAt(b)))return!1;return!0},max:function(){return Math.max.apply(Math,this)},min:function(){return Math.min.apply(Math,this)},flatten:function(){return this.reduce(function(a,b){return a.concat(b)},[])}}),Ember.mixin(Ember.Binding.prototype,{eq:function(a){return this.transform(function(b,c){return Ember.typeOf(b)==="string"&&b===a})},transformTrueFalse:function(a,b){return this.transform({to:function(c){return c?a:b},from:function(b){return b===a}})},kindOf:function(a){return this.transform(function(b,c){var d=Ember.isArray(b)?b.toArray()[0]:b,e=Ember.isArray(a)?a:[a],f=e.some(function(a){return d&&d instanceof a});return f?d:null})},equals:function(a){return this.transform(function(b,c){return a===b})},isNull:function(){return this.transform(function(a,b){return a===null})},hasPermission:function(a){return this.transform(function(b,c){return b&&b.hasPermission&&b.hasPermission(a)})}}),Ember.Handlebars.registerHelper("flameView",function(a,b){ember_assert("The view helper only takes a single argument",arguments.length<=2),a&&a.data&&a.data.isRenderData&&(b=a,a="Flame.View");var c=b.hash;c.layout=handleLayoutHash(c),Ember.Handlebars.ViewHelper.helper(this,a,b)}),Ember.Handlebars.registerHelper("tabView",function(a){var b=a,c=b.hash;c.layout=handleLayoutHash(c);var d=Flame.TabView.create(c),e=a.fn;if(e){var f=d.get("templateContext"),g={buffer:[],view:d};e(f,{data:g})}a.data.view.appendChild(d)}),Ember.Handlebars.registerHelper("tab",function(a){var b=a.data.view,c=a.hash,d=c,e=a;b.set(c.value,Flame.View.extend({template:e.fn})),b.get("tabs")===null&&b.set("tabs",Ember.A([])),b.get("tabs").pushObject(c)}),Ember.Handlebars.registerHelper("panelView",function(a){var b=a,c=b.hash;c.layout=handleLayoutHash(c);var d=a.fn;d&&(c.contentView=Flame.View.create({layout:{top:26,bottom:0,left:0,right:0},template:d}));var e=Flame.Panel.create(c);e.appendTo("body")}),Ember.Handlebars.registerHelper("tableView",function(a){var b=a,c=b.hash;c.layout=handleLayoutHash(c);var d=a.fn;if(d){var e={buffer:[],columns:Ember.A()};d(null,{data:e}),c.columns=e.columns}c.content=Ember.getPath(c.controller).create({headerProperty:c.headerProperty,columns:c.columns,contentBinding:c.contentBinding});var f=Flame.TableView.create({content:c.content,layout:c.layout});a.data.view.appendChild(f)}),Ember.Handlebars.registerHelper("column",function(a){var b=a.data.columns,c=a.hash,d=a;b.pushObject(c)}),Ember.$.browser.msie&&Ember.$.browser.version<10&&Ember.$(function(){Ember.$("body").on("selectstart",function(a){return["INPUT","TEXTAREA"].contains(a.target.tagName)||$(a.target).parents().andSelf().is(".is-selectable")?!0:!1})}),Flame.imagePath="images/",Ember.mixin(Flame,{image:function(a){return typeof FlameImageUrlPrefix=="undefined"?(Flame.imagePath||"")+a:FlameImageUrlPrefix+a}}),jQuery.fn.selectRange=function(a,b){return this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(a,b);else if(this.createTextRange){var c=this.createTextRange();c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",a),c.select()}})},jQuery.fn.replaceClasses=function(a){return this.removeAttr("class"),a&&this.attr("class",a),this},Ember.mixin(Ember.Binding.prototype,{connect:function(a){var b=this._from.match(/^(\^|\$)/);if(!b)return this._super(a)}}),Flame.reopen({_bindPrefixedBindings:function(a){for(var b in a)if(b.match(/Binding$/)){var c=a[b];if(!(c instanceof Ember.Binding))throw"Expected a Ember.Binding!";var d=c._from.match(/^(\^|\$)([^.]+)(.*)$/);if(d){var e=d[1]==="$",f=d[2],g=d[3],h;e?h=this._lookupValueOfProperty(a,f):h=this._lookupPathToProperty(a,f),ember_assert("Property '%@' was not found!".fmt(f),!Ember.none(h));var i=h+g,j=new Ember.Binding(c._to,i);j._transforms=c._transforms,j.connect(a)}}},_lookupValueOfProperty:function(a,b){var c=a,d;while(d===undefined&&d!==null&&c!==undefined&&c!==null)d=c.get(b),c=c.get("parentView");return d},_lookupPathToProperty:function(a,b){var c=[b,"parentView"],d=a.get("parentView"),e=b+"Binding";while(!Ember.none(d)){if(typeof Ember.get(d,b)!="undefined"||typeof Ember.get(d,e)!="undefined")return c.reverse().join(".");c.push("parentView"),d=d.get("parentView")}return undefined}}),Flame.SortingArrayProxy=Ember.ArrayProxy.extend({sortKey:"position",parent:null,_suppressObservers:!1,init:function(){this._sourceDidChange(),this._super(),this.get("content").addArrayObserver(this,{willChange:"_contentArrayWillChange",didChange:"_contentArrayDidChange"})},content:function(a,b){b!==undefined&&this.set("_content",b);var c=this.get("_content");return c===undefined&&this.set("_content",c=[]),c}.property(),startMoving:function(){this._suppressObservers=!0},endMoving:function(){this._suppressObservers=!1;var a=this.get("content"),b=this.get("sortKey");this._withObserversSuppressed(function(){a.forEach(function(a,c){Ember.setPath(a,b,c)})})},_sourceWillChange:function(){var a=this.get("source");if(a){var b=this;a.forEach(function(a){b._removeSortIndexObserverFor(a)}),a.removeArrayObserver(this,{willChange:"_sourceArrayWillChange",didChange:"_sourceArrayDidChange"})}}.observesBefore("source"),_sourceDidChange:function(){var a=this.get("source");if(a){var b=a.slice();this._sort(b);var c=this.get("content");c.replace(0,c.get("length"),b);var d=this;c.forEach(function(a){d._addSortIndexObserverAndRegisterForRemoval(a)}),a.addArrayObserver(this,{willChange:"_sourceArrayWillChange",didChange:"_sourceArrayDidChange"})}}.observes("source"),_addSortIndexObserverAndRegisterForRemoval:function(a){var b=this.get("sortKey");a.lastPosition=a.get(b);var c=function(){this._indexChanged(a)};Ember.addObserver(a,b,this,c),a[this.get("observerKey")]=c},_removeSortIndexObserverFor:function(a){var b=a[this.get("observerKey")];b&&(Ember.removeObserver(a,this.get("sortKey"),this,b),delete a[this.get("observerKey")])},_getObserverKey:function(){return"__observer_"+Ember.guidFor(this)}.property().cacheable(),_indexChanged:function(a){if(a.lastPosition===a.get(this.get("sortKey"))||this._suppressObservers)return;this._sortAndReplaceContent(this.get("content").slice())},_sourceArrayWillChange:function(a,b,c,d){var e=this.get("content"),f=this;this._withObserversSuppressed(function(){if(b===0&&c===e.get("length"))e.replace(0,c),e.forEach(function(a){f._removeSortIndexObserverFor(a)});else for(var d=b;d<b+c;d++){var g=a.objectAt(d);e.removeObject(g),f._removeSortIndexObserverFor(g)}})},_sourceArrayDidChange:function(a,b,c,d){var e=this.get("content").slice();if(d>0){for(var f=b;f<b+d;f++){var g=a.objectAt(f);this._addSortIndexObserverAndRegisterForRemoval(g),e.push(g)}this._sortAndReplaceContent(e)}},_contentArrayWillChange:function(a,b,c,d){var e=this.get("source"),f=this;this._withObserversSuppressed(function(){for(var d=b;d<b+c;d++){var g=a.objectAt(d);e.removeObject(g),f._removeSortIndexObserverFor(g)}})},_contentArrayDidChange:function(a,b,c,d){if(d>0){var e=this.get("sortKey"),f=this.get("source"),g=this;this._withObserversSuppressed(function(){a.forEach(function(a,b){Ember.setPath(a,e,b)});for(var c=b;c<b+d;c++){var h=a.objectAt(c);g._addSortIndexObserverAndRegisterForRemoval(h),f.pushObject(h)}})}},_sortAndReplaceContent:function(a){var b=this.get("content");ember_assert("Must pass a copy of content, sorting the real content directly bypasses array observers!",b!==a),this._sort(a),this._withObserversSuppressed(function(){b.replace(0,b.get("length"),a)})},_sort:function(a){var b=this.get("sortKey");a.sort(function(a,c){return Ember.compare(Ember.getPath(a,b),Ember.getPath(c,b))})},_withObserversSuppressed:function(a){if(this._suppressObservers)return;this._suppressObservers=!0;try{a.call()}finally{this._suppressObservers=!1}}}),Ember.mixin(String.prototype,{truncate:function(a){var b=Ember.none(a)?30:a;return this.length<=b?this.toString():this.substr(0,b)+"..."},isBlank:function(){return this.trim().length===0}}),Flame.TableCell=function(a){this.value=null;for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])},Flame.TableCell.prototype.formattedValue=function(){return this.value===null?"":this.value},Flame.TableCell.prototype.editableValue=function(){throw"Not implemented"},Flame.TableCell.prototype.validate=function(a){return!0},Flame.TableCell.prototype.formatValueForBackend=function(a){throw"Not implemented"},Flame.TableCell.prototype.isEditable=function(){return!1},Flame.TableCell.prototype.cssClasses=function(){return[]},Flame.TableCell.prototype.cssClassesString=function(){return""},Flame.TableHeader=Ember.Object.extend({isClickable:!1,headerLabel:function(){return this.get("label")}.property("label").cacheable(),createCell:function(a){throw"Not implemented"}}),Flame.TableSortSupport={sortAscendingCaption:"Sort ascending...",sortDescendingCaption:"Sort descending...",sortContent:function(a){throw"Not implemented!"},columnHeaderClicked:function(a,b){this._showSortMenu(a,this._sortMenuOptions(a),b)},_showSortMenu:function(a,b,c){var d=b.map(function(a){return a.title.length}).max(),e=Flame.MenuView.create({items:b,layout:{width:d*8},target:this,action:"sortContent",payloadBinding:"value"});e.popup(c)},_sortMenuOptions:function(a){return[{title:this.get("sortAscendingCaption"),value:{header:a,order:"asc"}},{title:this.get("sortDescendingCaption"),value:{header:a,order:"desc"}}]}},Flame.TableViewContentAdapter=Ember.Object.extend({content:null,headers:function(){return this.getPath("content._headers")}.property("content._headers").cacheable(),columnLeafs:function(){return this.getPath("content.columnLeafs")}.property("content.columnLeafs").cacheable(),rowLeafs:function(){return this.getPath("content.rowLeafs")}.property("content.rowLeafs").cacheable(),columnHeaderRows:function(){var a=[],b=this.get("headers"),c=b.columnHeaders,d=c.length,e;for(e=0;e<d;e++)this._processHeader(a,c[e],"columns",0);a.maxDepth=this.get("columnLeafs").map(function(a){return a.depth}).max();for(e=0;e<this.get("columnLeafs").length;e++){var f=this.get("columnLeafs")[e];f.rowspan=a.maxDepth-f.depth+1}return a}.property("headers").cacheable(),rowHeaderRows:function(){var a=[[]],b=this.get("headers"),c=b.rowHeaders,d=c.length;for(i=0;i<d;i++)this._processHeader(a,c[i],"rows",0,i===0);var e=0;for(i=0;i<this.get("rowLeafs").length;i++){var f=this.get("rowLeafs")[i].depth;f>e&&(e=f)}a.maxDepth=this.get("rowLeafs").map(function(a){return a.depth}).max();for(i=0;i<this.get("rowLeafs").length;i++){var g=this.get("rowLeafs")[i];g.colspan=a.maxDepth-g.depth+1}return a}.property("headers").cacheable(),clear:function(){this._headers=null,this.propertyDidChange("headers")},_processHeader:function(a,b,c,d,e){b.depth=d+1,c==="columns"?(a[d]||(a[d]=[]),a[d].push(b)):c==="rows"&&(e||a.push([]),a[a.length-1].push(b));var f=0;if(b.hasOwnProperty("children")){var g=b.children,h=g.length;for(var i=0;i<h;i++){var j=g[i];f+=this._processHeader(a,j,c,d+1,i===0)}}else f=1;return c==="columns"?b.colspan=f:b.rowspan=f,f}}),Flame.State=Ember.Object.extend({gotoState:function(a){this.get("owner").gotoState(a)},$:function(a){a=Array.prototype.slice.call(arguments);var b=this.get("owner");return b.$.apply(b,a)}}),Flame.State.reopenClass({gotoHandler:function(a,b){return function(){return this.gotoState(a),b===undefined?!0:b}}}),Flame.Statechart={initialState:null,currentState:undefined,_currentStateName:undefined,init:function(){this._super();var a;for(a in this){var b=this[a];Flame.State.detect(b)&&(this.set(a,b.create({owner:this})),this._setupProxyMethods(this[a]))}ember_assert("No initial state defined for statechart!",!Ember.none(this.get("initialState"))),this.gotoState(this.get("initialState"))},_setupProxyMethods:function(a){for(var b in a)a.constructor.prototype.hasOwnProperty(b)&&Ember.typeOf(a[b])==="function"&&!this[b]&&b!=="enterState"&&b!=="exitState"&&(this[b]=function(a){return function(b){return b=Array.prototype.slice.call(arguments),b.unshift(a),this.invokeStateMethod.apply(this,b)}}(b))},gotoState:function(a){ember_assert("Cannot go to an undefined or null state!",!Ember.none(a));var b=this.get("currentState"),c=this.get(a);if(b===c)return;if(!(!Ember.none(c)&&c instanceof Flame.State))throw new Error("%@ is not a state!".fmt(a));Ember.none(b)||b.exitState&&b.exitState(),this._currentStateName=a,this.set("currentState",c),c.enterState&&c.enterState()},isCurrentlyIn:function(a){return this._currentStateName===a},invokeStateMethod:function(a,b){b=Array.prototype.slice.call(arguments),b.shift();var c=this.get("currentState");ember_assert("Cannot invoke state method without having a current state!",!Ember.none(c)&&c instanceof Flame.State);var d=c[a];if(Ember.typeOf(d)==="function")return d.apply(c,b)}},Flame.TableController=Ember.Object.extend({dirtyCells:[],valuesOn:"column",isLoading:!1,pushDataBatch:function(a){if(a!==undefined){var b=this.get("_headers");if(!b)throw"Can't push data without first setting headers!";var c=this.get("dirtyCells").slice(),d=this.get("valuesOn"),e=this.get(d+"Leafs"),f=this.get("rowLeafs"),g=this.get("columnLeafs"),h=this.get("_data"),i=a.length,j=this.get("_indexFromPathMapping"),k,l;for(var m=0;m<i;m++){k=a[m],l=j[k.path.row][k.path.column];if(f[l[0]].isTotal||g[l[1]].isTotal)k.isTotal=!0,k.isDoubleTotal=f[l[0]].isTotal&&g[l[1]].isTotal;k=e[l[d==="row"?0:1]].createCell(k),h[l[0]][l[1]]=k,c.push(l)}this.set("dirtyCells",c)}},_indexFromPathMapping:function(){var a={},b=this.get("rowLeafs"),c=b.length,d=this.get("columnLeafs"),e=d.length,f,g,h,i,j;for(f=0;f<c;f++){h=b[f],j=a[h.path]={};for(g=0;g<e;g++)i=d[g],j[i.path]=[f,g]}return a}.property("rowLeafs","columnLeafs").cacheable(),rowLeafs:function(){var a=this.get("_headers");return a?this._getLeafs(a.rowHeaders,[]):null}.property("_headers").cacheable(),columnLeafs:function(){var a=this.get("_headers");return a?this._getLeafs(a.columnHeaders,[]):null}.property("_headers").cacheable(),pathFromIndex:function(a){var b=this.get("rowLeafs"),c=this.get("columnLeafs");return{row:b[a[0]].path,column:c[a[1]].path}},indexFromPath:function(a){var b=this.get("_indexFromPathMapping");return b[a.row][a.column]},_getLeafs:function(a,b){var c,d=a.length,e=[];for(var f=0;f<d;f++){c=a[f];if(c.hasOwnProperty("children")){var g=c.hasOwnProperty("id")?b.concat(c.id):b;e=e.concat(this._getLeafs(c.children,g))}else c.path=b.concat(c.id),e.push(c)}for(f=0;f<e.length;f++)c=e[f],c.leafIndex=f;return e},_headersDidChange:function(){var a=this.get("_headers");if(!Ember.none(a)){var b=[];this.set("dirtyCells",[]);var c=this.get("rowLeafs").length,d=this.get("columnLeafs").length;for(i=0;i<c;i++){b.push([]);for(var e=0;e<d;e++)b[i].push(null)}this.set("_data",b)}}.observes("_headers")}),Flame.DataTableController=Flame.TableController.extend({headers:null,data:null,init:function(){this._super(),this._headersDidChange()},_headers:function(){var a=this.get("headers");return{rowHeaders:this._wrapHeaders(a.rowHeaders||[]),columnHeaders:this._wrapHeaders(a.columnHeaders||[])}}.property("headers").cacheable(),_wrapHeaders:function(a){var b=this,c=this.get("headerClass");return a.map(function(a,d){var e=c.create({id:d},a),f=e.get("children");return f&&e.set("children",b._wrapHeaders(f)),e})},headerClass:function(){var a=this.get("cellClass");return Flame.TableHeader.extend({createCell:function(b){return new a({value:b.value})}})}.property().cacheable(),cellClass:Flame.TableCell,_transformData:function(a){var b=[];return a.forEach(function(a,c){a.forEach(function(a,d){b.push({path:{row:[c],column:[d]},value:a})})}),b},_headersDidChange:function(){this._super();var a=this.get("data");a&&this.pushDataBatch(this._transformData(a))}.observes("headers")}),Flame.ArrayTableController=Flame.DataTableController.extend(Flame.TableSortSupport,{content:[],columns:[],headerProperty:null,rowHeadersClickable:!1,init:function(){this._super(),this._setContentObserver()},headers:function(){var a=this.get("headerProperty");ember_assert("headerProperty not defined for ArrayTableAdapter!",!!a);var b=this.get("rowHeadersClickable"),c=this;return{rowHeaders:this.get("content").map(function(d,e){var f=d.get(a),g=function(){return function(a,b,d){d!==f&&c.refreshHeaders()}}();return c._setPropertyObserver(d,a,g),{isClickable:b,label:d.get(a),object:d}}),columnHeaders:this.get("columns").map(function(a,b){return{label:Ember.getPath(a,"label"),property:Ember.getPath(a,"property")}})}}.property("content.@each","columns","headerProperty","rowHeadersClickable").cacheable(),data:function(){var a=this,b=this.get("columns");return this.get("content").map(function(c,d){return b.map(function(b,e){var f=Ember.getPath(b,"property"),g=function(){return function(b,c,f){a.pushDataBatch([{path:{row:[d],column:[e]},value:f}])}}();return a._setPropertyObserver(c,f,g),Ember.get(c,Ember.getPath(b,"property"))})})}.property("headers").cacheable(),_setPropertyObserver:function(a,b,c){var d=b+"DidChangeInArrayTableController";a.removeObserver(b,a,d),a[d]=c,a.addObserver(b,a,d)},_removePropertyObservers:function(a){var b=/(.+)DidChangeInArrayTableController$/;for(var c in a)if(a.hasOwnProperty(c)&&b.test(c)){var d=b.exec(c)[1];a.removeObserver(d,a,c),delete a[c]}},_contentArrayWillChange:function(a,b,c,d){var e=b+c;for(var f=b;f<e;f++)this._removePropertyObservers(a.objectAt(f))},_setContentObserver:function(){var a=this.get("content");a&&a.addArrayObserver(this,{willChange:"_contentArrayWillChange",didChange:Ember.K})}.observes("content"),_removeContentObserver:function(){var a=this.get("content");a&&(a.removeArrayObserver(this,{willChange:"_contentArrayWillChange",didChange:Ember.K}),a.forEach(this._removePropertyObservers,this))}.observesBefore("content"),sortContent:function(a){var b=a.header.get("property"),c=a.order==="desc"?-1:1,d=this.get("content").slice();d.sort(function(a,d){return c*Ember.compare(Ember.get(a,b),Ember.get(d,b))}),this.set("content",d)},refreshHeaders:function(){this.propertyWillChange("headers"),this.propertyDidChange("headers")}}),Flame.ActionSupport={target:null,action:null,payload:null,fireAction:function(a,b){var c=this.get("target")||null;c||(c=this);while("string"==typeof c)c.charAt(0)==="."?c=this.getPath(c.slice(1)):c=Ember.getPath(c);a===undefined&&(a=this.get("action"));if(a){var d="function"==typeof a?a:c[a];if(!d)throw"Target %@ does not have action %@".fmt(c,a);return d.call(c,b||this.get("payload")||this,a,this)}return!1}};var eventHandlers={interpretKeyEvents:function(a){var b=a.shiftKey?Flame.MODIFIED_KEY_BINDINGS:Flame.KEY_BINDINGS,c=b[a.keyCode];if(c&&this[c]){var d=this[c];if(d&&Ember.typeOf(d)==="function")return d.call(this,a,this)}return!1},handleKeyEvent:function(a,b){var c=null;switch(a.type){case"keydown":c="keyDown";break;case"keypress":c="keyPress"}var d=c?this.get(c):null;window.FlameInspector&&c&&FlameInspector.logEvent(a,c,this);if(d)return!d.call(Flame.keyResponderStack.current(),a,Flame.keyResponderStack.current());if(c==="keyDown"&&this.interpretKeyEvents(a))return!1;if(this.get("parentView"))return this.get("parentView").handleKeyEvent(a,b)}};Ember.View.reopen(eventHandlers),Ember.TextSupport.reopen(eventHandlers),Flame.KEY_BINDINGS={8:"deleteBackward",9:"insertTab",13:"insertNewline",27:"cancel",32:"insertSpace",37:"moveLeft",38:"moveUp",39:"moveRight",40:"moveDown",46:"deleteForward"},Flame.MODIFIED_KEY_BINDINGS={8:"deleteForward",9:"insertBacktab",37:"moveLeftAndModifySelection",38:"moveUpAndModifySelection",39:"moveRightAndModifySelection",40:"moveDownAndModifySelection"},Flame.ALLOW_BROWSER_DEFAULT_HANDLING={},Ember.mixin(Flame,{mouseResponderView:undefined,keyResponderStack:Ember.Object.create({_stack:[],currentKeyResponder:function(){return this.current()}.property(),current:function(){var a=this._stack.get("length");return a>0?this._stack.objectAt(a-1):undefined},push:function(a){return Ember.none(a)||(a.willBecomeKeyResponder&&a.willBecomeKeyResponder(),a.set&&!a.isDestroyed&&a.set("isFocused",!0),this._stack.push(a),a.didBecomeKeyResponder&&a.didBecomeKeyResponder(),this.propertyDidChange("currentKeyResponder")),a},pop:function(){if(this._stack.get("length")>0){var a=this.current();a&&a.willLoseKeyResponder&&a.willLoseKeyResponder();var b=this._stack.pop();return b.set&&!b.isDestroyed&&b.set("isFocused",!1),b.didLoseKeyResponder&&b.didLoseKeyResponder(),this.propertyDidChange("currentKeyResponder"),b}return undefined},replace:function(a){if(this.current()!==a)return this.pop(),this.push(a)}})}),Ember.$(document).on("keydown.sproutcore keypress.sproutcore",null,function(a,b){return Flame.keyResponderStack.current()!==undefined&&Flame.keyResponderStack.current().get("isVisible")?Flame.keyResponderStack.current().handleKeyEvent(a,Flame.keyResponderStack.current()):!0}),Flame.EventManager={acceptsKeyResponder:!1,becomeKeyResponder:function(a){if(this.get("acceptsKeyResponder")!==!1&&!this.get("isDisabled"))a===undefined||a===!0?Flame.keyResponderStack.replace(this):Flame.keyResponderStack.push(this);else{var b=this.get("parentView");if(b&&b.becomeKeyResponder)return b.becomeKeyResponder(a)}},resignKeyResponder:function(){Flame.keyResponderStack.pop()},eventManager:{mouseDown:function(a,b){b.becomeKeyResponder(),Flame.set("mouseResponderView",undefined);var c=this._dispatch("mouseDown",a,b);return c&&Flame.set("mouseResponderView",c),!c},mouseUp:function(a,b){return Flame.get("mouseResponderView")!==undefined&&(b=Flame.get("mouseResponderView"),Flame.set("mouseResponderView",undefined)),!this._dispatch("mouseUp",a,b)},mouseMove:function(a,b){return Flame.get("mouseResponderView")!==undefined&&(b=Flame.get("mouseResponderView")),!this._dispatch("mouseMove",a,b)},keyDown:function(a){return Flame.keyResponderStack.current()!==undefined&&Flame.keyResponderStack.current().get("isVisible")?Flame.keyResponderStack.current().handleKeyEvent(a,Flame.keyResponderStack.current()):!0},keyPress:function(a){return Flame.keyResponderStack.current()!==undefined&&Flame.keyResponderStack.current().get("isVisible")?Flame.keyResponderStack.current().handleKeyEvent(a,Flame.keyResponderStack.current()):!0},_dispatch:function(a,b,c){window.FlameInspector&&FlameInspector.logEvent(b,a,c);var d=c.get(a);if(d){var e=d.call(c,b,c);if(e===Flame.ALLOW_BROWSER_DEFAULT_HANDLING)return!1;if(e)return c}var f=c.get("parentView");return f?this._dispatch(a,b,f):!1}}},Flame.FocusSupport={didBecomeKeyResponder:function(){this.$().focus()},didLoseKeyResponder:function(){this.$().blur()},focusIn:function(){Flame.keyResponderStack.current()!==this&&this.becomeKeyResponder()},focusOut:function(){Flame.keyResponderStack.current()===this&&this.resignKeyResponder()}},Flame.FullscreenSupport={isFullscreen:!1,_oldAttributes:undefined,_pane:undefined,_button:undefined,modalPane:function(){return Flame.View.create({layout:{left:0,top:0,right:0,bottom:0},classNames:["flame-fullscreen-pane"],owner:undefined})}.property(),closeButton:function(){return Flame.ButtonView.create({layout:{right:3,top:3,width:24,height:24},classNames:["flame-fullscreen-close"],handlebars:"<img style='margin: 3px;' src='%@'>".fmt(Flame.image("fullscreen_off.png")),action:function(){this.getPath("owner").exitFullscreen()}})}.property(),enterFullscreen:function(){if(!this.get("isFullscreen")){var a,b;this.set("_pane",a=this.get("modalPane")),this.set("_button",b=this.get("closeButton")),a.set("owner",this),b.set("owner",this),a.append(),b.append();var c=this.$(),d={left:c.css("left"),top:c.css("top"),right:c.css("right"),bottom:c.css("bottom"),width:c.css("width"),height:c.css("height"),position:c.css("position"),zIndex:c.css("zIndex")};d.left!=="auto"&&d.right!=="auto"&&(d.width=undefined),d.top!=="auto"&&d.bottom!=="auto"&&(d.height=undefined),this.set("_oldAttributes",d),c.css({left:0,top:0,right:0,bottom:0,width:"",height:"",position:"fixed",zIndex:"50"}),this.set("isFullscreen",!0)}},exitFullscreen:function(){this.get("isFullscreen")&&(this.$().css(this.get("_oldAttributes")),this.get("_pane").remove(),this.get("_button").remove(),this.set("isFullscreen",!1))}},Flame.LayoutSupport={useAbsolutePosition:!0,concatenatedProperties:["displayProperties"],layout:{left:0,right:0,top:0,bottom:0},defaultWidth:undefined,defaultHeight:undefined,layoutManager:undefined,rootView:!1,_layoutProperties:["left","right","top","bottom","width","height"],_cssProperties:["left","right","top","bottom","width","height","margin-left","margin-top"],_layoutChangeInProgress:!1,_layoutSupportInitialized:!1,init:function(){this._super(),this._initLayoutSupport(),this.consultLayoutManager(),this.updateLayout()},createChildView:function(a,b){return a=this._super(a,b),Flame._bindPrefixedBindings(a),a},didInsertElement:function(){this._super(),this.consultLayoutManager()},childViewsDidChange:function(){this._super.apply(this,arguments),this.consultLayoutManager()},_initLayoutSupport:function(){var a=Ember.Object.create(Ember.copy(this.get("layout")));a.width===undefined&&a.right===undefined&&this.get("defaultWidth")!==undefined&&(a.width=this.get("defaultWidth")),a.height===undefined&&(a.top===undefined||a.bottom===undefined)&&this.get("defaultHeight")!==undefined&&(a.height=this.get("defaultHeight")),this.set("layout",a),this.addObserver("layout",this,this.updateLayout),this._layoutSupportInitialized=!0},_renderElementAttributes:function(a){ember_assert("Layout support has not yet been initialized!",!!this._layoutSupportInitialized);if(!this.get("useAbsolutePosition"))return;var b=this.get("layout")||{};this._resolveLayoutBindings(b);var c=this._translateLayout(b);this._cssProperties.forEach(function(b){var d=c[b];Ember.none(d)||a.style(b,d)}),b.zIndex!==undefined&&a.style("z-index",b.zIndex);var d=this.get("backgroundColor");d!==undefined&&a.style("background-color",d),a.addClass("flame-view")},render:function(a){return this._renderElementAttributes(a),this._super(a)},_resolveLayoutBindings:function(a){if(a._bindingsResolved)return;var b=this;this._layoutProperties.forEach(function(c){var d=a[c];!Ember.none(d)&&"string"==typeof d&&d!==""&&isNaN(parseInt(d,10))&&(b.addObserver(d,b,function(){b.adjustLayout(c,b.getPath(d))}),a[c]=b.getPath(d))}),a._bindingsResolved=!0},_translateLayout:function(a){var b={};return b.width=a.width,a.centerX===undefined?(b.left=a.left,b.right=a.right):(b.left="50%",b["margin-left"]=-((a.width||0)/2)+a.centerX+"px"),b.height=a.height,a.centerY===undefined?(b.top=a.top,b.bottom=a.bottom):(b.top="50%",b["margin-top"]=-((a.height||0)/2)+a.centerY+"px"),this._cssProperties.forEach(function(a){var c=b[a];c!==undefined&&("number"==typeof c||parseInt(c,10).toString()===c)&&(b[a]=c+"px")}),b},consultLayoutManager:function(){if(!this._layoutSupportInitialized)return;if(!this._layoutChangeInProgress){this._layoutChangeInProgress=!0;try{var a=this.get("layoutManager");a!==undefined&&a.setupLayout(this)}finally{this._layoutChangeInProgress=!1}}},layoutDidChangeFor:function(a){this.consultLayoutManager()},adjustLayout:function(a,b,c){ember_assert("Layout support has not yet been initialized!",!!this._layoutSupportInitialized);var d=this.get("layout"),e=d[a],f;if(b!==undefined)f=b;else{if(c===undefined)throw"Give either a new value or an increment!";f=e+c}e!==f&&(d[a]=f,this.updateLayout())},updateLayout:function(){ember_assert("Layout support has not yet been initialized!",!!this._layoutSupportInitialized);if(this.get("useAbsolutePosition")){var a=this._translateLayout(this.get("layout")||{}),b=this.get("element");b&&jQuery(b).css(a)}var c=this.get("parentView");c&&c.layoutDidChangeFor&&c.layoutDidChangeFor(this)}.observes("isVisible"),isVisible:!0,_isVisibleWillChange:function(){var a;this.get("isVisible")?a="willBecomeHidden":a="willBecomeVisible",this.invokeRecursively(function(b){b[a]&&b[a].apply(b)})}.observesBefore("isVisible")},Flame.LayoutManager=Ember.Object.extend({setupLayout:undefined}),Flame.VerticalStackLayoutManager=Flame.LayoutManager.extend({topMargin:0,bottomMargin:0,spacing:0,setupLayout:function(a){var b=this,c=b.get("topMargin"),d=a.get("childViews").get("length"),e=!1,f=!0;a.get("childViews").forEach(function(a,g){if("string"==typeof a)throw"Child views have not yet been initialized!";if(a.get("ignoreLayoutManager")!==!0&&(a.get("isVisible")||a.get("isVisible")===null)&&a.get("layout")){f?f=!1:c+=b.get("spacing");var h=a.get("layout");a._resolveLayoutBindings(h),ember_assert("All child views must define layout when using VerticalStackLayoutManager!",!Ember.none(h)),c+=h.topMargin||0,a.adjustLayout("top",c),c+=(h.topPadding||0)+(h.bottomPadding||0);var i=h.height;"string"==typeof i&&(i=parseInt(i,10)),g<d-1&&ember_assert("All child views except last one must define layout.height when using VerticalStackLayoutManager!",!Ember.none(i)),Ember.none(h.height)?e=!0:c+=i}}),e||(c+=this.get("bottomMargin"),a.adjustLayout("height",c))}}),Ember.View.reopen({firstDescendantWithProperty:function(a){var b;return this.forEachChildView(function(c){b===undefined&&(c.get(a)?b=c:b=c.firstDescendantWithProperty(a))}),b}}),Flame.reopen({ALIGN_LEFT:"align-left",ALIGN_RIGHT:"align-right",ALIGN_CENTER:"align-center",POSITION_BELOW:1,POSITION_RIGHT:2,POSITION_LEFT:4,POSITION_ABOVE:8,POSITION_MIDDLE:16,FOCUS_RING_MARGIN:3}),Flame.View=Ember.ContainerView.extend(Flame.LayoutSupport,Flame.EventManager,{displayProperties:[],isFocused:!1,init:function(){this._super(),this.get("template")&&this.set("states",Ember.View.states);var a=this.get("displayProperties")||[];for(var b=0;b<a.length;b++){var c=a[b];this.addObserver(c,this,this.rerender)}},render:function(a){this._renderElementAttributes(a);var b=this.get("template");if(!b)return this._super(a);var c=b(this.get("templateContext"),{data:{view:this,buffer:a,isRenderData:!0}});c!==undefined&&a.push(c)},template:function(a,b){if(a==="template"&&b!==undefined)return b;var c=this.get("handlebars");return c?this._compileTemplate(c):null}.property("templateName","handlebars").cacheable(),_compileTemplate:function(a){var b=Flame._templateCache[a];return b||(Flame._templateCache[a]=b=Ember.Handlebars.compile(a)),b}}),Flame._templateCache={},Flame.ImageView=Flame.View.extend({templateContext:function(){return{value:this.get("value")}}.property("value"),handlebars:'<img {{bindAttr src="value"}}>'}),Flame.RootView=Flame.View.extend({rootView:!0}),Flame.LabelView=Flame.View.extend(Flame.ActionSupport,{layout:{left:0,top:0},classNames:["flame-label-view"],classNameBindings:["textAlign","isSelectable"],defaultHeight:22,defaultWidth:200,isSelectable:!1,handlebars:"{{value}}",render:function(a){var b=this.getPath("layout.height");this.get("useAbsolutePosition")&&!Ember.none(b)&&a.style("line-height",b+"px"),this._super(a)},mouseDown:function(a){return this.fireAction()},mouseUp:function(a){return!0}}),Flame.LabelView.reopenClass({label:function(a,b,c,d,e){return Flame.LabelView.extend({layout:{left:b,top:c,width:d,height:e},value:a})},binding:function(a,b,c,d,e){return Flame.LabelView.extend({layout:{left:b,top:c,width:d,height:e},valueBinding:a})}}),Flame._zIndexCounter=100,Flame.Panel=Flame.RootView.extend({classNames:["flame-panel"],childViews:["titleView","contentView"],destroyOnClose:!0,acceptsKeyResponder:!0,isModal:!0,allowClosingByClickingOutside:!0,allowMoving:!1,dimBackground:!0,title:null,isShown:!1,_keyResponderOnPopup:undefined,init:function(){ember_assert("Flame.Panel needs a contentView!",!!this.get("contentView")),this._super()},titleView:Flame.View.extend(Flame.Statechart,{layout:{left:0,right:0,height:26,bottomPadding:1},classNames:["flame-panel-title"],childViews:["labelView"],isVisibleBinding:Ember.Binding.from("parentView.title").isNull().not(),initialState:"idle"
,labelView:Flame.LabelView.extend({layout:{left:4,right:4,top:2},textAlign:Flame.ALIGN_CENTER,valueBinding:"parentView.parentView.title"}),idle:Flame.State.extend({mouseDown:function(a){var b=this.get("owner");if(!b.getPath("parentView.allowMoving"))return!0;b._pageX=a.pageX,b._pageY=a.pageY;var c=b.get("parentView").$().offset();return b._panelX=c.left,b._panelY=c.top,this.gotoState("moving"),!0}}),moving:Flame.State.extend({mouseMove:function(a){var b=this.get("owner"),c=b._panelX+(a.pageX-b._pageX),d=b._panelY+(a.pageY-b._pageY),e=b.get("parentView").$();return c=Math.max(5,Math.min(c,Ember.$(window).width()-e.outerWidth()-5)),d=Math.max(5,Math.min(d,Ember.$(window).height()-e.outerHeight()-5)),e.css({left:c,top:d,right:"",bottom:"",marginLeft:"",marginTop:""}),!0},mouseUp:Flame.State.gotoHandler("idle")})}),modalPane:function(){return Flame.RootView.create({layout:{left:0,top:0,right:0,bottom:0},classNames:["flame-modal-pane"],classNameBindings:["parentPanel.dimBackground"],parentPanel:null,mouseDown:function(){return this.getPath("parentPanel.allowClosingByClickingOutside")&&this.get("parentPanel").close(),!0}})}.property(),insertNewline:function(a){var b=this.firstDescendantWithProperty("isDefault");return b&&b.simulateClick&&b.simulateClick(),!0},_layoutRelativeTo:function(a,b){b=b||Flame.POSITION_BELOW;var c=this.get("layout"),d=a instanceof jQuery?a:a.$(),e=d.offset();b&Flame.POSITION_BELOW?(c.top=e.top+d.outerHeight(),c.left=e.left,b&Flame.POSITION_MIDDLE&&(c.left=c.left-c.width/2+d.outerWidth()/2)):b&(Flame.POSITION_RIGHT|Flame.POSITION_LEFT)?(c.top=e.top,c.left=e.left+(b&Flame.POSITION_RIGHT?d.outerWidth():-c.width),b&Flame.POSITION_MIDDLE&&(c.top=c.top-c.height/2+d.outerHeight()/2)):ember_assert("Invalid position for panel",!1);var f=Ember.$(window);return c.left+c.width>f.width()-10&&(c.left=f.width()-c.width-10),c.top+c.height>f.height()-10?c.top=f.height()-c.height-10:c.top<0&&(c.top=10),c},popup:function(a,b){if(!this.get("isShown")){if(this.get("isModal")){var c=this.get("modalPane");c.set("parentPanel",this),c.get("layout").zIndex=Flame._zIndexCounter,c.append(),this.set("_modalPane",c)}a&&this.set("layout",this._layoutRelativeTo(a,b)),this.get("layout").zIndex=Flame._zIndexCounter+10,Flame._zIndexCounter+=100,this.append(),this.set("isShown",!0),this.get("acceptsKeyResponder")&&this.becomeKeyResponder(!1),this._focusDefaultInput()}},close:function(){if(this.isDestroyed)return;this.get("isShown")&&(this.get("isModal")&&this.get("_modalPane").remove(),this.remove(),this.set("isShown",!1),this.get("acceptsKeyResponder")&&this.resignKeyResponder(),Flame._zIndexCounter-=100,this.get("destroyOnClose")&&this.destroy())},_focusDefaultInput:function(){Ember.run.next(this,function(){var a=this.firstDescendantWithProperty("isDefaultFocus");a&&a.becomeKeyResponder()})}}),Flame.ButtonView=Flame.View.extend(Flame.ActionSupport,Flame.Statechart,{defaultHeight:24,classNames:["flame-button-view"],classNameBindings:["isHovered","isActive","isSelected","isDisabled","isDefault","isFocused"],acceptsKeyResponder:!0,isHovered:!1,isActive:!1,isSelected:!1,isDisabled:!1,isDefault:!1,isSticky:!1,initialState:"idle",handlebars:"<label class='flame-button-label'>{{title}}</label>",render:function(a){var b=this.getPath("layout.height");this.get("useAbsolutePosition")&&!Ember.none(b)&&a.style("line-height",b-2+"px"),this._super(a)},insertSpace:function(a){return this.simulateClick(),!0},idle:Flame.State.extend({mouseEnter:function(){return this.gotoState("hover"),!0},simulateClick:function(){this.gotoState("hover"),this.get("owner").simulateClick(),Ember.run.later(this.get("owner"),"mouseLeave",150)}}),hover:Flame.State.extend({mouseLeave:function(){return this.gotoState("idle"),!0},mouseDown:function(){return this.getPath("owner.isDisabled")||this.gotoState("mouseDownInside"),!0},simulateClick:function(){this.mouseDown(),Ember.run.later(this.get("owner"),"mouseUp",100)},enterState:function(){this.get("owner").set("isHovered",!0)},exitState:function(){var a=this.get("owner");a.isDestroyed||a.set("isHovered",!1)}}),mouseDownInside:Flame.State.extend({mouseUp:function(){return this.get("owner").fireAction(),this.getPath("owner.isSticky")&&this.setPath("owner.isSelected",!this.getPath("owner.isSelected")),this.gotoState("hover"),!0},mouseLeave:function(){return this.gotoState("mouseDownOutside"),!0},enterState:function(){this.get("owner").set("isActive",!0)},exitState:function(){this.get("owner").set("isActive",!1)}}),mouseDownOutside:Flame.State.extend({mouseUp:function(){return this.gotoState("idle"),!0},mouseEnter:function(){return this.gotoState("mouseDownInside"),!0}})}),Flame.AlertPanel=Flame.Panel.extend(),Flame.AlertPanel.INFO_ICON=Flame.image("info_icon.png"),Flame.AlertPanel.WARN_ICON=Flame.image("warn_icon.png"),Flame.AlertPanel.ERROR_ICON=Flame.image("error_icon.png"),Flame.AlertPanel.reopen({layout:{centerX:0,centerY:-50,width:400,height:155},classNames:"flame-alert-panel".w(),icon:Flame.AlertPanel.INFO_ICON,isModal:!0,allowClosingByClickingOutside:!1,allowMoving:!0,isCancelVisible:!0,title:"",message:"",cancelButtonTitle:"Cancel",confirmButtonTitle:"OK",contentView:Flame.View.extend({layout:{left:15,right:15,top:36,bottom:15},childViews:"iconView messageView cancelButtonView okButtonView".w(),iconView:Flame.ImageView.extend({layout:{left:10,top:10},valueBinding:"parentView.parentView.icon"}),messageView:Flame.LabelView.extend({layout:{left:75,top:10,right:2,bottom:30},valueBinding:"parentView.parentView.message"}),cancelButtonView:Flame.ButtonView.extend({layout:{width:90,bottom:2,right:110},titleBinding:"parentView.parentView.cancelButtonTitle",isVisibleBinding:"parentView.parentView.isCancelVisible",action:function(){this.getPath("parentView.parentView").onCancel()}}),okButtonView:Flame.ButtonView.extend({layout:{width:90,bottom:2,right:2},titleBinding:"parentView.parentView.confirmButtonTitle",isDefault:!0,action:function(){this.getPath("parentView.parentView").onConfirm()}})}),cancel:function(){this.onCancel()},onConfirm:function(){this.close()},onCancel:function(){this.close()}}),Flame.AlertPanel.reopenClass({info:function(a){return a=jQuery.extend(a||{},{icon:Flame.AlertPanel.INFO_ICON,isCancelVisible:!1}),Flame.AlertPanel.create(a)},warn:function(a){return a=jQuery.extend(a||{},{icon:Flame.AlertPanel.WARN_ICON}),Flame.AlertPanel.create(a)},error:function(a){return a=jQuery.extend(a||{},{icon:Flame.AlertPanel.ERROR_ICON}),Flame.AlertPanel.create(a)}}),Flame.CheckboxView=Flame.ButtonView.extend({classNames:["flame-checkbox-view"],isSticky:!0,handlebars:null,render:function(a){this._super(a),a.push("<div class='flame-checkbox-box'></div>"),this.renderCheckMark(a);var b=Ember.none(this.get("title"))?"":this.get("title");a.push("<label class='flame-checkbox-label'>"+b+"</label>")},renderCheckMark:function(a){var b=Flame.image("checkmark.png");a.push("<div class='flame-view flame-checkbox-checkmark' style='left:5px;'><img src='"+b+"'></div>")}}),Flame.CollectionView=Ember.CollectionView.extend(Flame.LayoutSupport,Flame.EventManager,{classNames:["flame-list-view"],init:function(){this._super();var a=this.get("emptyView");a&&a.reopen({ensureEmptyViewRemoval:function(){this.get("parentView")||Ember.run.next(this,function(){this.get("isDestroyed")||this.remove()})}.observes("parentView")})}}),Flame.DisclosureView=Flame.LabelView.extend({classNames:["flame-disclosure-view"],imageExpanded:Flame.image("disclosure_triangle_down.png"),imageCollapsed:Flame.image("disclosure_triangle_left.png"),image:function(){return this.get("visibilityTarget")?this.get("imageExpanded"):this.get("imageCollapsed")}.property("visibilityTarget","imageExpanded","imageCollapsed"),handlebars:'<img {{bindAttr src="image"}}> {{value}}',action:function(){var a=this.getPath("visibilityTarget");return this.setPath("visibilityTarget",!a),!0}}),Flame.FormView=Flame.View.extend({classNames:["form-view"],tagName:"form",defaultTarget:null,object:null,properties:[],leftMargin:20,rightMargin:20,topMargin:20,bottomMargin:20,rowSpacing:10,columnSpacing:10,buttonSpacing:15,labelWidth:150,labelAlign:Flame.ALIGN_RIGHT,buttonWidth:90,controlWidth:null,defaultFocus:null,buttons:[],_focusRingMargin:3,_errorViews:[],init:function(){this._super(),this.set("layoutManager",Flame.VerticalStackLayoutManager.create({topMargin:this.get("topMargin"),spacing:this.get("rowSpacing"),bottomMargin:this.get("bottomMargin")})),this._propertiesDidChange()},_propertiesDidChange:function(){this.destroyAllChildren();var a=this,b=this.get("childViews");this.get("properties").forEach(function(c){var d=a._createLabelAndControl(c);b.push(a.createChildView(d))});var c=this.get("buttons");c&&c.get("length")>0&&b.push(this.createChildView(this._buildButtons(c)))}.observes("properties.@each"),_createLabelAndControl:function(a){a=Ember.Object.create(a);var b=a.view||this._buildControl(a),c=this;if(Ember.none(a.label))return this._createChildViewWithLayout(b,this,this.get("leftMargin")+this._focusRingMargin,this.get("rightMargin")+this._focusRingMargin);if(a.type==="checkbox")return this._createChildViewWithLayout(b,this,this.get("leftMargin")+this.labelWidth+this.columnSpacing-4,this._focusRingMargin);var d={layout:{left:this.get("leftMargin"),right:this.get("rightMargin")},layoutManager:Flame.VerticalStackLayoutManager.create({topMargin:this._focusRingMargin,spacing:0,bottomMargin:this._focusRingMargin}),childViews:["label","control"],isVisible:a.get("isVisible")===undefined?!0:a.get("isVisible"),label:this._buildLabel(a),control:function(){return c._createChildViewWithLayout(b,this,c.labelWidth+c.columnSpacing,c._focusRingMargin)}.property().cacheable()};return a.get("isVisibleBinding")&&(d.isVisibleBinding=a.get("isVisibleBinding")),Flame.View.extend(d)},_createChildViewWithLayout:function(a,b,c,d){var e=b.createChildView(a);return e.get("layout")||e.set("layout",{}),e.setPath("layout.left",c),e.setPath("layout.right",d),e},_buildLabel:function(a){return Flame.LabelView.extend({layout:{left:0,width:this.get("labelWidth"),top:this._focusRingMargin},ignoreLayoutManager:!0,textAlign:this.get("labelAlign"),value:a.get("label")+":"})},_buildButtons:function(a){var b=this;return Flame.View.extend({layout:{left:this.get("leftMargin"),right:this.get("rightMargin"),topMargin:this.get("buttonSpacing"),height:30},init:function(){this._super();var c=this.get("childViews"),d=b._focusRingMargin,e=this;(a||[]).forEach(function(a){var f=e.createChildView(b._buildButton(a,d));d+=(f.getPath("layout.width")||0)+15,c.push(f)})}})},_buildButton:function(a,b){var c=jQuery.extend({targetBinding:"^defaultTarget"},a);return c.layout||(c.layout={width:this.get("buttonWidth"),right:b}),c.layout.top=this._focusRingMargin,a.target&&delete c.targetBinding,Flame.ButtonView.extend(c)},_buildValidationObservers:function(a){if(Ember.none(a))return{};var b=this;return{didInsertElement:function(){this._super(),this.isValidDidChange()},isValidWillChange:function(){var a=this.get("_errorView");a&&!this.get("isValid")&&(a.remove(),this.set("_errorView",null),b._errorViews=b._errorViews.without(a))}.observesBefore("isValid"),isValidDidChange:function(){if(!this.get("isValid")&&!this.get("_errorView")){var c=this.$(),d=c.offset();if(Ember.none(d))return;var e=Flame._zIndexCounter,f=Flame.LabelView.extend({classNames:"flame-form-view-validation-error".w(),textAlign:Flame.ALIGN_LEFT,layout:{top:d.top-7,left:d.left+c.outerWidth()-4,width:null,height:null,zIndex:e},value:a,handlebars:'<div class="error-triangle"></div><div class="error-box">{{value}}</div>'}).create().append();this.set("_errorView",f),b._errorViews.push(f)}}.observes("isValid")}},_buildControl:function(a){var b=a.get("property"),c=this.get("object"),d={layout:{topPadding:1,bottomPadding:1,width:this.get("controlWidth")},valueBinding:"^object.%@".fmt(b),isValidBinding:Ember.Binding.from("^object.%@IsValid".fmt(b)).transform(function(a){return a!==!1})};this.get("defaultFocus")===b&&(d.isDefaultFocus=!0);var e=a.get("validate");e&&(c.get("validations")||c.set("validations",{}),c.setValidationFor(b,e)),jQuery.extend(d,this._buildValidationObservers(a.get("validation")));var f=a.get("type")||"text";if(a.options||a.optionsBinding)f="select";if(Ember.none(d.action)&&(f==="text"||f==="textarea"||f==="password")){var g=this;d.fireAction=function(){var a=g.firstDescendantWithProperty("isDefault");a&&a.simulateClick&&a.simulateClick()}}return d.classNames=d.classNames||[],d.classNames.push("form-view-"+f),this._buildControlView(d,f,a)},_buildControlView:function(a,b,c){switch(b){case"readonly":return a.isEditable=!0,a.isSelectable=c.get("isSelectable")===!1?!1:!0,Flame.LabelView.extend(a);case"text":return Flame.TextFieldView.extend(a);case"textarea":return a.layout.height=c.height||70,Flame.TextAreaView.extend(a);case"password":return a.isPassword=!0,Flame.TextFieldView.extend(a);case"html":return Flame.LabelView.extend(jQuery.extend(a,{escapeHTML:!1,formatter:function(a){return a===null?"":a}}));case"checkbox":return a.title=c.label,a.isSelectedBinding=a.valueBinding,delete a.valueBinding,Flame.CheckboxView.extend(a);case"select":return a.itemValueKey=c.itemValueKey||"value",a.subMenuKey=c.subMenuKey||"subMenu",c.optionsBinding?(a.itemTitleKey=c.itemTitleKey||"name",a.itemsBinding=c.optionsBinding):c.options&&(a.itemTitleKey=c.itemTitleKey||"title",a.items=c.options),Flame.SelectButtonView.extend(a)}throw"Invalid control type %@".fmt(b)},willDestroyElement:function(){this._errorViews.forEach(function(a){a.remove()})}}),Flame.HorizontalSplitView=Flame.View.extend({classNames:["flame-horizontal-split-view"],childViews:["leftView","dividerView","rightView"],allowResizing:!0,leftWidth:100,rightWidth:100,minLeftWidth:0,minRightWidth:0,dividerWidth:7,flex:"right",resizeInProgress:!1,_unCollapsedLeftWidth:undefined,_unCollapsedRightWidth:undefined,_resizeStartX:undefined,_resizeStartLeftWidth:undefined,_resizeStartRightWidth:undefined,init:function(){ember_assert("Flame.HorizontalSplitView needs leftView and rightView!",!!this.get("leftView")&&!!this.get("rightView")),this._super(),this.get("flex")==="right"?this.rightWidth=undefined:this.leftWidth=undefined,this._updateLayout(),this.addObserver("leftWidth",this,this._updateLayout),this.addObserver("rightWidth",this,this._updateLayout),this.addObserver("minLeftWidth",this,this._updateLayout),this.addObserver("minRightWidth",this,this._updateLayout)},_updateLayout:function(){var a=this.get("leftView"),b=this.get("dividerView"),c=this.get("rightView"),d=Ember.$(this.get("element")).innerWidth(),e=this.get("dividerWidth"),f=this.get("flex")==="right"?this.get("leftWidth"):undefined,g=this.get("flex")==="left"?this.get("rightWidth"):undefined;f===undefined&&g!==undefined&&d!==null&&(f=d-g-e),g===undefined&&f!==undefined&&d!==null&&(g=d-f-e),"number"==typeof f&&f<this.get("minLeftWidth")&&(g+=f-this.get("minLeftWidth"),f=this.get("minLeftWidth")),"number"==typeof g&&g<this.get("minRightWidth")&&(f+=g-this.get("minRightWidth"),g=this.get("minRightWidth")),this.set("leftWidth",f),this.set("rightWidth",g),this.get("flex")==="right"?(this._setDimensions(a,0,f,undefined),this._setDimensions(b,f,e,undefined),this._setDimensions(c,f+e,undefined,0)):(this._setDimensions(a,0,undefined,g+e),this._setDimensions(b,undefined,e,g),this._setDimensions(c,undefined,g,0))},_setDimensions:function(a,b,c,d){var e=a.get("layout");e.set("left",b),e.set("width",c),e.set("right",d),e.set("top",0),e.set("bottom",0),a.updateLayout()},toggleCollapse:function(a){this.get("allowResizing")&&(this.get("flex")==="right"?this.get("leftWidth")===this.get("minLeftWidth")&&this._unCollapsedLeftWidth!==undefined?this.set("leftWidth",this._unCollapsedLeftWidth):(this._unCollapsedLeftWidth=this.get("leftWidth"),this.set("leftWidth",this.get("minLeftWidth"))):this.get("rightWidth")===this.get("minRightWidth")&&this._unCollapsedRightWidth!==undefined?this.set("rightWidth",this._unCollapsedRightWidth):(this._unCollapsedRightWidth=this.get("rightWidth"),this.set("rightWidth",this.get("minRightWidth"))),this.endResize())},startResize:function(a){return this.get("allowResizing")?(this.set("resizeInProgress",!0),this._resizeStartX=a.pageX,this._resizeStartLeftWidth=this.get("leftWidth"),this._resizeStartRightWidth=this.get("rightWidth"),!0):!1},resize:function(a){return this.get("resizeInProgress")?(this.get("flex")==="right"?this.set("leftWidth",this._resizeStartLeftWidth+(a.pageX-this._resizeStartX)):this.set("rightWidth",this._resizeStartRightWidth-(a.pageX-this._resizeStartX)),!0):!1},endResize:function(a){return this.set("resizeInProgress",!1),!0},dividerView:Flame.View.extend({classNames:["flame-split-view-divider"],mouseDown:function(a){return this.get("parentView").startResize(a)},mouseMove:function(a){return this.get("parentView").resize(a)},mouseUp:function(a){return this.get("parentView").endResize(a)},doubleClick:function(a){return this.get("parentView").toggleCollapse(a)}})}),Flame.ListItemView=Flame.View.extend({useAbsolutePosition:!1,classNames:["flame-list-item-view"],classNameBindings:["isSelected","parentView.allowReordering","isDragged"],isSelected:!1,_parentViewOnMouseDown:undefined,displayProperties:["content"],acceptsKeyResponder:!1,childListView:null,mouseMove:function(a){return this._parentViewOnMouseDown!==undefined?this._parentViewOnMouseDown.mouseMove(a):!1},mouseDown:function(a){return this._parentViewOnMouseDown=this.get("parentView"),this._parentViewOnMouseDown.mouseDownOnItem(this.get("contentIndex"),a)},mouseUp:function(a){if(this._parentViewOnMouseDown!==undefined){var b=this._parentViewOnMouseDown;return this._parentViewOnMouseDown=undefined,b.mouseUpOnItem(a)}return!1}}),Flame.ListViewDragHelper=Ember.Object.extend({listView:undefined,lastPageX:undefined,yOffset:undefined,itemPath:undefined,lastTargetContent:null,clone:undefined,mouseMoveCounter:0,initReorder:function(){var a=Flame.ListViewDragHelper.Path.create({array:this.itemPath,root:this.listView});this.itemPath=a,this.reorderCssClass=this.isTree()?".flame-tree-item-view-container":".flame-list-item-view";var b=this.itemPath.getView();b.set("isDragged",!0);var c=b.$(),d=c.clone();d.attr("id",c.attr("id")+"_drag"),d.addClass("is-dragged-clone"),d.appendTo(this.get("listView").$()),d.css("opacity",.8),this.set("clone",d),this._updateCss();var e=this.get("listView");d.mousemove(function(a){return e.mouseMove.apply(e,arguments),!0}),d.mouseup(function(a){return e.mouseUp.apply(e,arguments),!0})},updateDisplay:function(a,b){if(b===undefined)this.mouseMoveCounter++;else if(b<this.mouseMoveCounter)return!1;this._updateDraggingCloneAndScrollPosition(a);var c=this._resolveNewPath(a.pageX,a.pageY);if(c&&!this.itemPath.equals(c)){var d=this.itemPath.getView();this._moveItem(this.itemPath,c),this.itemPath=this._resolvePath(d),this._updateCss(),this.lastPageX=a.pageX}return!0},finishReorder:function(){var a=this.itemPath.getView();this.get("listView").didReorderContent(a.getPath("parentView.content")),a.set("isDragged",!1),this.clone.remove()},_updateCss:function(){var a=this.itemPath.getView().$(),b=this.clone.offsetParent().offset().left;this.clone.attr("class",a.attr("class")+" is-dragged-clone"),this.clone.css("left",a.offset().left-b);var c=this.itemPath.getView().$().find(".flame-tree-item-view",".flame-tree-view"),d=this.clone.find(".flame-tree-item-view",".flame-tree-view");d.each(function(a){var d=jQuery(this),e=jQuery(c.get(a));d.attr("class",e.attr("class")),b=d.offsetParent().offset().left,d.css("left",e.offset().left-b)})},_moveItem:function(a,b){var c=a.getView(),d=c.get("content"),e=c.get("parentView"),f=e.get("content"),g=c.$(),h=b.getView(),i=h.$(),j=b.position==="i"?b.getNestedListView():h.get("parentView"),k=j.get("content"),l=j.get("childViews");f===k&&f.startMoving&&f.startMoving(),e.get("childViews").removeObject(c),f.removeObject(d),e._updateContentIndexes(),g.detach();var m=h.get("contentIndex");if(b.position==="b")g.insertBefore(i),l.insertAt(m,c),k.insertAt(m,d);else if(b.position==="a")g.insertAfter(i),l.insertAt(m+1,c),k.insertAt(m+1,d);else{if(b.position!=="i")throw"Invalid insert position "+b.position;i.find(".flame-list-view").first().prepend(g),l.insertAt(0,c),k.insertAt(0,d)}f===k&&f.endMoving&&f.endMoving(),c.set("_parentView",j),j._updateContentIndexes()},isTree:function(){return this.listView instanceof Flame.TreeView},_resolveNewPath:function(a,b){var c=this.itemPath.getView(),d=c.$(),e=this.get("listView").$().find(this.reorderCssClass),f=this.isTree()?d.children(this.reorderCssClass).first():d,g=e.index(f);ember_assert("Start element not found",g>=0);var h=this.clone.offset().top,i=h+this.clone.outerHeight(),j=h-d.offset().top,k=j>0?1:-1,l=g+k,m=e.length,n=g;while(l>=0&&l<m){var o=jQuery(e[l]);if(o.closest(".is-dragged-clone").length>0)break;if(o.is(":visible")&&o.closest(d).length===0){var p=o.offset().top+o.outerHeight()*(.5+k*.2);if(!(k>0&&i>p||k<0&&h<p))break;n=l}l+=k}var q=Ember.View.views[jQuery(e[n]).closest(".flame-list-item-view").attr("id")],r=this._resolvePath(q),s=k>0&&q.get("hasChildren")&&q.get("isExpanded")&&!this._pathInvalid(c,r);return s||(k>0?r.position="a":r.position="b"),r=this._resolveNewLevel(c,q,r,a),this._pathInvalid(c,r)?null:r},_resolveNewLevel:function(a,b,c,d){var e=d-this.lastPageX,f=10;while((e<-f||this._pathInvalid(a,c))&&(c.position==="a"||this.itemPath.equals(c))&&c.array.length>1&&b.get("contentIndex")===b.getPath("parentView.childViews.length")-1)e+=f,c=c.up(),b=c.getView();var g;while((e>f||this._pathInvalid(a,c))&&(c.position!=="i"||this.itemPath.equals(c))&&(g=this._getPrecedingView(b))!==undefined&&g!==a&&g.get("hasChildren")&&g.get("isExpanded")&&!this._pathInvalid(a,this._resolvePath(g).down()))e-=f,c=this._resolvePath(g).down(),b=c.getView();return c},_pathInvalid:function(a,b){var c=a.get("content"),d=b.getView().get("content"),e=null;if(b.position==="i")e=d;else{var f=b.up().getView();f&&(e=f.get("content"))}var g=this.get("listView").isValidDrop(c,e);return!g},_getPrecedingView:function(a){return a.get("contentIndex")>0?a.getPath("parentView.childViews").objectAt(a.get("contentIndex")-1):undefined},_resolvePath:function(a){var b=[],c=a.get("parentView");do b.insertAt(0,a.get("contentIndex")),c=a.get("parentView");while(c.get("isNested")&&(a=c.get("parentView"))!==undefined);return Flame.ListViewDragHelper.Path.create({array:b,root:this.listView})},_updateDraggingCloneAndScrollPosition:function(a){var b=this.get("listView").$();b.hasClass("is-nested")&&(b=b.offsetParent());var c=b.scrollTop(),d=b.innerHeight(),e=a.pageY-this.yOffset-b.offset().top+c;e<0&&(e=0);var f=this.clone.outerHeight(),g=b[0].scrollHeight;e+f>g&&(e=g-f),this.clone.css({position:"absolute",right:0,top:e});if(b.css("overflow")==="auto"){var h=c-e;h>0&&b.scrollTo("-=%@px".fmt(Math.max(h/5,1)));var i=e+f-(c+d);i>0&&b.scrollTo("+=%@px".fmt(Math.max(i/5,1)));if(h>0||i>0){var j=this.mouseMoveCounter;Ember.run.next(this,function(){this.updateDisplay(a,j)})}}}}),Flame.ListViewDragHelper.Path=Ember.Object.extend({array:[],position:"i",root:null,getView:function(){var a,b,c=this.array.length,d=this.root;for(b=0;b<c;b++){var e=this.array[b];a=d.get("childViews").objectAt(e),b<c-1&&(d=a.get("childListView"))}return a},getNestedListView:function(){return this.getView().get("childListView")},up:function(){var a=this.array.slice(0,this.array.length-1);return Flame.ListViewDragHelper.Path.create({array:a,position:"a",root:this.root})},down:function(){var a=Ember.copy(this.array),b,c=this.getNestedListView().getPath("content.length");return c>0?(a.push(c-1),b="a"):b="i",Flame.ListViewDragHelper.Path.create({array:a,position:b,root:this.root})},equals:function(a){var b=this.array.length,c=a.array.length;if(b!==c)return!1;for(var d=0;d<b;d++)if(this.array[d]!==a.array[d])return!1;return!0}}),Flame.ListView=Flame.CollectionView.extend(Flame.Statechart,{classNames:["flame-list-view"],classNameBindings:["isFocused"],acceptsKeyResponder:!0,allowSelection:!0,allowReordering:!0,selection:undefined,initialState:"idle",reorderDelegate:null,itemViewClass:Flame.ListItemView.extend({templateContext:function(a,b){return b!==undefined?b:Ember.get(this,"content")}.property("content").cacheable(),templateBinding:"parentView.template",handlebars:"{{title}}"}),selectIndex:function(a){if(!this.get("allowSelection"))return!1;var b=this.get("content");if(b){var c=this.get("childViews").objectAt(a);if(c&&c.get("isVisible")&&c.get("allowSelection")!==!1){var d=b.objectAt(a);return this.set("selection",d),!0}}return!1},changeSelection:function(a){var b=this.get("content"),c=this.get("selection"),d=b.indexOf(c),e=d+a,f=b.get("length");while(e>=0&&e<f){if(this.selectIndex(e))return!0;e+=a}return!1},_selectionWillChange:function(){this._setIsSelectedStatus(this.get("selection"),!1)}.observesBefore("selection"),_selectionDidChange:function(){this._setIsSelectedStatus(this.get("selection"),!0)}.observes("selection"),_setIsSelectedStatus:function(a,b){if(a){var c=(this.get("content")||[]).indexOf(a);if(c>=0){var d=this.get("childViews").objectAt(c);d&&d.set("isSelected",b)}}},_updateContentIndexes:function(){var a=this.get("childViews"),b=a.get("length");for(var c=0;c<b;c++){var d=a.objectAt(c);d&&d.set("contentIndex",c)}this.consultLayoutManager()},didReorderContent:function(a){var b=this.get("reorderDelegate");b&&Ember.run.next(function(){b.didReorderContent(a)})},isValidDrop:function(a,b){var c=this.get("reorderDelegate");return c&&c.isValidDrop?c.isValidDrop(a,b):!0},rootTreeView:function(){return this}.property(),arrayWillChange:function(a,b,c){if(!this.getPath("rootTreeView.isDragging"))return this._super.apply(this,arguments)},arrayDidChange:function(a,b,c,d){if(!this.getPath("rootTreeView.isDragging")){var e=this._super.apply(this,arguments);return this._updateContentIndexes(),e}},childViewsWillChange:function(){if(!this.getPath("rootTreeView.isDragging"))return this._super.apply(this,arguments)},childViewsDidChange:function(){if(!this.getPath("rootTreeView.isDragging"))return this._super.apply(this,arguments)},normalize:function(a){},allowReorderingItem:function(a){return!0},isValidReorderOperation:function(a,b){return!0},idle:Flame.State.extend({moveUp:function(){return this.get("owner").changeSelection(-1)},moveDown:function(){return this.get("owner").changeSelection(1)},mouseDownOnItem:function(a,b){var c=this.get("owner");c.selectIndex(a);if(c.get("allowReordering")&&a!==undefined&&c.allowReorderingItem(a)){var d=c.get("childViews").objectAt(a);c.set("dragHelper",Flame.ListViewDragHelper.create({listView:c,lastPageX:b.pageX,yOffset:b.pageY-d.$().offset().top,itemPath:[a]}))}return this.gotoState("mouseButtonPressed"),!0},enterState:function(){this.get("owner").set("dragHelper",undefined)}}),startReordering:function(a,b){return a.set("listView",this),this.set("dragHelper",a),this.gotoState("reordering"),this.mouseMove(b)},mouseButtonPressed:Flame.State.extend({mouseUpOnItem:Flame.State.gotoHandler("idle"),mouseUp:Flame.State.gotoHandler("idle"),mouseMove:function(a){var b=this.get("owner");if(b.get("dragHelper")){var c=b.get("dragHelper");this.gotoState("idle"),b.startReordering(c,a)}return!0}}),reordering:Flame.State.extend({mouseMove:function(a,b,c){return this.get("owner").get("dragHelper").updateDisplay(a)},mouseUp:Flame.State.gotoHandler("idle"),enterState:function(){var a=this.get("owner");a.get("dragHelper").initReorder(),a.set("isDragging",!0)},exitState:function(){var a=this.get("owner");a.get("dragHelper").finishReorder(),a.set("dragHelper",undefined),a.set("isDragging",!1)}})}),Flame.LoadingIndicatorView=Flame.ImageView.extend({layout:{width:16,height:16},classNames:["loading-indicator"],value:Flame.image("loading.gif")}),Flame.ScrollViewButton=Flame.View.extend({classNames:"scroll-element".w(),classNameBindings:"directionClass isShown".w(),directionClass:function(){return"scroll-%@".fmt(this.get("direction"))}.property(),isShown:!1,direction:"down",useAbsolutePosition:!0,mouseLeave:function(){return this.get("isShown")?(this.get("parentView").stopScrolling(),!0):!1},mouseEnter:function(){return this.get("isShown")?(this.get("parentView").startScrolling(this.get("direction")==="up"?-1:1),!0):!1},mouseDown:function(){return!0},mouseUp:function(){return!0}}),Flame.ScrollView=Flame.View.extend({classNames:"scroll-view".w(),useAbsolutePosition:!0,needScrolling:!1,scrollDirection:0,scrollPosition:"top",childViews:"upArrow viewPort downArrow".w(),scrollSize:30,viewPort:Flame.View.extend({useAbsolutePosition:!0,classNames:"scroll-view-viewport".w()}),upArrow:Flame.ScrollViewButton.extend({direction:"up",layout:{height:20,top:0,width:"100%"}}),downArrow:Flame.ScrollViewButton.extend({direction:"down",layout:{height:20,bottom:0,width:"100%"}}),willDestroyElement:function(){this._super(),this.stopScrolling()},setScrolledView:function(a){this.getPath("viewPort.childViews").replace(0,1,[a])},scrollPositionDidChange:function(){var a=this.get("upArrow"),b=this.get("downArrow"),c=this.get("scrollPosition");a.set("isShown",this.get("needScrolling")&&c!=="top"),b.set("isShown",this.get("needScrolling")&&c!=="bottom")}.observes("scrollPosition","needScrolling"),startScrolling:function(a){this.set("scrollDirection",a),this.scroll()},stopScrolling:function(){this.set("scrollDirection",0),this._timer&&Ember.run.cancel(this._timer)},_recalculateSizes:function(){var a=this.getPath("parentView.layout.height");if(a>0){var b=12;this.set("layout",{height:a-b,width:"100%"});var c=this.get("viewPort");c&&c.set("layout",{height:a-b,top:0,width:"100%"})}}.observes("parentView.layout.height","needScrolling"),_scrollTo:function(a,b){var c=this.get("viewPort").$();c.scrollTo(a,{duration:b})},scroll:function(){var a=this.get("scrollDirection"),b=200,c=this.get("scrollSize"),d=this.get("viewPort").$(),e=d.scrollTop(),f=d.height(),g=!0,h=this.get("scrollPosition"),i=c;if(a===-1)i>e&&(i=e,g=!1);else if(a===1){var j=this.getPath("viewPort.childViews.firstObject").$().outerHeight(),k=e+f;k+i>=j&&(i=j-k,g=!1)}i*=a,this._scrollTo(e+i,.9*b*Math.abs(i/c)),g?(this._timer=Ember.run.later(this,this.scroll,b),h="middle"):(a===1?h="bottom":a===-1&&(h="top"),this.stopScrolling()),this.set("scrollPosition",h)}}),Flame.MenuItem=function(a){var b;for(b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);this.renderToElement=function(){var a=["flame-view","flame-list-item-view","flame-menu-item-view"];this.isSelected&&a.push("is-selected"),this.isChecked&&a.push("is-checked");var b=Ember.none(this.subMenuItems)?-1:this.subMenuItems.get("length"),c=["menu-indicator"];this.isEnabled()?b>0&&c.push("is-enabled"):a.push("is-disabled");var d=Handlebars.Utils.escapeExpression(this.title),e="<div id='%@' class='%@'><div class='title'>%@</div><div class='%@'></div></div>",f=e.fmt(this.id,a.join(" "),d,c.join(" "));return f},this.isEnabled=function(){return!(this.isDisabled||this.subMenuItems&&this.subMenuItems.length===0)},this.isSelectable=function(){return this.isEnabled()&&!this.subMenuItems},this.elementSelector=function(){return Ember.$("#%@".fmt(this.id))},this.closeSubMenu=function(){var a=this.subMenuView;Ember.none(a)||(a.close(),this.subMenuView=null)}},Flame.MenuView=Flame.Panel.extend(Flame.ActionSupport,{layout:{width:200},classNames:["flame-menu"],childViews:["contentView"],contentView:Flame.ScrollView,dimBackground:!1,subMenuKey:"subMenu",itemTitleKey:"title",itemEnabledKey:"isEnabled",itemCheckedKey:"isChecked",itemValueKey:"value",itemActionKey:"action",itemHeight:21,menuMargin:12,items:[],parentMenu:null,value:null,_allItemsDoNotFit:!0,_anchorElement:null,_menuItems:[],highlightIndex:-1,userHighlightIndex:-1,internalSelection:undefined,init:function(){this._super(),this._needToRecreateItems()},_createMenuItems:function(){var a=this.get("items"),b=this.get("itemCheckedKey"),c=this.get("itemEnabledKey"),d=this.get("itemTitleKey"),e=this.get("itemValueKey"),f=this.get("subMenuKey"),g=this.get("value"),h;return h=a.map(function(a,h){return new Flame.MenuItem({item:a,isSelected:Ember.get(a,e)===g,isDisabled:Ember.get(a,c)===!1,isChecked:Ember.get(a,b),subMenuItems:Ember.get(a,f),title:Ember.get(a,d),id:this._indexToId(h)})},this),h},_needToRecreateItems:function(){var a=this._createMenuItems();this.set("_menuItems",a),Ember.none(this.get("parentMenu"))&&a.forEach(function(a,b){a.isSelected&&this.set("highlightIndex",b)},this),this.getPath("contentView").setScrolledView(this._createMenuView()),this.get("_anchorElement")&&this._updateMenuSize()}.observes("items","elementId"),_createMenuView:function(){var a=this.get("_menuItems");return Flame.View.create({useAbsolutePosition:!1,render:function(b){var c=a.map(function(a){return a.renderToElement()});b.push(c.join(""))}})},makeSelection:function(){var a=this.get("parentMenu"),b,c;if(!Ember.none(a))a.makeSelection
(),this.close();else{var d=this.get("internalSelection");typeof d!="undefined"&&(c=Ember.get(d,this.get("itemValueKey")),this.set("value",c),b=Ember.get(d,this.get("itemActionKey"))||this.get("action")),Ember.run.sync(),this.close(),Ember.none(b)||this.fireAction(b,c)}},createSubMenu:function(a){return Flame.MenuView.create({items:a,parentMenu:this,subMenuKey:this.get("subMenuKey"),itemEnabledKey:this.get("itemEnabledKey"),itemTitleKey:this.get("itemTitleKey"),itemValueKey:this.get("itemValueKey"),itemHeight:this.get("itemHeight"),isModal:!1})},closeCurrentlyOpenSubMenu:function(){var a=this.get("highlightIndex");a>=0&&this.get("_menuItems").objectAt(a).closeSubMenu()},popup:function(a,b){var c=a instanceof jQuery?a:a.$();this._super(c,b),this.set("_anchorElement",c),this._updateMenuSize()},_updateMenuSize:function(){var a=this.get("_anchorElement"),b=5,c=5,d=1,e=b+c,f=this.get("menuMargin"),g=this.get("_menuItems").get("length")*this.get("itemHeight")+e+2*d,h=$(window).height(),i=a.offset().top,j=a.outerHeight(),k=this.get("layout"),l=!Ember.none(this.get("parentMenu")),m=h-i+(l?d+b:-j),n=!1;g+f*2<=h?l&&m>=g+f?k.set("top",i-(d+b)):m<g+f&&k.set("top",h-(g+f)):(g=h-2*f,k.set("top",f),n=!0),k.set("height",g),this.set("layout",k),this.get("contentView").set("needScrolling",n)},close:function(){if(this.isDestroyed)return;this.set("highlightIndex",-1),this._clearKeySearch(),this._super()},mouseDown:function(){return!0},cancel:function(){this.close()},moveUp:function(){return this._selectNext(-1)},moveDown:function(){return this._selectNext(1)},moveRight:function(){return this._tryOpenSubmenu(!0),!0},moveLeft:function(){var a=this.get("parentMenu");return Ember.none(a)||a.closeCurrentlyOpenSubMenu(),!0},insertNewline:function(){return this.makeSelection(),!0},keyPress:function(a){var b=String.fromCharCode(a.which);return a.which>31&&b!==""?(this._doKeySearch(b),!0):!1},handleMouseEvents:function(a){var b=this._idToIndex(a.currentTarget.id),c=!1;return a.type==="mouseenter"?c=this.mouseEntered(b):a.type==="mouseup"?c=this.mouseClicked(b):a.type==="mousedown"&&(c=!0),!c},mouseClicked:function(a){return this.set("highlightIndex",a),this.get("userHighlightIndex")>=0&&this.makeSelection(),!0},mouseEntered:function(a){return this.set("userHighlightIndex",a),this._tryOpenSubmenu(!1),!0},_selectNext:function(a){var b=this.get("_menuItems"),c=b.get("length"),d,e=this.get("highlightIndex")+a;for(;e>=0&&e<c;e+=a){d=b.objectAt(e);if(d.isEnabled()){this.set("highlightIndex",e);break}}return this._clearKeySearch(),!0},_valueDidChange:function(){var a=this.get("value"),b=this.get("itemValueKey");if(!Ember.none(a)&&!Ember.none(b)){var c=this._findIndex(function(c){return Ember.get(c,b)===a});c>=0&&this.set("highlightIndex",c)}}.observes("value"),_internalSelectionDidChange:function(){var a=this.get("internalSelection");Ember.trySetPath(this,"parentMenu.internalSelection",a)}.observes("internalSelection"),_findIndex:function(a){var b=this.get("items"),c=0,d=b.get("length");for(;c<d;c++)if(a(b.objectAt(c)))return c;return-1},_findByName:function(a){var b=new RegExp("^"+a,"i"),c=this.get("itemTitleKey");return this._findIndex(function(a){return b.test(Ember.get(a,c))})},_toggleClass:function(a,b,c){var d=this.get("_menuItems").objectAt(b);d.elementSelector().toggleClass(a,c)},_highlightWillChange:function(){var a=this.get("highlightIndex"),b=this.get("_menuItems").objectAt(a);Ember.none(b)||(this._toggleClass("is-selected",a),b.isSelected=!1,b.closeSubMenu())}.observesBefore("highlightIndex"),_highlightDidChange:function(){var a=this.get("highlightIndex"),b=this.get("_menuItems").objectAt(a),c;Ember.none(b)||(this._toggleClass("is-selected",a),b.isSelected=!0,b.isSelectable()&&(c=b.item)),this.set("internalSelection",c)}.observes("highlightIndex"),_userHighlightIndexDidChange:function(){this.set("highlightIndex",this.get("userHighlightIndex"))}.observes("userHighlightIndex"),_clearKeySearch:function(){Ember.none(this._timer)||Ember.run.cancel(this._timer),this._searchKey=""},_doKeySearch:function(a){this._searchKey=(this._searchKey||"")+a;var b=this._findByName(this._searchKey);b>=0&&this.set("highlightIndex",b),Ember.none(this._timer)||Ember.run.cancel(this._timer),this._timer=Ember.run.later(this,this._clearKeySearch,1e3)},_indexToId:function(a){return"%@-%@".fmt(this.get("elementId"),a)},_idToIndex:function(a){var b=new RegExp("%@-(\\d+)".fmt(this.get("elementId"))),c=b.exec(a);return c&&c.length===2?parseInt(c[1],10):-1},_tryOpenSubmenu:function(a){var b=this.get("highlightIndex"),c=this.get("_menuItems").objectAt(b),d=c.subMenuItems;if(!Ember.none(d)&&c.isEnabled()&&d.get("length")>0){this._clearKeySearch();var e=c.subMenuView;return Ember.none(e)&&(e=this.createSubMenu(d),c.subMenuView=e),e.popup(c.elementSelector(),Flame.POSITION_RIGHT),a&&e._selectNext(1),!0}return!1},didInsertElement:function(){this._super();var a=this,b=this.get("elementId"),c="mouseenter.%@ mouseup.%@ mousedown.%@".fmt(b,b,b);Ember.$("#%@".fmt(b)).on(c,".flame-menu-item-view",function(b){return a.handleMouseEvents(b)})}}),Flame.Popover=Flame.Panel.extend({classNames:["flame-popover"],childViews:[],dimBackground:!1,arrow:"arrow",handlebars:'<img {{bindAttr class="arrowPosition arrow"}} {{bindAttr src="image"}} />{{view contentView}}',anchor:null,position:null,_positionArrow:function(){var a=this.get("anchor"),b=this.get("position"),c=this.$("img.arrow"),d=a.offset(),e;b&(Flame.POSITION_ABOVE|Flame.POSITION_BELOW)?(e=d.left+a.outerWidth()/2-parseInt(this.$().css("left").replace("px",""),10)-15,c.css({left:e+"px"})):(e=d.top+a.outerHeight()/2-parseInt(this.$().css("top").replace("px",""),10)-15,c.css({top:e+"px"}),b&Flame.POSITION_LEFT&&c.css({left:this.getPath("layout.width")-1+"px"}))},_layoutRelativeTo:function(a,b){a=a instanceof jQuery?a:a.$(),this.set("anchor",a),this.set("position",b);var c=this._super(a,b);return b&Flame.POSITION_ABOVE?(c.top-=15,this.set("arrowPosition","above"),this.set("image",Flame.image("arrow_down.png"))):b&Flame.POSITION_BELOW?(c.top+=15,this.set("arrowPosition","below"),this.set("image",Flame.image("arrow_up.png"))):b&Flame.POSITION_LEFT?(c.left-=15,this.set("arrowPosition","left"),this.set("image",Flame.image("arrow_right.png"))):b&Flame.POSITION_RIGHT&&(c.left+=15,this.set("arrowPosition","right"),this.set("image",Flame.image("arrow_left.png"))),c},didInsertElement:function(){this._positionArrow()},popup:function(a,b){ember_assert("Flame.Popover.popup requires an anchor",!!a),ember_assert("Flame.Popover.popup requires a position",!!b),this._super(a,b|Flame.POSITION_MIDDLE)}}),Flame.ProgressView=Flame.View.extend({classNames:["flame-progress-view"],animate:!1,handlebars:function(){var a=this.get("layout").height;return"<div style='height: %@px;' class='progress-container'></div><div style='height: %@px; width: %@px;' class='progress-bar'></div>".fmt(a-2,a-4,this.get("size"))}.property().cacheable(),size:function(){var a=this.get("value")/this.get("maximum");if(isNaN(a))return 0;var b=this.get("layout").width;return a>1&&(a=1),Math.floor(b*a)-4}.property("value","maximum"),_sizeDidChange:function(){Ember.run.next(this,function(){this.get("animate")?this.$(".progress-bar").animate({width:this.get("size")},300):this.$(".progress-bar").css("width",this.get("size"))})}.observes("size")}),Flame.RadioButtonView=Flame.CheckboxView.extend({classNames:["flame-radio-button-view"],action:function(){this.set("targetValue",this.get("value"))},isSelected:function(){return Ember.typeOf(this.get("value"))==="undefined"||Ember.typeOf(this.get("targetValue"))==="undefined"?!1:this.get("value")===this.get("targetValue")}.property("targetValue","value").cacheable(),renderCheckMark:function(a){a.push("<div class='flame-view flame-checkbox-checkmark' style='top:8px;left:8px;width:6px;height:6px;'></div>")}}),Flame.TextFieldView=Flame.View.extend(Flame.ActionSupport,{classNames:["flame-text"],childViews:["textField"],layout:{left:0,top:0},defaultHeight:22,defaultWidth:200,value:"",placeholder:null,isPassword:!1,isValid:null,isEditableLabel:!1,isVisible:!0,becomeKeyResponder:function(){this.get("textField").becomeKeyResponder()},insertNewline:function(){return this.fireAction()},textField:Ember.TextField.extend(Flame.EventManager,Flame.FocusSupport,{classNameBindings:["isInvalid","isEditableLabel","isFocused"],acceptsKeyResponder:!0,typeBinding:Ember.Binding.from("^isPassword").transformTrueFalse("password","text"),isInvalidBinding:Ember.Binding.from("^isValid").transform(function(a){return a===!1}).oneWay(),valueBinding:"^value",placeholderBinding:"^placeholder",isEditableLabelBinding:"^isEditableLabel",isVisibleBinding:"^isVisible",keyUp:function(){return this._elementValueDidChange(),!1},insertNewline:function(){return!1},cancel:function(){return!1},mouseDown:function(){return Flame.ALLOW_BROWSER_DEFAULT_HANDLING},mouseMove:function(){return Flame.ALLOW_BROWSER_DEFAULT_HANDLING},mouseUp:function(){return Flame.ALLOW_BROWSER_DEFAULT_HANDLING}})}),Flame.SearchTextFieldView=Flame.TextFieldView.extend({classNames:["flame-search-field"],cancel:function(){return Ember.empty(this.get("value"))?!1:(Ember.run.next(this,function(){this.set("value","")}),!0)}}),Flame.SelectButtonView=Flame.ButtonView.extend({classNames:["flame-select-button-view"],items:[],value:undefined,defaultHeight:22,itemTitleKey:"title",itemValueKey:"value",itemActionKey:"action",subMenuKey:"subMenu",handlebars:function(){return'<label>{{_selectedMenuItem.%@}}</label><div><img src="%@"></div>'.fmt(this.get("itemTitleKey"),Flame.image("select_button_arrow.png"))}.property("value","_selectedMenuItem").cacheable(),_selectedMenuItem:function(){if(this.get("value")===undefined)return undefined;var a=this._findItem();return a}.property("value","itemValueKey","subMenuKey","items").cacheable(),itemsDidChange:function(){this.get("items")&&this.getPath("items.length")>0&&!this._findItem()&&this.set("value",this.getPath("items.firstObject.%@".fmt(this.get("itemValueKey"))))}.observes("items"),_findItem:function(a){a||(a=this.get("items"));var b=this.get("itemValueKey"),c=this.get("value"),d=this.get("subMenuKey"),e;return Ember.none(a)?e:(a.forEach(function(a){if(Ember.get(a,d)){var f=this._findItem(Ember.get(a,d));Ember.none(f)||(e=f)}else Ember.get(a,b)===c&&(e=a)},this),e)},menu:function(){var a=this;return Flame.MenuView.extend({selectButtonView:this,itemTitleKey:this.get("itemTitleKey"),itemValueKey:this.get("itemValueKey"),itemActionKey:this.get("itemActionKey"),subMenuKey:this.get("subMenuKey"),itemsBinding:"selectButtonView.items",valueBinding:"selectButtonView.value",close:function(){a.gotoState("idle"),this._super()}})}.property(),mouseDown:function(){return this._openMenu(),!1},insertSpace:function(){return this._openMenu(),!0},_openMenu:function(){this.gotoState("mouseDownInside"),this.get("menu").create().popup(this)}}),Flame.StackItemView=Flame.ListItemView.extend({useAbsolutePosition:!0,classNames:["flame-stack-item-view"]}),Flame.StackView=Flame.ListView.extend({layoutManager:Flame.VerticalStackLayoutManager.create({topMargin:0,spacing:0,bottomMargin:0}),allowSelection:!1}),Flame.StackedView=Flame.View.extend({}),Flame.TabView=Flame.View.extend({classNames:["flame-tab-view"],childViews:"tabBarView contentView".w(),tabs:null,previousTabs:null,nowShowing:null,tabsHeight:23,initializeTabsLazily:!0,init:function(){this._super(),Ember.none(this.get("tabs"))||this._tabsDidChange()},_tabsWillChange:function(){var a=this.get("tabs");Ember.none(a)||this.set("previousTabs",a.slice())}.observesBefore("tabs.@each"),_tabsDidChange:function(){var a=this.get("tabs");if(Ember.none(a))return;var b=this.get("previousTabs");Ember.none(b)||b.forEach(function(b,c){if(Ember.none(a.findProperty("value",b.value))){var d=this.get("tabBarView");d.get("childViews").forEach(function(a){a.get("value")===b.value&&d.removeChild(a)})}},this),a.forEach(function(a,c){(Ember.none(b)||Ember.none(b.findProperty("value",a.value)))&&this._addTab(a,c)},this)}.observes("tabs.@each"),_addTab:function(a,b){var c=this.get("contentView"),d=c.get("childViews"),e=this.get("tabBarView"),f=e.get("childViews"),g=this.get("tabsHeight"),h=this;f.insertAt(b,e.createChildView(Flame.ButtonView.create({acceptsKeyResponder:!1,layout:{top:0,bottom:0,height:g},title:a.title,value:a.value,isSelectedBinding:Ember.Binding.from("parentView.parentView.nowShowing").eq(a.value),action:function(){h.set("nowShowing",a.value)}})));var i=h.get(a.value);ember_assert("View for tab %@ not defined!".fmt(a.value),!!i),h.get("initializeTabsLazily")||(i instanceof Ember.View||(i=c.createChildView(i)),i.set("isVisible",!1),d.addObject(i),h.set(a.value,i)),Ember.none(this.get("nowShowing"))&&this.set("nowShowing",this.get("tabs").objectAt(0).value)},_tabWillChange:function(){this.get("nowShowing")&&this.get(this.get("nowShowing")).set("isVisible",!1)}.observesBefore("nowShowing"),_tabDidChange:function(){if(this.get("nowShowing")){var a=this.get("nowShowing"),b=this.get(a);if(!(b instanceof Ember.View)){var c=this.get("contentView");b=c.createChildView(b),c.get("childViews").addObject(b),this.set(a,b)}b.set("isVisible",!0)}}.observes("nowShowing"),tabBarView:Flame.View.extend({classNames:["flame-tab-view-tabs"],layout:{left:0,top:0,right:0,height:"parentView.tabsHeight"}}),contentView:Flame.View.extend({classNames:["flame-tab-view-content"],layout:{left:0,top:"parentView.tabsHeight",right:0,bottom:0}})}),Flame.TableDataView=Flame.View.extend(Flame.Statechart,{classNames:["flame-table-data-view"],acceptsKeyResponder:!0,updateBatchSize:500,_updateCounter:0,selectedCell:null,editValue:null,contentBinding:"^content",initialState:"loaded",loaded:Flame.State.extend({mouseDown:function(a){return this.get("owner").selectCell(jQuery(a.target))?(this.gotoState("selected"),!0):!1},enterState:function(){this.getPath("owner.state")==="inDOM"&&this.getPath("owner.selection").hide()}}),selected:Flame.State.extend({mouseDown:function(a){var b=jQuery(a.target);return b.hasClass("table-selection")&&this.getPath("owner.selectedDataCell.options")?(this.startEdit(),!0):!!this.get("owner").selectCell(b)},insertNewline:function(a){return this.startEdit()},deleteBackward:function(a){return this.wipeCell(),!0},deleteForward:function(a){this.wipeCell()},wipeCell:function(){var a=this.getPath("owner.selectedDataCell");if(Ember.none(a))return;a.isEditable()&&this.get("owner")._validateAndSet("")},doubleClick:function(){this.startEdit()},startEdit:function(a){var b=this.getPath("owner.selectedDataCell");if(Ember.none(b))return;b.isEditable()?this.gotoState("editing"):b.options()||this.gotoState("selectingReadOnly")},cancel:function(a){return this.get("owner").resignKeyResponder(),!0},moveLeft:function(a){var b=this.getPath("owner.selectedCell");return this.get("owner").selectCell(b.prev()),!0},moveRight:function(a){var b=this.getPath("owner.selectedCell");return this.get("owner").selectCell(b.next()),!0},moveDown:function(a){var b=this.getPath("owner.selectedCell");return this.get("owner").selectCell(jQuery(b.parent().next().children()[b.attr("data-index")])),!0},moveUp:function(a){var b=this.getPath("owner.selectedCell");return this.get("owner").selectCell(jQuery(b.parent().prev().children()[b.attr("data-index")])),!0},insertTab:function(a){return this.get("owner").invokeStateMethodByValuesOn("moveDown","moveRight"),!0},insertBacktab:function(a){return this.get("owner").invokeStateMethodByValuesOn("moveUp","moveLeft"),!0},keyPress:function(a){var b=this.getPath("owner.selectedDataCell");if(!b.isEditable())return!1;var c=String.fromCharCode(a.which);if(a.metaKey)return!1;if(c.match(/[a-zA-Z0-9+*\-\[\/\=]/)){var d=this.get("owner");return d.set("editValue",c),this.startEdit(),!0}return!1},enterState:function(){this.getPath("owner.selection").show()}}),selectingReadOnly:Flame.State.extend({keyPress:function(a){return!0},cancel:function(a){return this.get("owner")._cancelEditingOrSelecting(),!0},insertNewline:function(a){var b=this.get("owner");this.gotoState("selected"),b.invokeStateMethodByValuesOn("moveRight","moveDown")},moveLeft:function(a){this._invokeInSelected("moveLeft")},moveRight:function(a){this._invokeInSelected("moveRight")},moveDown:function(a){this._invokeInSelected("moveDown")},moveUp:function(a){this._invokeInSelected("moveUp")},insertTab:function(a){this._invokeInSelected("insertTab")},insertBacktab:function(a){this._invokeInSelected("insertBacktab")},deleteBackward:function(a){return this.gotoState("selected"),!0},mouseDown:function(a){var b=this.get("owner"),c=jQuery(a.target);return b.isCellSelectable(c)?(this.gotoState("selected"),b.selectCell(c),!0):!1},enterState:function(){var a=this.get("owner"),b=a.get("selection"),c=a.get("selectedDataCell"),d=a.editableValue(c);b.html(d),b.addClass("read-only")},exitState:function(){var a=this.getPath("owner.selection");a.html(""),a.removeClass("read-only")},_invokeInSelected:function(a){var b=this.get("owner");this.gotoState("selected"),b.invokeStateMethod(a)}}),editing:Flame.State.extend({cancel:function(a){return this.get("owner")._cancelEditingOrSelecting(),!0},insertNewline:function(a){var b=this.get("owner");return b._confirmEdit()&&(this.gotoState("selected"),b.invokeStateMethodByValuesOn("moveRight","moveDown")),!0},insertTab:function(a){var b=this.get("owner");return b._confirmEdit()&&(this.gotoState("selected"),b.invokeStateMethod("insertTab")),!0},insertBacktab:function(a){var b=this.get("owner");return b._confirmEdit()&&(this.gotoState("selected"),b.invokeStateMethod("insertBacktab")),!0},mouseDown:function(a){var b=this.get("owner"),c=jQuery(a.target);return b.isCellSelectable(c)&&b._confirmEdit()?(this.gotoState("selected"),b.selectCell(c),!0):!1},enterState:function(){var a=this.get("owner"),b=a.get("selectedCell"),c=b.position(),d=a.get("selectedDataCell"),e=a.get("editField"),f=a.getPath("parentView.scrollable"),g=a.get("selection"),h=d.options();if(!d.showEditor(b,a,a.get("content")))if(h){var i=Flame.MenuView.create({layout:{width:220},parent:a,items:h.map(function(b){return{title:b[0],value:b[1],isChecked:b[1]===d.value,action:function(){a.didSelectMenuItem(this.get("value"))}}}),close:function(){this.get("parent").gotoState("selected"),this._super()}});i.popup(b)}else{var j=b.css("backgroundColor");["rgba(0, 0, 0, 0)","transparent"].contains(j)&&(j="white"),e.css({left:parseInt(g.css("left"),10)+parseInt(g.css("border-left-width"),10)+"px",top:parseInt(g.css("top"),10)+parseInt(g.css("border-top-width"),10)+"px",width:g.outerWidth()-parseInt(g.css("border-left-width"),10)-parseInt(g.css("border-right-width"),10)+"px",height:g.outerHeight()-parseInt(g.css("border-top-width"),10)-parseInt(g.css("border-bottom-width"),10)+"px",backgroundColor:j});var k=a.editableValue(d);e.val(k),a.set("editValue",null),e.show(),e.selectRange(1024,1024)}},exitState:function(){var a=this.get("owner"),b=a.get("editField");b.hide(),b.removeClass("invalid")}}),didSelectMenuItem:function(a){var b=this.get("editField");b.val(a||""),this._confirmEdit(),this.invokeStateMethodByValuesOn("moveRight","moveDown")},willLoseKeyResponder:function(){this.set("selectedCell",null),this.gotoState("loaded")},selectedDataCell:function(){var a=this.get("selectedCell");return this.get("data")[a.parent().attr("data-index")][a.attr("data-index")]}.property(),editableValue:function(a){var b=this.get("editValue");return b!==null?b:(b=a.editableValue(),Ember.none(b)?"":b)},didInsertElement:function(){this.set("selection",this.$(".table-selection")),this.set("editField",this.$(".table-edit-field"))},_selectionDidChange:function(){var a=this.get("selectedCell");if(!a)return;var b=this.get("selection"),c=this.getPath("parentView.scrollable"),d=this.get("selectedDataCell"),e=a.position(),f=c.scrollTop(),g=c.scrollLeft(),h=jQuery.browser.webkit?1:2;b.css({left:e.left+g-h+"px",top:e.top+f-h+"px",width:a.outerWidth()-3+"px",height:a.outerHeight()-1+"px"});if(e.top<0)c.scrollTop(f+e.top);else if(e.top+a.outerHeight()>c.outerHeight()){var i=e.top+a.outerHeight()-c.outerHeight();c.scrollTop(i+f+17)}else if(e.left<0)c.scrollLeft(g+e.left);else if(e.left+a.outerWidth()>c.outerWidth()){var j=e.left+a.outerWidth()-c.outerWidth();c.scrollLeft(j+g+17)}}.observes("selectedCell"),_confirmEdit:function(){var a=this.get("editField").val();return this._validateAndSet(a)},_validateAndSet:function(a){var b=this.get("data"),c=this.get("selectedCell"),d=parseInt(c.attr("data-index"),10),e=parseInt(c.parent().attr("data-index"),10),f=b[e][d];if(Ember.compare(f.editableValue(),a)===0)return!0;if(f.validate(a)){var g=this.get("cellUpdateDelegate");ember_assert("No cellUpdateDelegate set!",!!g);var h=[e,d];if(g.cellUpdated(f,a,h)){var i=this.get("dirtyCells").slice();i.push([e,d]),this.set("dirtyCells",i)}return!0}return this.get("editField").addClass("invalid"),!1},_cancelEditingOrSelecting:function(){this.gotoState("selected")},invokeStateMethodByValuesOn:function(a,b){this.get("areValuesOnRows")?this.invokeStateMethod(a):this.invokeStateMethod(b)},selectCell:function(a){return this.getPath("parentView.allowSelection")&&this.isCellSelectable(a)?(this.set("selectedCell",a),!0):!1},isCellSelectable:function(a){return a&&a[0]&&a[0].nodeName==="TD"},updateColumnWidth:function(a,b){var c=this.$("td[data-index=%@]".fmt(a));c.css({width:"%@px".fmt(b)}),this.propertyDidChange("selectedCell")},render:function(a){this._renderElementAttributes(a),this.set("selectedCell",null),this.gotoState("loaded"),this._renderTable(a)},_renderTable:function(a){var b=this.get("data");if(!b)return a;var c=b.length;if(!b[0])return a;var d=b[0].length,e=this.getPath("parentView.defaultColumnWidth"),f=this.getPath("parentView.content.columnLeafs"),g,h="flame-table";this.getPath("parentView.allowSelection")||(h+=" is-selectable"),a=a.begin("table").attr("class",h).attr("width","1px");var i,j;for(i=0;i<c;i++){a.push('<tr data-index="'+i+'">');for(j=0;j<d;j++){var k=b[i][j],l=k?k.cssClassesString():"";g=f[j].get("render_width")||e,jQuery.browser.mozilla&&(g-=5),a.push('<td data-index="%@" class="%@" style="width: %@px;">%@</td>'.fmt(j,l+(j%2===0?" even-col":" odd-col"),g,k?k.formattedValue():'<span style="color: #999">...</span>'))}a.push("</tr>")}a=a.end(),a=a.begin("div").attr("class","table-selection").end(),a=a.begin("input").attr("class","table-edit-field").end()},_cellsDidChange:function(){this.manipulateCells(this.get("dirtyCells"),function(a,b,c){var d=(a?a.cssClassesString():"")+(c?" even-col":" odd-col"),e=a.formattedValue();b.className=d,b.innerHTML=Ember.none(e)?"":e},++this._updateCounter)}.observes("dirtyCells"),_updatingCellsDidChange:function(){this.manipulateCells(this.get("cellsMarkedForUpdate"),function(a,b,c){a.isUpdating=!0;var d=a.cssClassesString()+(c?" even-col":" odd-col");b.className=d})}.observes("cellsMarkedForUpdate"),manipulateCells:function(a,b,c){var d=this.get("data");if(!a||a.length===0)return;var e=this.$("table.flame-table"),f=e.find("td"),g=a.splice(0,a.length);this._batchUpdate(this.get("updateBatchSize"),0,c,g,d,f,b)},_batchUpdate:function(a,b,c,d,e,f,g){if(typeof c!="undefined"&&c!=this._updateCounter)return;var h=d.length,i,j,k,l=e[0].length;for(var m=b;m<h&&m-b<a;m++){j=d[m];var n=j[0],o=j[1];k=e[n][o],i=f[n*l+o],i&&g(k,i,o%2===0)}if(m<h){var p=this;Ember.run.next(function(){p._batchUpdate(a,m,c,d,e,f,g)})}}}),Flame.TableView=Flame.View.extend(Flame.Statechart,{classNames:"flame-table-view".w(),childViews:"tableDataView".w(),acceptsKeyResponder:!1,scrollable:null,rowHeader:null,columnHeader:null,tableCorner:null,renderColumnHeader:!0,renderRowHeader:!0,isRowHeaderClickable:!0,isResizable:!0,allowSelection:!1,initialState:"idle",defaultColumnWidth:88,cellUpdateDelegate:null,clickDelegate:null,resizeDelegate:null,content:null,allowRefresh:!0,contentAdapter:function(){return Flame.TableViewContentAdapter.create({content:this.get("content")})}.property("content").cacheable(),tableDataView:Flame.TableDataView.extend({dataBinding:"^content._data",dirtyCellsBinding:"^content.dirtyCells",areValuesOnRowsBinding:"^content.areValuesOnRows",totalRowIdsBinding:"^content.totalRowIds",totalColumnIdsBinding:"^content.totalColumnIds",cellUpdateDelegateBinding:"^cellUpdateDelegate",cellsMarkedForUpdateBinding:"^content.cellsMarkedForUpdate"}),rowDepth:function(){return this.getPath("contentAdapter.rowHeaderRows").map(function(a){return a.length}).max()}.property("contentAdapter.rowHeaderRows").cacheable(),idle:Flame.State.extend({mouseDown:function(a){var b=jQuery(a.target);if(b.is("div.resize-handle")){this.gotoState("resizing");var c=this.get("owner"),d=b.parent();return c.set("resizingCell",d),c.set("dragStartX",a.pageX),c.set("startX",parseInt(b.parent().css("width"),10)),c.set("offset",parseInt(this.getPath("owner.tableCorner").css("width"),10)),c.set("type",d.is(".column-header td")?"column":"row"),!0}return b.closest(".column-header").length?!0:b.is("a")?!0:!1},mouseUp:function(a){var b=this.getPath("owner.clickDelegate");if(b){var c=jQuery(a.target),d,e;if(!!c.closest(".column-header").length&&(d=c.closest("td").attr("data-leaf-index")))return b.columnHeaderClicked&&(e=this.getPath("owner.content.columnLeafs")[d],b.columnHeaderClicked(e,c)),!0;if(!!c.closest(".row-header").length){if(b.rowHeaderClicked){var f=c.closest("td");d=parseInt(f.attr("data-index"),10)/parseInt(f.attr("rowspan")||1,10),e=this.getPath("owner.content._headers.rowHeaders")[d];if(!e)return!1;b.rowHeaderClicked(e,c,d)}return!0}}return!1}}),resizing:Flame.State.extend({mouseMove:function(a){var b=jQuery(a.target),c=this.getPath("owner.resizingCell"),d=a.pageX-this.getPath("owner.dragStartX"),e=this.getPath("owner.startX")+d;e<30&&(e=30);var f;if(this.getPath("owner.type")==="column")f=parseInt(c.attr("data-leaf-index"),10)+1,c.parents("table").find("colgroup :nth-child(%@)".fmt(f)).css("width","%@px".fmt(e)),this.get("owner")._synchronizeColumnWidth();else{var g=this.getPath("owner.offset")+d-2;g<30&&(g=30);if(jQuery.browser.mozilla)g-=1;else if(jQuery.browser.webkit||jQuery.browser.msie)g-=2;this.getPath("owner.scrollable").css("left","%@px".fmt(g)),this.getPath("owner.columnHeader").parent().css("left","%@px".fmt(g)),this.getPath("owner.tableCorner").css("width","%@px".fmt(g));var h=this.getPath("owner.rowDepth");f=h-c.nextAll().length,c.parents("table").find("colgroup :nth-child(%@)".fmt(f)).css("width","%@px".fmt(e))}},mouseUp:function(a){var b=this.get("owner");if(b.get("type")==="column"){var c=b.get("resizeDelegate");if(c&&c.columnResized){var d=b.get("resizingCell"),e=parseInt(d.css("width"),10),f=parseInt(d.attr("data-leaf-index"),10);c.columnResized(f,e)}}return this.gotoState("idle"),!0}}),_synchronizeColumnWidth:function(){var a=this.get("resizingCell"),b=this.get("childViews")[0],c=parseInt(a.css("width"),10),d=parseInt(a.attr("data-leaf-index"),10);if(jQuery.browser.webkit||jQuery.browser.msie)c+=4;jQuery.browser.mozilla&&(c-=2),b.updateColumnWidth(d,c)},willInsertElement:function(){var a=this.get("scrollable");a&&a.unbind()},didInsertElement:function(){this.set("scrollable",this.$(".flame-table").parent().parent()),this.set("rowHeader",this.$(".row-header table")),this.set("columnHeader",this.$(".column-header table")),this.set("tableCorner",this.$(".table-corner")),this.get("scrollable").scroll({self:this},this.didScroll)},didScroll:function(a){var b=a.data.self,c=b.get("scrollable");b.get("rowHeader").css("top","-%@px".fmt(c.scrollTop())),b.get("columnHeader").css("left","-%@px".fmt(c.scrollLeft()))},_headersDidChange:function(){this.rerender()}.observes("contentAdapter.headers"),render:function(a){this._renderElementAttributes(a);var b=this.get("renderColumnHeader"),c=this.get("renderRowHeader"),d=!1,e=this.getPath("contentAdapter.headers");if(!e)return;this.getPath("content.title")&&(a=a.push('<div class="panel-title">%@</div>'.fmt(this.getPath("content.title"))),d=!0);var f=this.get("defaultColumnWidth"),g=this.getPath("contentAdapter.columnHeaderRows"),h=this.getPath("contentAdapter.rowHeaderRows"),i=g.maxDepth*21+1+g.maxDepth,j=0;c&&(j=h.maxDepth*f+1+(b?0:5));var k=d?18:0;b&&(a=a.push('<div class="table-corner" style="top: %@px; left: 0px; height: %@px; width: %@px;"></div>'.fmt(k,i,j)),a=this._renderHeader(a,"column",j,f),k+=i),c&&(a=this._renderHeader(a,"row",k,f)),a=a.begin("div").attr("style","overflow: auto; bottom: 0px; top: %@px; left: %@px; right: 0px;".fmt(k,j)),a=a.attr("class","scrollable"),this.forEachChildView(function(b){b.renderToBuffer(a)}),a=a.end()},_renderHeader:function(a,b,c,d){var e=this.getPath("contentAdapter.headers");if(!e)return a.begin("div").end();var f,g;b==="column"?(e=this.getPath("contentAdapter.columnHeaderRows"),f="left"):(e=this.getPath("contentAdapter.rowHeaderRows"),f="top");var h=e.length;a=a.begin("div").addClass("%@-header".fmt(b)).attr("style","position: absolute; %@: %@px".fmt(f,c)),a=a.begin("table").attr("style","position: absolute").attr("width","1px"),a=a.begin("colgroup");if(b==="row")for(g=1;g<4;g++)a=a.push('<col style="width: %@px;" class="level-%@" />'.fmt(d,g));else{var i=this.getPath("content.columnLeafs").length;for(g=0;g<i;g++)a=a.push('<col style="width: %@px;" />'.fmt(this.getPath("content.columnLeafs")[g].get("render_width")||d))}a=a.end();for(g=0;g<h;g++)a=a.begin("tr"),b==="column"&&(a=a.attr("class","level-%@".fmt(g+1))),a=this._renderRow(a,e[g],b,g),a=a.end();return a=a.end().end(),a},_renderRow:function(a,b,c,d){var e=b.length,f,g,h;for(var i=0;i<e;i++){var j=b[i];a=a.begin("td"),h=j.get?j.get("headerLabel"):j.label,a=a.attr("title",h),j.rowspan>1&&(a=a.attr("rowspan",j.rowspan)),j.colspan>1&&(a=a.attr("colspan",j.colspan)),f='<div class="label">%@</div>',a.attr("class",i%2===0?"even-col":"odd-col"),c==="column"&&!j.hasOwnProperty("children")?(a=a.attr("data-index",i),a=a.attr("data-leaf-index",j.leafIndex),this.get("isResizable")&&this.get("renderColumnHeader")&&(a=a.push('<div class="resize-handle">&nbsp;</div>')),f='<div class="label">%@',g&&(f+='<img src="%@" style="vertical-align: middle" />'.fmt(g)),f+="</div>"):c==="row"&&(a=a.attr("data-index",d%this.getPath("content.rowLeafs").length),this.get("renderColumnHeader")&&(this.get("isResizable")&&(j.hasOwnProperty("children")?a=a.push('<div class="resize-handle" style="height: %@px"></div>'.fmt(j.children.length*21)):a=a.push('<div class="resize-handle"></div>')),this.get("isRowHeaderClickable")&&j.get("isClickable")&&(f='<a href="javascript:void(0)">%@</a>'))),a=a.push(f.fmt(h)).end()}return a}}),Flame.TextAreaView=Flame.View.extend({classNames:["flame-text"],childViews:["textArea"],layout:{left:0,top:0},defaultHeight:20,defaultWidth:200,value:"",placeholder:null,isValid:null,isVisible:!0,becomeKeyResponder:function(){this.get("textArea").becomeKeyResponder()},textArea:Ember.TextArea.extend(Flame.EventManager,Flame.FocusSupport,{classNameBindings:["isInvalid","isFocused"],acceptsKeyResponder:!0,isValid:null,isInvalidBinding:Ember.Binding.from("isValid").transform(function(a){return a===!1}).oneWay(),valueBinding:"^value",placeholderBinding:"^placeholder",isVisibleBinding:"^isVisible",keyDown:function(){return!1},keyUp:function(){return this._elementValueDidChange(),!1}})}),Flame.TreeItemView=Flame.ListItemView.extend({useAbsolutePositionBinding:"parentView.rootTreeView.useAbsolutePositionForItems",classNames:["flame-tree-item-view"],classNameBindings:["parentView.nestingLevel"],isExpandedBinding:Ember.Binding.or("content.treeItemIsExpanded","defaultIsExpanded"),layout:{left:0,right:0,top:0,height:0},defaultIsExpanded:function(){return this.getPath("parentView.rootTreeView.defaultIsExpanded")}.property("parentView.rootTreeView.defaultIsExpanded").cacheable(),init:function(){this._super()},isSelected:function(a,b){return!1}.property().cacheable(),classAttribute:function(){return this.get("content")===this.getPath("parentView.rootTreeView.selection")?"flame-tree-item-view-container is-selected":"flame-tree-item-view-container"}.property("content","parentView.rootTreeView.selection").cacheable(),handlebars:'<div {{bindAttr class="classAttribute"}}><div class="flame-tree-item-view-pad">{{#if hasChildren}}{{view toggleButton}}{{/if}}{{view treeItemViewClass content=content}}</div></div>{{#if renderSubTree}}{{view nestedTreeView}}{{/if}}',renderSubTree:function(){return this.get("hasChildren")&&this.get("isExpanded")}.property().cacheable(),_updateSubTreeRendering:function(){var a=this.get("renderSubTree");!a&&this.get("isExpanded")&&this.get("hasChildren")&&(this.propertyWillChange("renderSubTree"),this.propertyDidChange("renderSubTree"))}.observes("hasChildren","isExpanded"),treeItemViewClass:function(){return Flame.View.extend({useAbsolutePosition:!1,layout:{top:0,left:0,right:0,height:20},classNames:["flame-tree-item-view-content"],contentIndexBinding:"parentView.contentIndex",handlebars:function()
{return this.getPath("parentView.parentView.rootTreeView").handlebarsForItem(this.get("content"))}.property("content").cacheable()})}.property(),childListView:function(){return this.get("renderSubTree")?this.getPath("childViews.lastObject.childViews.firstObject"):null}.property("showsubTree").cacheable(),hasChildren:function(){return!Ember.none(this.getPath("content.treeItemChildren"))}.property("content.treeItemChildren"),mouseUp:function(){return this.getPath("parentView.rootTreeView.clickTogglesIsExpanded")&&this.toggleProperty("isExpanded"),!1},toggleButton:Flame.DisclosureView.extend({classNames:["flame-tree-view-toggle"],ignoreLayoutManager:!0,useAbsolutePosition:!1,acceptsKeyResponder:!1,visibilityTargetBinding:"parentView.isExpanded",action:function(){return!1}}),nestedTreeView:function(){return Flame.TreeView.extend({useAbsolutePosition:this.getPath("parentView.rootTreeView.useAbsolutePositionForItems"),layoutManager:Flame.VerticalStackLayoutManager.create({topMargin:0,spacing:0,bottomMargin:0}),layout:{top:0,left:0,right:0},classNames:["flame-tree-view-nested"],isVisibleBinding:Ember.Binding.bool("parentView.isExpanded"),allowSelection:this.getPath("parentView.rootTreeView.allowSelection"),allowReordering:this.getPath("parentView.rootTreeView.allowReordering"),content:this.getPath("content.treeItemChildren"),itemViewClass:this.getPath("parentView.rootTreeView.itemViewClass"),isNested:!0})}.property("content")}),Flame.TreeView=Flame.ListView.extend({classNames:["flame-tree-view"],classNameBindings:["isNested","nestingLevel"],defaultIsExpanded:!1,itemViewClass:Flame.TreeItemView,isNested:!1,clickTogglesIsExpanded:!0,useAbsolutePositionForItems:!1,handlebarsForItem:function(a){var b=this.get("handlebarsMap")||{};return b[a.constructor.toString()]||b.defaultTemplate},nestingLevel:function(){return"level-%@".fmt(this.getPath("treeLevel"))}.property("treeLevel"),_treeSelectionDidChange:function(){var a=this.get("selection"),b=this.get("parentTreeView");a&&b&&(b.set("selection",a),this.set("selection",undefined))}.observes("selection"),startReordering:function(a,b){var c=this.get("parentTreeView");c?(a.get("itemPath").insertAt(0,this.getPath("parentView.contentIndex")),c.startReordering(a,b)):(Flame.set("mouseResponderView",this),this._super(a,b))},treeLevel:function(){return(this.getPath("parentTreeView.treeLevel")||0)+1}.property("parentTreeView.treeLevel"),parentTreeView:function(){return this.get("isNested")?this.getPath("parentView.parentView"):undefined}.property("isNested","parentView.parentView"),rootTreeView:function(){return this.getPath("parentTreeView.rootTreeView")||this}.property("parentTreeView.rootTreeView")}),Flame.Repeater=Ember.Object.extend(Flame.ActionSupport,{init:function(){this._super(),this._scheduleNext()},stop:function(){Ember.run.cancel(this._timer)},reschedule:function(){this.stop(),this._scheduleNext()},_scheduleNext:function(){var a;if(this.get("interval")===0)a=0;else{var b=this.get("lastInvoke");Ember.none(b)?a=this.get("interval"):a=(new Date).getTime()-b+this.get("interval"),a<0&&(a=0)}this._timer=Ember.run.later(this,function(){this.set("lastInvoke",(new Date).getTime()),this.fireAction(),this._scheduleNext()},a)}}),Flame.Validator=Ember.Object.extend({validate:function(a,b){return!0},validateValue:function(a){return this.validate(Ember.Object.create({value:a}),"value")},isValidProperty:function(a){return a+"IsValid"}}),Flame.Validatable=Ember.Mixin.create({_propertyValidity:null,_objectIsValid:null,_validations:null,isValidProperty:function(a){return a+"IsValid"},validateProperty:function(a,b,c,d){Ember.none(d)&&(d=!1),c===undefined&&(c=a.get(b));var e=a.get("validations")[b],f=null;if(jQuery.isPlainObject(e)){var g=e;e=g.validation,f=g.coupledProperties}var h;jQuery.isArray(e)||(e=[e]);for(var i=0;i<e.length;i++)if(!(h=this._validate(e[i],a,b,c)))break;var j=this.isValidProperty(b);a.beginPropertyChanges(),a.set(j,h);if(!d&&f){if(!jQuery.isArray(f))throw"Hint: coupledProperties must be an array!";for(var k=0;k<f.length;k++){var l=f[k];l!==b&&this.validateProperty(this,l,undefined,!0)}}a.set("isValid",a._checkValidity()),a.endPropertyChanges()},invalidProperties:function(){var a=[],b=this.get("validations");for(var c in b)this.get(this.isValidProperty(c))!==!0&&a.push(c);return a}.property(),_validate:function(a,b,c,d){var e=null;return a instanceof Flame.Validator?e=a.validate(b,c):Ember.none(a)||(e=a.call(this,d)),e},_checkValidity:function(){var a=this.get("validations");for(var b in a)if(a.hasOwnProperty(b)&&this.get(this.isValidProperty(b))!==!0)return!1;return!0},isValid:function(a,b){return typeof b!="undefined"&&(this._objectIsValid=b),this._objectIsValid===null&&(this._objectIsValid=this._checkValidity()),this._objectIsValid}.property(),validations:function(a,b){return Ember.none(b)||(this._validations===null?this._validations=b:Ember.Logger.info("Trying to set validations after the validations have already been set!")),this._validations}.property(),_createIsValidProperties:function(){var a=this.get("validations"),b,c=this;for(b in a)a.hasOwnProperty(b)&&this._createIsValidProperty(b);for(b in a)a.hasOwnProperty(b)&&(this.addObserver(b,this,"validateProperty"),this.validateProperty(this,b))},_createIsValidProperty:function(a){this._propertyValidity===null&&(this._propertyValidity={});var b=this;Ember.defineProperty(this,this.isValidProperty(a),Ember.computed(function(a,c){return typeof c!="undefined"&&(b.propertyWillChange(a),b._propertyValidity[a]=c,b.propertyDidChange(a)),b._propertyValidity[a]}).property())},setValidationFor:function(a,b){var c=this.get("validations");c[a]=b,this._createIsValidProperty(a),this.removeObserver(a,this,"validateProperty"),this.addObserver(a,this,"validateProperty"),this.validateProperty(this,a)},unknownProperty:function(a){var b=/^(.+)IsValid$/.exec(a),c=this.get("validations");if(b&&c){var d=b[1];if(c[d])return this._createIsValidProperties(),this.get(a)}return this._super(a)},setUnknownProperty:function(a,b){var c=/^(.+)IsValid$/.exec(a),d=this.get("validations");if(c&&d){var e=c[1];if(d[e])return this._createIsValidProperties(),this.set(a,b)}return this._super(a,b)}}),Flame.Validator.association=Flame.Validator.create({validate:function(a,b){var c=a.get(b);return Ember.isArray(c)?c.every(function(a){return a.get("isValid")}):c?c.get("isValid"):!0}}),Flame.Validator.email=Flame.Validator.create({validate:function(a,b){var c=/^(([A-Za-z0-9]+_+)|([A-Za-z0-9]+\-+)|([A-Za-z0-9]+\.+)|([A-Za-z0-9]+\++))*[A-Za-z0-9]+@((\w+\-+)|(\w+\.))*\w{1,63}\.[a-zA-Z]{2,6}$/i,d=a.get(b);return c.test(d)}}),Flame.Validator.notBlank=Flame.Validator.create({validate:function(a,b){var c=a.get(b);return c?!c.toString().isBlank():!1}}),Flame.Validator.number=Flame.Validator.create({validate:function(a,b){var c=a.get(b);return c===""||!isNaN(c)&&!isNaN(parseFloat(c))}}),Flame.VERSION="0.2.1";